import{A as un,B as hn,C as Ir,D as dn,E as fn,F as pn,G as mn,H as _e,I as gn,J as _n,K as yn,L as vn,M as En,N as He,O as wn,P as Tn,Q as rh,R as ih,T as In,U as oh,V as ah,a as g,b as an,c as Hu,d as Yu,e as Xu,f as ln,g as vr,h as cn,i as wo,j as Ju,k as Ke,l as Er,m as wr,n as X,o as Zu,p as eh,q as We,r as Lt,s as To,t as rs,u as th,v as nh,w as Tr,x as sh,y as is,z as Qe}from"./chunk-PTLVGTYQ.js";import{a as lh,b as br,c as Cr,d as yh,e as Rr,f as Ao,g as Pr,h as bo,i as Nr,j as Dr,k as kr,l as xr}from"./chunk-HAIAN5VX.js";import{a as ch,b as uh,d as Io,e as Sr,f as hh,g as dh,h as fh,i as ph,j as mh,k as So,l as Ar,m as gh,n as It,q as _h,r as Ne,s as Sn}from"./chunk-74K6VITO.js";import{$ as ku,A as Su,B as pr,C as Au,D as bu,Ea as Lu,F as Tt,Fa as Uu,G as vo,Ga as Bu,H as Cu,J as Ru,K as Pu,L as Nu,M as rn,N as mr,P as gr,Q as M,S as W,T as ct,Ta as qu,U as Z,V as Q,W as $,Y as ge,Z as Du,Za as $u,a as K,aa as ut,b as de,c as yu,ca as _r,cb as zu,da as xu,e as ae,f as ns,g as vu,gb as ju,hb as Gu,i as Eu,ia as Ou,ib as Ku,ja as on,jb as Wu,k as wu,ka as yr,l as at,mb as Qu,n as Tu,pa as Eo,q as wt,r as Iu,s as J,t as yo,ta as Mu,u as lt,ua as Fu,w as sn,wa as Vu,x as je,xa as Ge,y as Fe,z as ss}from"./chunk-Z65UEY6O.js";var vh=[{path:"login",loadChildren:()=>import("./chunk-GCDP5T46.js").then(t=>t.LOGIN_ROUTES)},{path:"main",loadChildren:()=>import("./chunk-2FNI6PZ2.js").then(t=>t.MAIN_ROUTES)},{path:"rounds",loadChildren:()=>import("./chunk-TCHRV54O.js").then(t=>t.ROUNDS_ROUTES)},{path:"**",pathMatch:"full",redirectTo:"main"}];var C=function(t){return t[t.State=0]="State",t[t.Transition=1]="Transition",t[t.Sequence=2]="Sequence",t[t.Group=3]="Group",t[t.Animate=4]="Animate",t[t.Keyframes=5]="Keyframes",t[t.Style=6]="Style",t[t.Trigger=7]="Trigger",t[t.Reference=8]="Reference",t[t.AnimateChild=9]="AnimateChild",t[t.AnimateRef=10]="AnimateRef",t[t.Query=11]="Query",t[t.Stagger=12]="Stagger",t}(C||{}),Ye="*";function Eh(t,e=null){return{type:C.Sequence,steps:t,options:e}}function Co(t){return{type:C.Style,styles:t,offset:null}}var St=class{constructor(e=0,n=0){this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._originalOnDoneFns=[],this._originalOnStartFns=[],this._started=!1,this._destroyed=!1,this._finished=!1,this._position=0,this.parentPlayer=null,this.totalTime=e+n}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}onStart(e){this._originalOnStartFns.push(e),this._onStartFns.push(e)}onDone(e){this._originalOnDoneFns.push(e),this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}hasStarted(){return this._started}init(){}play(){this.hasStarted()||(this._onStart(),this.triggerMicrotask()),this._started=!0}triggerMicrotask(){queueMicrotask(()=>this._onFinish())}_onStart(){this._onStartFns.forEach(e=>e()),this._onStartFns=[]}pause(){}restart(){}finish(){this._onFinish()}destroy(){this._destroyed||(this._destroyed=!0,this.hasStarted()||this._onStart(),this.finish(),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}reset(){this._started=!1,this._finished=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}setPosition(e){this._position=this.totalTime?e*this.totalTime:1}getPosition(){return this.totalTime?this._position/this.totalTime:1}triggerCallback(e){let n=e=="start"?this._onStartFns:this._onDoneFns;n.forEach(s=>s()),n.length=0}},os=class{constructor(e){this._onDoneFns=[],this._onStartFns=[],this._finished=!1,this._started=!1,this._destroyed=!1,this._onDestroyFns=[],this.parentPlayer=null,this.totalTime=0,this.players=e;let n=0,s=0,r=0,i=this.players.length;i==0?queueMicrotask(()=>this._onFinish()):this.players.forEach(o=>{o.onDone(()=>{++n==i&&this._onFinish()}),o.onDestroy(()=>{++s==i&&this._onDestroy()}),o.onStart(()=>{++r==i&&this._onStart()})}),this.totalTime=this.players.reduce((o,a)=>Math.max(o,a.totalTime),0)}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}init(){this.players.forEach(e=>e.init())}onStart(e){this._onStartFns.push(e)}_onStart(){this.hasStarted()||(this._started=!0,this._onStartFns.forEach(e=>e()),this._onStartFns=[])}onDone(e){this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}hasStarted(){return this._started}play(){this.parentPlayer||this.init(),this._onStart(),this.players.forEach(e=>e.play())}pause(){this.players.forEach(e=>e.pause())}restart(){this.players.forEach(e=>e.restart())}finish(){this._onFinish(),this.players.forEach(e=>e.finish())}destroy(){this._onDestroy()}_onDestroy(){this._destroyed||(this._destroyed=!0,this._onFinish(),this.players.forEach(e=>e.destroy()),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}reset(){this.players.forEach(e=>e.reset()),this._destroyed=!1,this._finished=!1,this._started=!1}setPosition(e){let n=e*this.totalTime;this.players.forEach(s=>{let r=s.totalTime?Math.min(1,n/s.totalTime):1;s.setPosition(r)})}getPosition(){let e=this.players.reduce((n,s)=>n===null||s.totalTime>n.totalTime?s:n,null);return e!=null?e.getPosition():0}beforeDestroy(){this.players.forEach(e=>{e.beforeDestroy&&e.beforeDestroy()})}triggerCallback(e){let n=e=="start"?this._onStartFns:this._onDoneFns;n.forEach(s=>s()),n.length=0}},Or="!";function wh(t){return new M(3e3,!1)}function Ag(){return new M(3100,!1)}function bg(){return new M(3101,!1)}function Cg(t){return new M(3001,!1)}function Rg(t){return new M(3003,!1)}function Pg(t){return new M(3004,!1)}function Ng(t,e){return new M(3005,!1)}function Dg(){return new M(3006,!1)}function kg(){return new M(3007,!1)}function xg(t,e){return new M(3008,!1)}function Og(t){return new M(3002,!1)}function Mg(t,e,n,s,r){return new M(3010,!1)}function Fg(){return new M(3011,!1)}function Vg(){return new M(3012,!1)}function Lg(){return new M(3200,!1)}function Ug(){return new M(3202,!1)}function Bg(){return new M(3013,!1)}function qg(t){return new M(3014,!1)}function $g(t){return new M(3015,!1)}function zg(t){return new M(3016,!1)}function jg(t,e){return new M(3404,!1)}function Gg(t){return new M(3502,!1)}function Kg(t){return new M(3503,!1)}function Wg(){return new M(3300,!1)}function Qg(t){return new M(3504,!1)}function Hg(t){return new M(3301,!1)}function Yg(t,e){return new M(3302,!1)}function Xg(t){return new M(3303,!1)}function Jg(t,e){return new M(3400,!1)}function Zg(t){return new M(3401,!1)}function e_(t){return new M(3402,!1)}function t_(t,e){return new M(3505,!1)}function At(t){switch(t.length){case 0:return new St;case 1:return t[0];default:return new os(t)}}function Mh(t,e,n=new Map,s=new Map){let r=[],i=[],o=-1,a=null;if(e.forEach(l=>{let c=l.get("offset"),u=c==o,h=u&&a||new Map;l.forEach((d,p)=>{let f=p,m=d;if(p!=="offset")switch(f=t.normalizePropertyName(f,r),m){case Or:m=n.get(p);break;case Ye:m=s.get(p);break;default:m=t.normalizeStyleValue(p,f,m,r);break}h.set(f,m)}),u||i.push(h),a=h,o=c}),r.length)throw Gg(r);return i}function Yo(t,e,n,s){switch(e){case"start":t.onStart(()=>s(n&&Ro(n,"start",t)));break;case"done":t.onDone(()=>s(n&&Ro(n,"done",t)));break;case"destroy":t.onDestroy(()=>s(n&&Ro(n,"destroy",t)));break}}function Ro(t,e,n){let s=n.totalTime,r=!!n.disabled,i=Xo(t.element,t.triggerName,t.fromState,t.toState,e||t.phaseName,s??t.totalTime,r),o=t._data;return o!=null&&(i._data=o),i}function Xo(t,e,n,s,r="",i=0,o){return{element:t,triggerName:e,fromState:n,toState:s,phaseName:r,totalTime:i,disabled:!!o}}function be(t,e,n){let s=t.get(e);return s||t.set(e,s=n),s}function Th(t){let e=t.indexOf(":"),n=t.substring(1,e),s=t.slice(e+1);return[n,s]}var n_=typeof document>"u"?null:document.documentElement;function Jo(t){let e=t.parentNode||t.host||null;return e===n_?null:e}function s_(t){return t.substring(1,6)=="ebkit"}var Ut=null,Ih=!1;function r_(t){Ut||(Ut=i_()||{},Ih=Ut.style?"WebkitAppearance"in Ut.style:!1);let e=!0;return Ut.style&&!s_(t)&&(e=t in Ut.style,!e&&Ih&&(e="Webkit"+t.charAt(0).toUpperCase()+t.slice(1)in Ut.style)),e}function i_(){return typeof document<"u"?document.body:null}function Fh(t,e){for(;e;){if(e===t)return!0;e=Jo(e)}return!1}function Vh(t,e,n){if(n)return Array.from(t.querySelectorAll(e));let s=t.querySelector(e);return s?[s]:[]}var Zo=(()=>{let e=class e{validateStyleProperty(s){return r_(s)}matchesElement(s,r){return!1}containsElement(s,r){return Fh(s,r)}getParentElement(s){return Jo(s)}query(s,r,i){return Vh(s,r,i)}computeStyle(s,r,i){return i||""}animate(s,r,i,o,a,l=[],c){return new St(i,o)}};e.\u0275fac=function(r){return new(r||e)},e.\u0275prov=W({token:e,factory:e.\u0275fac});let t=e;return t})(),sa=class sa{};sa.NOOP=new Zo;var $t=sa,zt=class{};var o_=1e3,Lh="{{",a_="}}",Uh="ng-enter",Oo="ng-leave",Mr="ng-trigger",Br=".ng-trigger",Sh="ng-animating",Mo=".ng-animating";function ht(t){if(typeof t=="number")return t;let e=t.match(/^(-?[\.\d]+)(m?s)/);return!e||e.length<2?0:Fo(parseFloat(e[1]),e[2])}function Fo(t,e){switch(e){case"s":return t*o_;default:return t}}function qr(t,e,n){return t.hasOwnProperty("duration")?t:l_(t,e,n)}function l_(t,e,n){let s=/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i,r,i=0,o="";if(typeof t=="string"){let a=t.match(s);if(a===null)return e.push(wh(t)),{duration:0,delay:0,easing:""};r=Fo(parseFloat(a[1]),a[2]);let l=a[3];l!=null&&(i=Fo(parseFloat(l),a[4]));let c=a[5];c&&(o=c)}else r=t;if(!n){let a=!1,l=e.length;r<0&&(e.push(Ag()),a=!0),i<0&&(e.push(bg()),a=!0),a&&e.splice(l,0,wh(t))}return{duration:r,delay:i,easing:o}}function c_(t){return t.length?t[0]instanceof Map?t:t.map(e=>new Map(Object.entries(e))):[]}function Xe(t,e,n){e.forEach((s,r)=>{let i=ea(r);n&&!n.has(r)&&n.set(r,t.style[i]),t.style[i]=s})}function qt(t,e){e.forEach((n,s)=>{let r=ea(s);t.style[r]=""})}function as(t){return Array.isArray(t)?t.length==1?t[0]:Eh(t):t}function u_(t,e,n){let s=e.params||{},r=Bh(t);r.length&&r.forEach(i=>{s.hasOwnProperty(i)||n.push(Cg(i))})}var Vo=new RegExp(`${Lh}\\s*(.+?)\\s*${a_}`,"g");function Bh(t){let e=[];if(typeof t=="string"){let n;for(;n=Vo.exec(t);)e.push(n[1]);Vo.lastIndex=0}return e}function cs(t,e,n){let s=`${t}`,r=s.replace(Vo,(i,o)=>{let a=e[o];return a==null&&(n.push(Rg(o)),a=""),a.toString()});return r==s?t:r}var h_=/-+([a-z0-9])/g;function ea(t){return t.replace(h_,(...e)=>e[1].toUpperCase())}function d_(t,e){return t===0||e===0}function f_(t,e,n){if(n.size&&e.length){let s=e[0],r=[];if(n.forEach((i,o)=>{s.has(o)||r.push(o),s.set(o,i)}),r.length)for(let i=1;i<e.length;i++){let o=e[i];r.forEach(a=>o.set(a,ta(t,a)))}}return e}function Ae(t,e,n){switch(e.type){case C.Trigger:return t.visitTrigger(e,n);case C.State:return t.visitState(e,n);case C.Transition:return t.visitTransition(e,n);case C.Sequence:return t.visitSequence(e,n);case C.Group:return t.visitGroup(e,n);case C.Animate:return t.visitAnimate(e,n);case C.Keyframes:return t.visitKeyframes(e,n);case C.Style:return t.visitStyle(e,n);case C.Reference:return t.visitReference(e,n);case C.AnimateChild:return t.visitAnimateChild(e,n);case C.AnimateRef:return t.visitAnimateRef(e,n);case C.Query:return t.visitQuery(e,n);case C.Stagger:return t.visitStagger(e,n);default:throw Pg(e.type)}}function ta(t,e){return window.getComputedStyle(t)[e]}var p_=new Set(["width","height","minWidth","minHeight","maxWidth","maxHeight","left","top","bottom","right","fontSize","outlineWidth","outlineOffset","paddingTop","paddingLeft","paddingBottom","paddingRight","marginTop","marginLeft","marginBottom","marginRight","borderRadius","borderWidth","borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth","textIndent","perspective"]),$r=class extends zt{normalizePropertyName(e,n){return ea(e)}normalizeStyleValue(e,n,s,r){let i="",o=s.toString().trim();if(p_.has(n)&&s!==0&&s!=="0")if(typeof s=="number")i="px";else{let a=s.match(/^[+-]?[\d\.]+([a-z]*)$/);a&&a[1].length==0&&r.push(Ng(e,s))}return o+i}};var zr="*";function m_(t,e){let n=[];return typeof t=="string"?t.split(/\s*,\s*/).forEach(s=>g_(s,n,e)):n.push(t),n}function g_(t,e,n){if(t[0]==":"){let l=__(t,n);if(typeof l=="function"){e.push(l);return}t=l}let s=t.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(s==null||s.length<4)return n.push($g(t)),e;let r=s[1],i=s[2],o=s[3];e.push(Ah(r,o));let a=r==zr&&o==zr;i[0]=="<"&&!a&&e.push(Ah(o,r))}function __(t,e){switch(t){case":enter":return"void => *";case":leave":return"* => void";case":increment":return(n,s)=>parseFloat(s)>parseFloat(n);case":decrement":return(n,s)=>parseFloat(s)<parseFloat(n);default:return e.push(zg(t)),"* => *"}}var Fr=new Set(["true","1"]),Vr=new Set(["false","0"]);function Ah(t,e){let n=Fr.has(t)||Vr.has(t),s=Fr.has(e)||Vr.has(e);return(r,i)=>{let o=t==zr||t==r,a=e==zr||e==i;return!o&&n&&typeof r=="boolean"&&(o=r?Fr.has(t):Vr.has(t)),!a&&s&&typeof i=="boolean"&&(a=i?Fr.has(e):Vr.has(e)),o&&a}}var qh=":self",y_=new RegExp(`s*${qh}s*,?`,"g");function $h(t,e,n,s){return new Lo(t).build(e,n,s)}var bh="",Lo=class{constructor(e){this._driver=e}build(e,n,s){let r=new Uo(n);return this._resetContextStyleTimingState(r),Ae(this,as(e),r)}_resetContextStyleTimingState(e){e.currentQuerySelector=bh,e.collectedStyles=new Map,e.collectedStyles.set(bh,new Map),e.currentTime=0}visitTrigger(e,n){let s=n.queryCount=0,r=n.depCount=0,i=[],o=[];return e.name.charAt(0)=="@"&&n.errors.push(Dg()),e.definitions.forEach(a=>{if(this._resetContextStyleTimingState(n),a.type==C.State){let l=a,c=l.name;c.toString().split(/\s*,\s*/).forEach(u=>{l.name=u,i.push(this.visitState(l,n))}),l.name=c}else if(a.type==C.Transition){let l=this.visitTransition(a,n);s+=l.queryCount,r+=l.depCount,o.push(l)}else n.errors.push(kg())}),{type:C.Trigger,name:e.name,states:i,transitions:o,queryCount:s,depCount:r,options:null}}visitState(e,n){let s=this.visitStyle(e.styles,n),r=e.options&&e.options.params||null;if(s.containsDynamicStyles){let i=new Set,o=r||{};s.styles.forEach(a=>{a instanceof Map&&a.forEach(l=>{Bh(l).forEach(c=>{o.hasOwnProperty(c)||i.add(c)})})}),i.size&&n.errors.push(xg(e.name,[...i.values()]))}return{type:C.State,name:e.name,style:s,options:r?{params:r}:null}}visitTransition(e,n){n.queryCount=0,n.depCount=0;let s=Ae(this,as(e.animation),n),r=m_(e.expr,n.errors);return{type:C.Transition,matchers:r,animation:s,queryCount:n.queryCount,depCount:n.depCount,options:Bt(e.options)}}visitSequence(e,n){return{type:C.Sequence,steps:e.steps.map(s=>Ae(this,s,n)),options:Bt(e.options)}}visitGroup(e,n){let s=n.currentTime,r=0,i=e.steps.map(o=>{n.currentTime=s;let a=Ae(this,o,n);return r=Math.max(r,n.currentTime),a});return n.currentTime=r,{type:C.Group,steps:i,options:Bt(e.options)}}visitAnimate(e,n){let s=T_(e.timings,n.errors);n.currentAnimateTimings=s;let r,i=e.styles?e.styles:Co({});if(i.type==C.Keyframes)r=this.visitKeyframes(i,n);else{let o=e.styles,a=!1;if(!o){a=!0;let c={};s.easing&&(c.easing=s.easing),o=Co(c)}n.currentTime+=s.duration+s.delay;let l=this.visitStyle(o,n);l.isEmptyStep=a,r=l}return n.currentAnimateTimings=null,{type:C.Animate,timings:s,style:r,options:null}}visitStyle(e,n){let s=this._makeStyleAst(e,n);return this._validateStyleAst(s,n),s}_makeStyleAst(e,n){let s=[],r=Array.isArray(e.styles)?e.styles:[e.styles];for(let a of r)typeof a=="string"?a===Ye?s.push(a):n.errors.push(Og(a)):s.push(new Map(Object.entries(a)));let i=!1,o=null;return s.forEach(a=>{if(a instanceof Map&&(a.has("easing")&&(o=a.get("easing"),a.delete("easing")),!i)){for(let l of a.values())if(l.toString().indexOf(Lh)>=0){i=!0;break}}}),{type:C.Style,styles:s,easing:o,offset:e.offset,containsDynamicStyles:i,options:null}}_validateStyleAst(e,n){let s=n.currentAnimateTimings,r=n.currentTime,i=n.currentTime;s&&i>0&&(i-=s.duration+s.delay),e.styles.forEach(o=>{typeof o!="string"&&o.forEach((a,l)=>{let c=n.collectedStyles.get(n.currentQuerySelector),u=c.get(l),h=!0;u&&(i!=r&&i>=u.startTime&&r<=u.endTime&&(n.errors.push(Mg(l,u.startTime,u.endTime,i,r)),h=!1),i=u.startTime),h&&c.set(l,{startTime:i,endTime:r}),n.options&&u_(a,n.options,n.errors)})})}visitKeyframes(e,n){let s={type:C.Keyframes,styles:[],options:null};if(!n.currentAnimateTimings)return n.errors.push(Fg()),s;let r=1,i=0,o=[],a=!1,l=!1,c=0,u=e.steps.map(I=>{let N=this._makeStyleAst(I,n),x=N.offset!=null?N.offset:w_(N.styles),E=0;return x!=null&&(i++,E=N.offset=x),l=l||E<0||E>1,a=a||E<c,c=E,o.push(E),N});l&&n.errors.push(Vg()),a&&n.errors.push(Lg());let h=e.steps.length,d=0;i>0&&i<h?n.errors.push(Ug()):i==0&&(d=r/(h-1));let p=h-1,f=n.currentTime,m=n.currentAnimateTimings,y=m.duration;return u.forEach((I,N)=>{let x=d>0?N==p?1:d*N:o[N],E=x*y;n.currentTime=f+m.delay+E,m.duration=E,this._validateStyleAst(I,n),I.offset=x,s.styles.push(I)}),s}visitReference(e,n){return{type:C.Reference,animation:Ae(this,as(e.animation),n),options:Bt(e.options)}}visitAnimateChild(e,n){return n.depCount++,{type:C.AnimateChild,options:Bt(e.options)}}visitAnimateRef(e,n){return{type:C.AnimateRef,animation:this.visitReference(e.animation,n),options:Bt(e.options)}}visitQuery(e,n){let s=n.currentQuerySelector,r=e.options||{};n.queryCount++,n.currentQuery=e;let[i,o]=v_(e.selector);n.currentQuerySelector=s.length?s+" "+i:i,be(n.collectedStyles,n.currentQuerySelector,new Map);let a=Ae(this,as(e.animation),n);return n.currentQuery=null,n.currentQuerySelector=s,{type:C.Query,selector:i,limit:r.limit||0,optional:!!r.optional,includeSelf:o,animation:a,originalSelector:e.selector,options:Bt(e.options)}}visitStagger(e,n){n.currentQuery||n.errors.push(Bg());let s=e.timings==="full"?{duration:0,delay:0,easing:"full"}:qr(e.timings,n.errors,!0);return{type:C.Stagger,animation:Ae(this,as(e.animation),n),timings:s,options:null}}};function v_(t){let e=!!t.split(/\s*,\s*/).find(n=>n==qh);return e&&(t=t.replace(y_,"")),t=t.replace(/@\*/g,Br).replace(/@\w+/g,n=>Br+"-"+n.slice(1)).replace(/:animating/g,Mo),[t,e]}function E_(t){return t?K({},t):null}var Uo=class{constructor(e){this.errors=e,this.queryCount=0,this.depCount=0,this.currentTransition=null,this.currentQuery=null,this.currentQuerySelector=null,this.currentAnimateTimings=null,this.currentTime=0,this.collectedStyles=new Map,this.options=null,this.unsupportedCSSPropertiesFound=new Set}};function w_(t){if(typeof t=="string")return null;let e=null;if(Array.isArray(t))t.forEach(n=>{if(n instanceof Map&&n.has("offset")){let s=n;e=parseFloat(s.get("offset")),s.delete("offset")}});else if(t instanceof Map&&t.has("offset")){let n=t;e=parseFloat(n.get("offset")),n.delete("offset")}return e}function T_(t,e){if(t.hasOwnProperty("duration"))return t;if(typeof t=="number"){let i=qr(t,e).duration;return Po(i,0,"")}let n=t;if(n.split(/\s+/).some(i=>i.charAt(0)=="{"&&i.charAt(1)=="{")){let i=Po(0,0,"");return i.dynamic=!0,i.strValue=n,i}let r=qr(n,e);return Po(r.duration,r.delay,r.easing)}function Bt(t){return t?(t=K({},t),t.params&&(t.params=E_(t.params))):t={},t}function Po(t,e,n){return{duration:t,delay:e,easing:n}}function na(t,e,n,s,r,i,o=null,a=!1){return{type:1,element:t,keyframes:e,preStyleProps:n,postStyleProps:s,duration:r,delay:i,totalTime:r+i,easing:o,subTimeline:a}}var us=class{constructor(){this._map=new Map}get(e){return this._map.get(e)||[]}append(e,n){let s=this._map.get(e);s||this._map.set(e,s=[]),s.push(...n)}has(e){return this._map.has(e)}clear(){this._map.clear()}},I_=1,S_=":enter",A_=new RegExp(S_,"g"),b_=":leave",C_=new RegExp(b_,"g");function zh(t,e,n,s,r,i=new Map,o=new Map,a,l,c=[]){return new Bo().buildKeyframes(t,e,n,s,r,i,o,a,l,c)}var Bo=class{buildKeyframes(e,n,s,r,i,o,a,l,c,u=[]){c=c||new us;let h=new qo(e,n,c,r,i,u,[]);h.options=l;let d=l.delay?ht(l.delay):0;h.currentTimeline.delayNextStep(d),h.currentTimeline.setStyles([o],null,h.errors,l),Ae(this,s,h);let p=h.timelines.filter(f=>f.containsAnimation());if(p.length&&a.size){let f;for(let m=p.length-1;m>=0;m--){let y=p[m];if(y.element===n){f=y;break}}f&&!f.allowOnlyTimelineStyles()&&f.setStyles([a],null,h.errors,l)}return p.length?p.map(f=>f.buildKeyframes()):[na(n,[],[],[],0,d,"",!1)]}visitTrigger(e,n){}visitState(e,n){}visitTransition(e,n){}visitAnimateChild(e,n){let s=n.subInstructions.get(n.element);if(s){let r=n.createSubContext(e.options),i=n.currentTimeline.currentTime,o=this._visitSubInstructions(s,r,r.options);i!=o&&n.transformIntoNewTimeline(o)}n.previousNode=e}visitAnimateRef(e,n){let s=n.createSubContext(e.options);s.transformIntoNewTimeline(),this._applyAnimationRefDelays([e.options,e.animation.options],n,s),this.visitReference(e.animation,s),n.transformIntoNewTimeline(s.currentTimeline.currentTime),n.previousNode=e}_applyAnimationRefDelays(e,n,s){for(let r of e){let i=r?.delay;if(i){let o=typeof i=="number"?i:ht(cs(i,r?.params??{},n.errors));s.delayNextStep(o)}}}_visitSubInstructions(e,n,s){let i=n.currentTimeline.currentTime,o=s.duration!=null?ht(s.duration):null,a=s.delay!=null?ht(s.delay):null;return o!==0&&e.forEach(l=>{let c=n.appendInstructionToTimeline(l,o,a);i=Math.max(i,c.duration+c.delay)}),i}visitReference(e,n){n.updateOptions(e.options,!0),Ae(this,e.animation,n),n.previousNode=e}visitSequence(e,n){let s=n.subContextCount,r=n,i=e.options;if(i&&(i.params||i.delay)&&(r=n.createSubContext(i),r.transformIntoNewTimeline(),i.delay!=null)){r.previousNode.type==C.Style&&(r.currentTimeline.snapshotCurrentStyles(),r.previousNode=jr);let o=ht(i.delay);r.delayNextStep(o)}e.steps.length&&(e.steps.forEach(o=>Ae(this,o,r)),r.currentTimeline.applyStylesToKeyframe(),r.subContextCount>s&&r.transformIntoNewTimeline()),n.previousNode=e}visitGroup(e,n){let s=[],r=n.currentTimeline.currentTime,i=e.options&&e.options.delay?ht(e.options.delay):0;e.steps.forEach(o=>{let a=n.createSubContext(e.options);i&&a.delayNextStep(i),Ae(this,o,a),r=Math.max(r,a.currentTimeline.currentTime),s.push(a.currentTimeline)}),s.forEach(o=>n.currentTimeline.mergeTimelineCollectedStyles(o)),n.transformIntoNewTimeline(r),n.previousNode=e}_visitTiming(e,n){if(e.dynamic){let s=e.strValue,r=n.params?cs(s,n.params,n.errors):s;return qr(r,n.errors)}else return{duration:e.duration,delay:e.delay,easing:e.easing}}visitAnimate(e,n){let s=n.currentAnimateTimings=this._visitTiming(e.timings,n),r=n.currentTimeline;s.delay&&(n.incrementTime(s.delay),r.snapshotCurrentStyles());let i=e.style;i.type==C.Keyframes?this.visitKeyframes(i,n):(n.incrementTime(s.duration),this.visitStyle(i,n),r.applyStylesToKeyframe()),n.currentAnimateTimings=null,n.previousNode=e}visitStyle(e,n){let s=n.currentTimeline,r=n.currentAnimateTimings;!r&&s.hasCurrentStyleProperties()&&s.forwardFrame();let i=r&&r.easing||e.easing;e.isEmptyStep?s.applyEmptyStep(i):s.setStyles(e.styles,i,n.errors,n.options),n.previousNode=e}visitKeyframes(e,n){let s=n.currentAnimateTimings,r=n.currentTimeline.duration,i=s.duration,a=n.createSubContext().currentTimeline;a.easing=s.easing,e.styles.forEach(l=>{let c=l.offset||0;a.forwardTime(c*i),a.setStyles(l.styles,l.easing,n.errors,n.options),a.applyStylesToKeyframe()}),n.currentTimeline.mergeTimelineCollectedStyles(a),n.transformIntoNewTimeline(r+i),n.previousNode=e}visitQuery(e,n){let s=n.currentTimeline.currentTime,r=e.options||{},i=r.delay?ht(r.delay):0;i&&(n.previousNode.type===C.Style||s==0&&n.currentTimeline.hasCurrentStyleProperties())&&(n.currentTimeline.snapshotCurrentStyles(),n.previousNode=jr);let o=s,a=n.invokeQuery(e.selector,e.originalSelector,e.limit,e.includeSelf,!!r.optional,n.errors);n.currentQueryTotal=a.length;let l=null;a.forEach((c,u)=>{n.currentQueryIndex=u;let h=n.createSubContext(e.options,c);i&&h.delayNextStep(i),c===n.element&&(l=h.currentTimeline),Ae(this,e.animation,h),h.currentTimeline.applyStylesToKeyframe();let d=h.currentTimeline.currentTime;o=Math.max(o,d)}),n.currentQueryIndex=0,n.currentQueryTotal=0,n.transformIntoNewTimeline(o),l&&(n.currentTimeline.mergeTimelineCollectedStyles(l),n.currentTimeline.snapshotCurrentStyles()),n.previousNode=e}visitStagger(e,n){let s=n.parentContext,r=n.currentTimeline,i=e.timings,o=Math.abs(i.duration),a=o*(n.currentQueryTotal-1),l=o*n.currentQueryIndex;switch(i.duration<0?"reverse":i.easing){case"reverse":l=a-l;break;case"full":l=s.currentStaggerTime;break}let u=n.currentTimeline;l&&u.delayNextStep(l);let h=u.currentTime;Ae(this,e.animation,n),n.previousNode=e,s.currentStaggerTime=r.currentTime-h+(r.startTime-s.currentTimeline.startTime)}},jr={},qo=class t{constructor(e,n,s,r,i,o,a,l){this._driver=e,this.element=n,this.subInstructions=s,this._enterClassName=r,this._leaveClassName=i,this.errors=o,this.timelines=a,this.parentContext=null,this.currentAnimateTimings=null,this.previousNode=jr,this.subContextCount=0,this.options={},this.currentQueryIndex=0,this.currentQueryTotal=0,this.currentStaggerTime=0,this.currentTimeline=l||new Gr(this._driver,n,0),a.push(this.currentTimeline)}get params(){return this.options.params}updateOptions(e,n){if(!e)return;let s=e,r=this.options;s.duration!=null&&(r.duration=ht(s.duration)),s.delay!=null&&(r.delay=ht(s.delay));let i=s.params;if(i){let o=r.params;o||(o=this.options.params={}),Object.keys(i).forEach(a=>{(!n||!o.hasOwnProperty(a))&&(o[a]=cs(i[a],o,this.errors))})}}_copyOptions(){let e={};if(this.options){let n=this.options.params;if(n){let s=e.params={};Object.keys(n).forEach(r=>{s[r]=n[r]})}}return e}createSubContext(e=null,n,s){let r=n||this.element,i=new t(this._driver,r,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(r,s||0));return i.previousNode=this.previousNode,i.currentAnimateTimings=this.currentAnimateTimings,i.options=this._copyOptions(),i.updateOptions(e),i.currentQueryIndex=this.currentQueryIndex,i.currentQueryTotal=this.currentQueryTotal,i.parentContext=this,this.subContextCount++,i}transformIntoNewTimeline(e){return this.previousNode=jr,this.currentTimeline=this.currentTimeline.fork(this.element,e),this.timelines.push(this.currentTimeline),this.currentTimeline}appendInstructionToTimeline(e,n,s){let r={duration:n??e.duration,delay:this.currentTimeline.currentTime+(s??0)+e.delay,easing:""},i=new $o(this._driver,e.element,e.keyframes,e.preStyleProps,e.postStyleProps,r,e.stretchStartingKeyframe);return this.timelines.push(i),r}incrementTime(e){this.currentTimeline.forwardTime(this.currentTimeline.duration+e)}delayNextStep(e){e>0&&this.currentTimeline.delayNextStep(e)}invokeQuery(e,n,s,r,i,o){let a=[];if(r&&a.push(this.element),e.length>0){e=e.replace(A_,"."+this._enterClassName),e=e.replace(C_,"."+this._leaveClassName);let l=s!=1,c=this._driver.query(this.element,e,l);s!==0&&(c=s<0?c.slice(c.length+s,c.length):c.slice(0,s)),a.push(...c)}return!i&&a.length==0&&o.push(qg(n)),a}},Gr=class t{constructor(e,n,s,r){this._driver=e,this.element=n,this.startTime=s,this._elementTimelineStylesLookup=r,this.duration=0,this.easing=null,this._previousKeyframe=new Map,this._currentKeyframe=new Map,this._keyframes=new Map,this._styleSummary=new Map,this._localTimelineStyles=new Map,this._pendingStyles=new Map,this._backFill=new Map,this._currentEmptyStepKeyframe=null,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(n),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(n,this._localTimelineStyles)),this._loadKeyframe()}containsAnimation(){switch(this._keyframes.size){case 0:return!1;case 1:return this.hasCurrentStyleProperties();default:return!0}}hasCurrentStyleProperties(){return this._currentKeyframe.size>0}get currentTime(){return this.startTime+this.duration}delayNextStep(e){let n=this._keyframes.size===1&&this._pendingStyles.size;this.duration||n?(this.forwardTime(this.currentTime+e),n&&this.snapshotCurrentStyles()):this.startTime+=e}fork(e,n){return this.applyStylesToKeyframe(),new t(this._driver,e,n||this.currentTime,this._elementTimelineStylesLookup)}_loadKeyframe(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=new Map,this._keyframes.set(this.duration,this._currentKeyframe))}forwardFrame(){this.duration+=I_,this._loadKeyframe()}forwardTime(e){this.applyStylesToKeyframe(),this.duration=e,this._loadKeyframe()}_updateStyle(e,n){this._localTimelineStyles.set(e,n),this._globalTimelineStyles.set(e,n),this._styleSummary.set(e,{time:this.currentTime,value:n})}allowOnlyTimelineStyles(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}applyEmptyStep(e){e&&this._previousKeyframe.set("easing",e);for(let[n,s]of this._globalTimelineStyles)this._backFill.set(n,s||Ye),this._currentKeyframe.set(n,Ye);this._currentEmptyStepKeyframe=this._currentKeyframe}setStyles(e,n,s,r){n&&this._previousKeyframe.set("easing",n);let i=r&&r.params||{},o=R_(e,this._globalTimelineStyles);for(let[a,l]of o){let c=cs(l,i,s);this._pendingStyles.set(a,c),this._localTimelineStyles.has(a)||this._backFill.set(a,this._globalTimelineStyles.get(a)??Ye),this._updateStyle(a,c)}}applyStylesToKeyframe(){this._pendingStyles.size!=0&&(this._pendingStyles.forEach((e,n)=>{this._currentKeyframe.set(n,e)}),this._pendingStyles.clear(),this._localTimelineStyles.forEach((e,n)=>{this._currentKeyframe.has(n)||this._currentKeyframe.set(n,e)}))}snapshotCurrentStyles(){for(let[e,n]of this._localTimelineStyles)this._pendingStyles.set(e,n),this._updateStyle(e,n)}getFinalKeyframe(){return this._keyframes.get(this.duration)}get properties(){let e=[];for(let n in this._currentKeyframe)e.push(n);return e}mergeTimelineCollectedStyles(e){e._styleSummary.forEach((n,s)=>{let r=this._styleSummary.get(s);(!r||n.time>r.time)&&this._updateStyle(s,n.value)})}buildKeyframes(){this.applyStylesToKeyframe();let e=new Set,n=new Set,s=this._keyframes.size===1&&this.duration===0,r=[];this._keyframes.forEach((a,l)=>{let c=new Map([...this._backFill,...a]);c.forEach((u,h)=>{u===Or?e.add(h):u===Ye&&n.add(h)}),s||c.set("offset",l/this.duration),r.push(c)});let i=[...e.values()],o=[...n.values()];if(s){let a=r[0],l=new Map(a);a.set("offset",0),l.set("offset",1),r=[a,l]}return na(this.element,r,i,o,this.duration,this.startTime,this.easing,!1)}},$o=class extends Gr{constructor(e,n,s,r,i,o,a=!1){super(e,n,o.delay),this.keyframes=s,this.preStyleProps=r,this.postStyleProps=i,this._stretchStartingKeyframe=a,this.timings={duration:o.duration,delay:o.delay,easing:o.easing}}containsAnimation(){return this.keyframes.length>1}buildKeyframes(){let e=this.keyframes,{delay:n,duration:s,easing:r}=this.timings;if(this._stretchStartingKeyframe&&n){let i=[],o=s+n,a=n/o,l=new Map(e[0]);l.set("offset",0),i.push(l);let c=new Map(e[0]);c.set("offset",Ch(a)),i.push(c);let u=e.length-1;for(let h=1;h<=u;h++){let d=new Map(e[h]),p=d.get("offset"),f=n+p*s;d.set("offset",Ch(f/o)),i.push(d)}s=o,n=0,r="",e=i}return na(this.element,e,this.preStyleProps,this.postStyleProps,s,n,r,!0)}};function Ch(t,e=3){let n=Math.pow(10,e-1);return Math.round(t*n)/n}function R_(t,e){let n=new Map,s;return t.forEach(r=>{if(r==="*"){s??=e.keys();for(let i of s)n.set(i,Ye)}else for(let[i,o]of r)n.set(i,o)}),n}function Rh(t,e,n,s,r,i,o,a,l,c,u,h,d){return{type:0,element:t,triggerName:e,isRemovalTransition:r,fromState:n,fromStyles:i,toState:s,toStyles:o,timelines:a,queriedElements:l,preStyleProps:c,postStyleProps:u,totalTime:h,errors:d}}var No={},Kr=class{constructor(e,n,s){this._triggerName=e,this.ast=n,this._stateStyles=s}match(e,n,s,r){return P_(this.ast.matchers,e,n,s,r)}buildStyles(e,n,s){let r=this._stateStyles.get("*");return e!==void 0&&(r=this._stateStyles.get(e?.toString())||r),r?r.buildStyles(n,s):new Map}build(e,n,s,r,i,o,a,l,c,u){let h=[],d=this.ast.options&&this.ast.options.params||No,p=a&&a.params||No,f=this.buildStyles(s,p,h),m=l&&l.params||No,y=this.buildStyles(r,m,h),I=new Set,N=new Map,x=new Map,E=r==="void",F={params:jh(m,d),delay:this.ast.options?.delay},A=u?[]:zh(e,n,this.ast.animation,i,o,f,y,F,c,h),q=0;return A.forEach(L=>{q=Math.max(L.duration+L.delay,q)}),h.length?Rh(n,this._triggerName,s,r,E,f,y,[],[],N,x,q,h):(A.forEach(L=>{let Me=L.element,nn=be(N,Me,new Set);L.preStyleProps.forEach(Ft=>nn.add(Ft));let pu=be(x,Me,new Set);L.postStyleProps.forEach(Ft=>pu.add(Ft)),Me!==n&&I.add(Me)}),Rh(n,this._triggerName,s,r,E,f,y,A,[...I.values()],N,x,q))}};function P_(t,e,n,s,r){return t.some(i=>i(e,n,s,r))}function jh(t,e){let n=K({},e);return Object.entries(t).forEach(([s,r])=>{r!=null&&(n[s]=r)}),n}var zo=class{constructor(e,n,s){this.styles=e,this.defaultParams=n,this.normalizer=s}buildStyles(e,n){let s=new Map,r=jh(e,this.defaultParams);return this.styles.styles.forEach(i=>{typeof i!="string"&&i.forEach((o,a)=>{o&&(o=cs(o,r,n));let l=this.normalizer.normalizePropertyName(a,n);o=this.normalizer.normalizeStyleValue(a,l,o,n),s.set(a,o)})}),s}};function N_(t,e,n){return new jo(t,e,n)}var jo=class{constructor(e,n,s){this.name=e,this.ast=n,this._normalizer=s,this.transitionFactories=[],this.states=new Map,n.states.forEach(r=>{let i=r.options&&r.options.params||{};this.states.set(r.name,new zo(r.style,i,s))}),Ph(this.states,"true","1"),Ph(this.states,"false","0"),n.transitions.forEach(r=>{this.transitionFactories.push(new Kr(e,r,this.states))}),this.fallbackTransition=D_(e,this.states,this._normalizer)}get containsQueries(){return this.ast.queryCount>0}matchTransition(e,n,s,r){return this.transitionFactories.find(o=>o.match(e,n,s,r))||null}matchStyles(e,n,s){return this.fallbackTransition.buildStyles(e,n,s)}};function D_(t,e,n){let s=[(o,a)=>!0],r={type:C.Sequence,steps:[],options:null},i={type:C.Transition,animation:r,matchers:s,options:null,queryCount:0,depCount:0};return new Kr(t,i,e)}function Ph(t,e,n){t.has(e)?t.has(n)||t.set(n,t.get(e)):t.has(n)&&t.set(e,t.get(n))}var k_=new us,Go=class{constructor(e,n,s){this.bodyNode=e,this._driver=n,this._normalizer=s,this._animations=new Map,this._playersById=new Map,this.players=[]}register(e,n){let s=[],r=[],i=$h(this._driver,n,s,r);if(s.length)throw Kg(s);r.length&&void 0,this._animations.set(e,i)}_buildPlayer(e,n,s){let r=e.element,i=Mh(this._normalizer,e.keyframes,n,s);return this._driver.animate(r,i,e.duration,e.delay,e.easing,[],!0)}create(e,n,s={}){let r=[],i=this._animations.get(e),o,a=new Map;if(i?(o=zh(this._driver,n,i,Uh,Oo,new Map,new Map,s,k_,r),o.forEach(u=>{let h=be(a,u.element,new Map);u.postStyleProps.forEach(d=>h.set(d,null))})):(r.push(Wg()),o=[]),r.length)throw Qg(r);a.forEach((u,h)=>{u.forEach((d,p)=>{u.set(p,this._driver.computeStyle(h,p,Ye))})});let l=o.map(u=>{let h=a.get(u.element);return this._buildPlayer(u,new Map,h)}),c=At(l);return this._playersById.set(e,c),c.onDestroy(()=>this.destroy(e)),this.players.push(c),c}destroy(e){let n=this._getPlayer(e);n.destroy(),this._playersById.delete(e);let s=this.players.indexOf(n);s>=0&&this.players.splice(s,1)}_getPlayer(e){let n=this._playersById.get(e);if(!n)throw Hg(e);return n}listen(e,n,s,r){let i=Xo(n,"","","");return Yo(this._getPlayer(e),s,i,r),()=>{}}command(e,n,s,r){if(s=="register"){this.register(e,r[0]);return}if(s=="create"){let o=r[0]||{};this.create(e,n,o);return}let i=this._getPlayer(e);switch(s){case"play":i.play();break;case"pause":i.pause();break;case"reset":i.reset();break;case"restart":i.restart();break;case"finish":i.finish();break;case"init":i.init();break;case"setPosition":i.setPosition(parseFloat(r[0]));break;case"destroy":this.destroy(e);break}}},Nh="ng-animate-queued",x_=".ng-animate-queued",Do="ng-animate-disabled",O_=".ng-animate-disabled",M_="ng-star-inserted",F_=".ng-star-inserted",V_=[],Gh={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},L_={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0},Ve="__ng_removed",hs=class{get params(){return this.options.params}constructor(e,n=""){this.namespaceId=n;let s=e&&e.hasOwnProperty("value"),r=s?e.value:e;if(this.value=B_(r),s){let i=e,{value:o}=i,a=yu(i,["value"]);this.options=a}else this.options={};this.options.params||(this.options.params={})}absorbOptions(e){let n=e.params;if(n){let s=this.options.params;Object.keys(n).forEach(r=>{s[r]==null&&(s[r]=n[r])})}}},ls="void",ko=new hs(ls),Ko=class{constructor(e,n,s){this.id=e,this.hostElement=n,this._engine=s,this.players=[],this._triggers=new Map,this._queue=[],this._elementListeners=new Map,this._hostClassName="ng-tns-"+e,De(n,this._hostClassName)}listen(e,n,s,r){if(!this._triggers.has(n))throw Yg(s,n);if(s==null||s.length==0)throw Xg(n);if(!q_(s))throw Jg(s,n);let i=be(this._elementListeners,e,[]),o={name:n,phase:s,callback:r};i.push(o);let a=be(this._engine.statesByElement,e,new Map);return a.has(n)||(De(e,Mr),De(e,Mr+"-"+n),a.set(n,ko)),()=>{this._engine.afterFlush(()=>{let l=i.indexOf(o);l>=0&&i.splice(l,1),this._triggers.has(n)||a.delete(n)})}}register(e,n){return this._triggers.has(e)?!1:(this._triggers.set(e,n),!0)}_getTrigger(e){let n=this._triggers.get(e);if(!n)throw Zg(e);return n}trigger(e,n,s,r=!0){let i=this._getTrigger(n),o=new ds(this.id,n,e),a=this._engine.statesByElement.get(e);a||(De(e,Mr),De(e,Mr+"-"+n),this._engine.statesByElement.set(e,a=new Map));let l=a.get(n),c=new hs(s,this.id);if(!(s&&s.hasOwnProperty("value"))&&l&&c.absorbOptions(l.options),a.set(n,c),l||(l=ko),!(c.value===ls)&&l.value===c.value){if(!j_(l.params,c.params)){let m=[],y=i.matchStyles(l.value,l.params,m),I=i.matchStyles(c.value,c.params,m);m.length?this._engine.reportError(m):this._engine.afterFlush(()=>{qt(e,y),Xe(e,I)})}return}let d=be(this._engine.playersByElement,e,[]);d.forEach(m=>{m.namespaceId==this.id&&m.triggerName==n&&m.queued&&m.destroy()});let p=i.matchTransition(l.value,c.value,e,c.params),f=!1;if(!p){if(!r)return;p=i.fallbackTransition,f=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:e,triggerName:n,transition:p,fromState:l,toState:c,player:o,isFallbackTransition:f}),f||(De(e,Nh),o.onStart(()=>{An(e,Nh)})),o.onDone(()=>{let m=this.players.indexOf(o);m>=0&&this.players.splice(m,1);let y=this._engine.playersByElement.get(e);if(y){let I=y.indexOf(o);I>=0&&y.splice(I,1)}}),this.players.push(o),d.push(o),o}deregister(e){this._triggers.delete(e),this._engine.statesByElement.forEach(n=>n.delete(e)),this._elementListeners.forEach((n,s)=>{this._elementListeners.set(s,n.filter(r=>r.name!=e))})}clearElementCache(e){this._engine.statesByElement.delete(e),this._elementListeners.delete(e);let n=this._engine.playersByElement.get(e);n&&(n.forEach(s=>s.destroy()),this._engine.playersByElement.delete(e))}_signalRemovalForInnerTriggers(e,n){let s=this._engine.driver.query(e,Br,!0);s.forEach(r=>{if(r[Ve])return;let i=this._engine.fetchNamespacesByElement(r);i.size?i.forEach(o=>o.triggerLeaveAnimation(r,n,!1,!0)):this.clearElementCache(r)}),this._engine.afterFlushAnimationsDone(()=>s.forEach(r=>this.clearElementCache(r)))}triggerLeaveAnimation(e,n,s,r){let i=this._engine.statesByElement.get(e),o=new Map;if(i){let a=[];if(i.forEach((l,c)=>{if(o.set(c,l.value),this._triggers.has(c)){let u=this.trigger(e,c,ls,r);u&&a.push(u)}}),a.length)return this._engine.markElementAsRemoved(this.id,e,!0,n,o),s&&At(a).onDone(()=>this._engine.processLeaveNode(e)),!0}return!1}prepareLeaveAnimationListeners(e){let n=this._elementListeners.get(e),s=this._engine.statesByElement.get(e);if(n&&s){let r=new Set;n.forEach(i=>{let o=i.name;if(r.has(o))return;r.add(o);let l=this._triggers.get(o).fallbackTransition,c=s.get(o)||ko,u=new hs(ls),h=new ds(this.id,o,e);this._engine.totalQueuedPlayers++,this._queue.push({element:e,triggerName:o,transition:l,fromState:c,toState:u,player:h,isFallbackTransition:!0})})}}removeNode(e,n){let s=this._engine;if(e.childElementCount&&this._signalRemovalForInnerTriggers(e,n),this.triggerLeaveAnimation(e,n,!0))return;let r=!1;if(s.totalAnimations){let i=s.players.length?s.playersByQueriedElement.get(e):[];if(i&&i.length)r=!0;else{let o=e;for(;o=o.parentNode;)if(s.statesByElement.get(o)){r=!0;break}}}if(this.prepareLeaveAnimationListeners(e),r)s.markElementAsRemoved(this.id,e,!1,n);else{let i=e[Ve];(!i||i===Gh)&&(s.afterFlush(()=>this.clearElementCache(e)),s.destroyInnerAnimations(e),s._onRemovalComplete(e,n))}}insertNode(e,n){De(e,this._hostClassName)}drainQueuedTransitions(e){let n=[];return this._queue.forEach(s=>{let r=s.player;if(r.destroyed)return;let i=s.element,o=this._elementListeners.get(i);o&&o.forEach(a=>{if(a.name==s.triggerName){let l=Xo(i,s.triggerName,s.fromState.value,s.toState.value);l._data=e,Yo(s.player,a.phase,l,a.callback)}}),r.markedForDestroy?this._engine.afterFlush(()=>{r.destroy()}):n.push(s)}),this._queue=[],n.sort((s,r)=>{let i=s.transition.ast.depCount,o=r.transition.ast.depCount;return i==0||o==0?i-o:this._engine.driver.containsElement(s.element,r.element)?1:-1})}destroy(e){this.players.forEach(n=>n.destroy()),this._signalRemovalForInnerTriggers(this.hostElement,e)}},Wo=class{_onRemovalComplete(e,n){this.onRemovalComplete(e,n)}constructor(e,n,s,r){this.bodyNode=e,this.driver=n,this._normalizer=s,this.scheduler=r,this.players=[],this.newHostElements=new Map,this.playersByElement=new Map,this.playersByQueriedElement=new Map,this.statesByElement=new Map,this.disabledNodes=new Set,this.totalAnimations=0,this.totalQueuedPlayers=0,this._namespaceLookup={},this._namespaceList=[],this._flushFns=[],this._whenQuietFns=[],this.namespacesByHostElement=new Map,this.collectedEnterElements=[],this.collectedLeaveElements=[],this.onRemovalComplete=(i,o)=>{}}get queuedPlayers(){let e=[];return this._namespaceList.forEach(n=>{n.players.forEach(s=>{s.queued&&e.push(s)})}),e}createNamespace(e,n){let s=new Ko(e,n,this);return this.bodyNode&&this.driver.containsElement(this.bodyNode,n)?this._balanceNamespaceList(s,n):(this.newHostElements.set(n,s),this.collectEnterElement(n)),this._namespaceLookup[e]=s}_balanceNamespaceList(e,n){let s=this._namespaceList,r=this.namespacesByHostElement;if(s.length-1>=0){let o=!1,a=this.driver.getParentElement(n);for(;a;){let l=r.get(a);if(l){let c=s.indexOf(l);s.splice(c+1,0,e),o=!0;break}a=this.driver.getParentElement(a)}o||s.unshift(e)}else s.push(e);return r.set(n,e),e}register(e,n){let s=this._namespaceLookup[e];return s||(s=this.createNamespace(e,n)),s}registerTrigger(e,n,s){let r=this._namespaceLookup[e];r&&r.register(n,s)&&this.totalAnimations++}destroy(e,n){e&&(this.afterFlush(()=>{}),this.afterFlushAnimationsDone(()=>{let s=this._fetchNamespace(e);this.namespacesByHostElement.delete(s.hostElement);let r=this._namespaceList.indexOf(s);r>=0&&this._namespaceList.splice(r,1),s.destroy(n),delete this._namespaceLookup[e]}))}_fetchNamespace(e){return this._namespaceLookup[e]}fetchNamespacesByElement(e){let n=new Set,s=this.statesByElement.get(e);if(s){for(let r of s.values())if(r.namespaceId){let i=this._fetchNamespace(r.namespaceId);i&&n.add(i)}}return n}trigger(e,n,s,r){if(Lr(n)){let i=this._fetchNamespace(e);if(i)return i.trigger(n,s,r),!0}return!1}insertNode(e,n,s,r){if(!Lr(n))return;let i=n[Ve];if(i&&i.setForRemoval){i.setForRemoval=!1,i.setForMove=!0;let o=this.collectedLeaveElements.indexOf(n);o>=0&&this.collectedLeaveElements.splice(o,1)}if(e){let o=this._fetchNamespace(e);o&&o.insertNode(n,s)}r&&this.collectEnterElement(n)}collectEnterElement(e){this.collectedEnterElements.push(e)}markElementAsDisabled(e,n){n?this.disabledNodes.has(e)||(this.disabledNodes.add(e),De(e,Do)):this.disabledNodes.has(e)&&(this.disabledNodes.delete(e),An(e,Do))}removeNode(e,n,s){if(Lr(n)){this.scheduler?.notify();let r=e?this._fetchNamespace(e):null;r?r.removeNode(n,s):this.markElementAsRemoved(e,n,!1,s);let i=this.namespacesByHostElement.get(n);i&&i.id!==e&&i.removeNode(n,s)}else this._onRemovalComplete(n,s)}markElementAsRemoved(e,n,s,r,i){this.collectedLeaveElements.push(n),n[Ve]={namespaceId:e,setForRemoval:r,hasAnimation:s,removedBeforeQueried:!1,previousTriggersValues:i}}listen(e,n,s,r,i){return Lr(n)?this._fetchNamespace(e).listen(n,s,r,i):()=>{}}_buildInstruction(e,n,s,r,i){return e.transition.build(this.driver,e.element,e.fromState.value,e.toState.value,s,r,e.fromState.options,e.toState.options,n,i)}destroyInnerAnimations(e){let n=this.driver.query(e,Br,!0);n.forEach(s=>this.destroyActiveAnimationsForElement(s)),this.playersByQueriedElement.size!=0&&(n=this.driver.query(e,Mo,!0),n.forEach(s=>this.finishActiveQueriedAnimationOnElement(s)))}destroyActiveAnimationsForElement(e){let n=this.playersByElement.get(e);n&&n.forEach(s=>{s.queued?s.markedForDestroy=!0:s.destroy()})}finishActiveQueriedAnimationOnElement(e){let n=this.playersByQueriedElement.get(e);n&&n.forEach(s=>s.finish())}whenRenderingDone(){return new Promise(e=>{if(this.players.length)return At(this.players).onDone(()=>e());e()})}processLeaveNode(e){let n=e[Ve];if(n&&n.setForRemoval){if(e[Ve]=Gh,n.namespaceId){this.destroyInnerAnimations(e);let s=this._fetchNamespace(n.namespaceId);s&&s.clearElementCache(e)}this._onRemovalComplete(e,n.setForRemoval)}e.classList?.contains(Do)&&this.markElementAsDisabled(e,!1),this.driver.query(e,O_,!0).forEach(s=>{this.markElementAsDisabled(s,!1)})}flush(e=-1){let n=[];if(this.newHostElements.size&&(this.newHostElements.forEach((s,r)=>this._balanceNamespaceList(s,r)),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(let s=0;s<this.collectedEnterElements.length;s++){let r=this.collectedEnterElements[s];De(r,M_)}if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){let s=[];try{n=this._flushAnimations(s,e)}finally{for(let r=0;r<s.length;r++)s[r]()}}else for(let s=0;s<this.collectedLeaveElements.length;s++){let r=this.collectedLeaveElements[s];this.processLeaveNode(r)}if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach(s=>s()),this._flushFns=[],this._whenQuietFns.length){let s=this._whenQuietFns;this._whenQuietFns=[],n.length?At(n).onDone(()=>{s.forEach(r=>r())}):s.forEach(r=>r())}}reportError(e){throw e_(e)}_flushAnimations(e,n){let s=new us,r=[],i=new Map,o=[],a=new Map,l=new Map,c=new Map,u=new Set;this.disabledNodes.forEach(v=>{u.add(v);let w=this.driver.query(v,x_,!0);for(let T=0;T<w.length;T++)u.add(w[T])});let h=this.bodyNode,d=Array.from(this.statesByElement.keys()),p=xh(d,this.collectedEnterElements),f=new Map,m=0;p.forEach((v,w)=>{let T=Uh+m++;f.set(w,T),v.forEach(O=>De(O,T))});let y=[],I=new Set,N=new Set;for(let v=0;v<this.collectedLeaveElements.length;v++){let w=this.collectedLeaveElements[v],T=w[Ve];T&&T.setForRemoval&&(y.push(w),I.add(w),T.hasAnimation?this.driver.query(w,F_,!0).forEach(O=>I.add(O)):N.add(w))}let x=new Map,E=xh(d,Array.from(I));E.forEach((v,w)=>{let T=Oo+m++;x.set(w,T),v.forEach(O=>De(O,T))}),e.push(()=>{p.forEach((v,w)=>{let T=f.get(w);v.forEach(O=>An(O,T))}),E.forEach((v,w)=>{let T=x.get(w);v.forEach(O=>An(O,T))}),y.forEach(v=>{this.processLeaveNode(v)})});let F=[],A=[];for(let v=this._namespaceList.length-1;v>=0;v--)this._namespaceList[v].drainQueuedTransitions(n).forEach(T=>{let O=T.player,ne=T.element;if(F.push(O),this.collectedEnterElements.length){let he=ne[Ve];if(he&&he.setForMove){if(he.previousTriggersValues&&he.previousTriggersValues.has(T.triggerName)){let Vt=he.previousTriggersValues.get(T.triggerName),Pe=this.statesByElement.get(T.element);if(Pe&&Pe.has(T.triggerName)){let fr=Pe.get(T.triggerName);fr.value=Vt,Pe.set(T.triggerName,fr)}}O.destroy();return}}let ze=!h||!this.driver.containsElement(h,ne),Se=x.get(ne),Et=f.get(ne),G=this._buildInstruction(T,s,Et,Se,ze);if(G.errors&&G.errors.length){A.push(G);return}if(ze){O.onStart(()=>qt(ne,G.fromStyles)),O.onDestroy(()=>Xe(ne,G.toStyles)),r.push(O);return}if(T.isFallbackTransition){O.onStart(()=>qt(ne,G.fromStyles)),O.onDestroy(()=>Xe(ne,G.toStyles)),r.push(O);return}let _u=[];G.timelines.forEach(he=>{he.stretchStartingKeyframe=!0,this.disabledNodes.has(he.element)||_u.push(he)}),G.timelines=_u,s.append(ne,G.timelines);let Sg={instruction:G,player:O,element:ne};o.push(Sg),G.queriedElements.forEach(he=>be(a,he,[]).push(O)),G.preStyleProps.forEach((he,Vt)=>{if(he.size){let Pe=l.get(Vt);Pe||l.set(Vt,Pe=new Set),he.forEach((fr,_o)=>Pe.add(_o))}}),G.postStyleProps.forEach((he,Vt)=>{let Pe=c.get(Vt);Pe||c.set(Vt,Pe=new Set),he.forEach((fr,_o)=>Pe.add(_o))})});if(A.length){let v=[];A.forEach(w=>{v.push(t_(w.triggerName,w.errors))}),F.forEach(w=>w.destroy()),this.reportError(v)}let q=new Map,L=new Map;o.forEach(v=>{let w=v.element;s.has(w)&&(L.set(w,w),this._beforeAnimationBuild(v.player.namespaceId,v.instruction,q))}),r.forEach(v=>{let w=v.element;this._getPreviousPlayers(w,!1,v.namespaceId,v.triggerName,null).forEach(O=>{be(q,w,[]).push(O),O.destroy()})});let Me=y.filter(v=>Oh(v,l,c)),nn=new Map;kh(nn,this.driver,N,c,Ye).forEach(v=>{Oh(v,l,c)&&Me.push(v)});let Ft=new Map;p.forEach((v,w)=>{kh(Ft,this.driver,new Set(v),l,Or)}),Me.forEach(v=>{let w=nn.get(v),T=Ft.get(v);nn.set(v,new Map([...w?.entries()??[],...T?.entries()??[]]))});let go=[],mu=[],gu={};o.forEach(v=>{let{element:w,player:T,instruction:O}=v;if(s.has(w)){if(u.has(w)){T.onDestroy(()=>Xe(w,O.toStyles)),T.disabled=!0,T.overrideTotalTime(O.totalTime),r.push(T);return}let ne=gu;if(L.size>1){let Se=w,Et=[];for(;Se=Se.parentNode;){let G=L.get(Se);if(G){ne=G;break}Et.push(Se)}Et.forEach(G=>L.set(G,ne))}let ze=this._buildAnimation(T.namespaceId,O,q,i,Ft,nn);if(T.setRealPlayer(ze),ne===gu)go.push(T);else{let Se=this.playersByElement.get(ne);Se&&Se.length&&(T.parentPlayer=At(Se)),r.push(T)}}else qt(w,O.fromStyles),T.onDestroy(()=>Xe(w,O.toStyles)),mu.push(T),u.has(w)&&r.push(T)}),mu.forEach(v=>{let w=i.get(v.element);if(w&&w.length){let T=At(w);v.setRealPlayer(T)}}),r.forEach(v=>{v.parentPlayer?v.syncPlayerEvents(v.parentPlayer):v.destroy()});for(let v=0;v<y.length;v++){let w=y[v],T=w[Ve];if(An(w,Oo),T&&T.hasAnimation)continue;let O=[];if(a.size){let ze=a.get(w);ze&&ze.length&&O.push(...ze);let Se=this.driver.query(w,Mo,!0);for(let Et=0;Et<Se.length;Et++){let G=a.get(Se[Et]);G&&G.length&&O.push(...G)}}let ne=O.filter(ze=>!ze.destroyed);ne.length?$_(this,w,ne):this.processLeaveNode(w)}return y.length=0,go.forEach(v=>{this.players.push(v),v.onDone(()=>{v.destroy();let w=this.players.indexOf(v);this.players.splice(w,1)}),v.play()}),go}afterFlush(e){this._flushFns.push(e)}afterFlushAnimationsDone(e){this._whenQuietFns.push(e)}_getPreviousPlayers(e,n,s,r,i){let o=[];if(n){let a=this.playersByQueriedElement.get(e);a&&(o=a)}else{let a=this.playersByElement.get(e);if(a){let l=!i||i==ls;a.forEach(c=>{c.queued||!l&&c.triggerName!=r||o.push(c)})}}return(s||r)&&(o=o.filter(a=>!(s&&s!=a.namespaceId||r&&r!=a.triggerName))),o}_beforeAnimationBuild(e,n,s){let r=n.triggerName,i=n.element,o=n.isRemovalTransition?void 0:e,a=n.isRemovalTransition?void 0:r;for(let l of n.timelines){let c=l.element,u=c!==i,h=be(s,c,[]);this._getPreviousPlayers(c,u,o,a,n.toState).forEach(p=>{let f=p.getRealPlayer();f.beforeDestroy&&f.beforeDestroy(),p.destroy(),h.push(p)})}qt(i,n.fromStyles)}_buildAnimation(e,n,s,r,i,o){let a=n.triggerName,l=n.element,c=[],u=new Set,h=new Set,d=n.timelines.map(f=>{let m=f.element;u.add(m);let y=m[Ve];if(y&&y.removedBeforeQueried)return new St(f.duration,f.delay);let I=m!==l,N=z_((s.get(m)||V_).map(q=>q.getRealPlayer())).filter(q=>{let L=q;return L.element?L.element===m:!1}),x=i.get(m),E=o.get(m),F=Mh(this._normalizer,f.keyframes,x,E),A=this._buildPlayer(f,F,N);if(f.subTimeline&&r&&h.add(m),I){let q=new ds(e,a,m);q.setRealPlayer(A),c.push(q)}return A});c.forEach(f=>{be(this.playersByQueriedElement,f.element,[]).push(f),f.onDone(()=>U_(this.playersByQueriedElement,f.element,f))}),u.forEach(f=>De(f,Sh));let p=At(d);return p.onDestroy(()=>{u.forEach(f=>An(f,Sh)),Xe(l,n.toStyles)}),h.forEach(f=>{be(r,f,[]).push(p)}),p}_buildPlayer(e,n,s){return n.length>0?this.driver.animate(e.element,n,e.duration,e.delay,e.easing,s):new St(e.duration,e.delay)}},ds=class{constructor(e,n,s){this.namespaceId=e,this.triggerName=n,this.element=s,this._player=new St,this._containsRealPlayer=!1,this._queuedCallbacks=new Map,this.destroyed=!1,this.parentPlayer=null,this.markedForDestroy=!1,this.disabled=!1,this.queued=!0,this.totalTime=0}setRealPlayer(e){this._containsRealPlayer||(this._player=e,this._queuedCallbacks.forEach((n,s)=>{n.forEach(r=>Yo(e,s,void 0,r))}),this._queuedCallbacks.clear(),this._containsRealPlayer=!0,this.overrideTotalTime(e.totalTime),this.queued=!1)}getRealPlayer(){return this._player}overrideTotalTime(e){this.totalTime=e}syncPlayerEvents(e){let n=this._player;n.triggerCallback&&e.onStart(()=>n.triggerCallback("start")),e.onDone(()=>this.finish()),e.onDestroy(()=>this.destroy())}_queueEvent(e,n){be(this._queuedCallbacks,e,[]).push(n)}onDone(e){this.queued&&this._queueEvent("done",e),this._player.onDone(e)}onStart(e){this.queued&&this._queueEvent("start",e),this._player.onStart(e)}onDestroy(e){this.queued&&this._queueEvent("destroy",e),this._player.onDestroy(e)}init(){this._player.init()}hasStarted(){return this.queued?!1:this._player.hasStarted()}play(){!this.queued&&this._player.play()}pause(){!this.queued&&this._player.pause()}restart(){!this.queued&&this._player.restart()}finish(){this._player.finish()}destroy(){this.destroyed=!0,this._player.destroy()}reset(){!this.queued&&this._player.reset()}setPosition(e){this.queued||this._player.setPosition(e)}getPosition(){return this.queued?0:this._player.getPosition()}triggerCallback(e){let n=this._player;n.triggerCallback&&n.triggerCallback(e)}};function U_(t,e,n){let s=t.get(e);if(s){if(s.length){let r=s.indexOf(n);s.splice(r,1)}s.length==0&&t.delete(e)}return s}function B_(t){return t??null}function Lr(t){return t&&t.nodeType===1}function q_(t){return t=="start"||t=="done"}function Dh(t,e){let n=t.style.display;return t.style.display=e??"none",n}function kh(t,e,n,s,r){let i=[];n.forEach(l=>i.push(Dh(l)));let o=[];s.forEach((l,c)=>{let u=new Map;l.forEach(h=>{let d=e.computeStyle(c,h,r);u.set(h,d),(!d||d.length==0)&&(c[Ve]=L_,o.push(c))}),t.set(c,u)});let a=0;return n.forEach(l=>Dh(l,i[a++])),o}function xh(t,e){let n=new Map;if(t.forEach(a=>n.set(a,[])),e.length==0)return n;let s=1,r=new Set(e),i=new Map;function o(a){if(!a)return s;let l=i.get(a);if(l)return l;let c=a.parentNode;return n.has(c)?l=c:r.has(c)?l=s:l=o(c),i.set(a,l),l}return e.forEach(a=>{let l=o(a);l!==s&&n.get(l).push(a)}),n}function De(t,e){t.classList?.add(e)}function An(t,e){t.classList?.remove(e)}function $_(t,e,n){At(n).onDone(()=>t.processLeaveNode(e))}function z_(t){let e=[];return Kh(t,e),e}function Kh(t,e){for(let n=0;n<t.length;n++){let s=t[n];s instanceof os?Kh(s.players,e):e.push(s)}}function j_(t,e){let n=Object.keys(t),s=Object.keys(e);if(n.length!=s.length)return!1;for(let r=0;r<n.length;r++){let i=n[r];if(!e.hasOwnProperty(i)||t[i]!==e[i])return!1}return!0}function Oh(t,e,n){let s=n.get(t);if(!s)return!1;let r=e.get(t);return r?s.forEach(i=>r.add(i)):e.set(t,s),n.delete(t),!0}var Cn=class{constructor(e,n,s,r){this._driver=n,this._normalizer=s,this._triggerCache={},this.onRemovalComplete=(i,o)=>{},this._transitionEngine=new Wo(e.body,n,s,r),this._timelineEngine=new Go(e.body,n,s),this._transitionEngine.onRemovalComplete=(i,o)=>this.onRemovalComplete(i,o)}registerTrigger(e,n,s,r,i){let o=e+"-"+r,a=this._triggerCache[o];if(!a){let l=[],c=[],u=$h(this._driver,i,l,c);if(l.length)throw jg(r,l);c.length&&void 0,a=N_(r,u,this._normalizer),this._triggerCache[o]=a}this._transitionEngine.registerTrigger(n,r,a)}register(e,n){this._transitionEngine.register(e,n)}destroy(e,n){this._transitionEngine.destroy(e,n)}onInsert(e,n,s,r){this._transitionEngine.insertNode(e,n,s,r)}onRemove(e,n,s){this._transitionEngine.removeNode(e,n,s)}disableAnimations(e,n){this._transitionEngine.markElementAsDisabled(e,n)}process(e,n,s,r){if(s.charAt(0)=="@"){let[i,o]=Th(s),a=r;this._timelineEngine.command(i,n,o,a)}else this._transitionEngine.trigger(e,n,s,r)}listen(e,n,s,r,i){if(s.charAt(0)=="@"){let[o,a]=Th(s);return this._timelineEngine.listen(o,n,a,i)}return this._transitionEngine.listen(e,n,s,r,i)}flush(e=-1){this._transitionEngine.flush(e)}get players(){return[...this._transitionEngine.players,...this._timelineEngine.players]}whenRenderingDone(){return this._transitionEngine.whenRenderingDone()}afterFlushAnimationsDone(e){this._transitionEngine.afterFlushAnimationsDone(e)}};function G_(t,e){let n=null,s=null;return Array.isArray(e)&&e.length?(n=xo(e[0]),e.length>1&&(s=xo(e[e.length-1]))):e instanceof Map&&(n=xo(e)),n||s?new Qo(t,n,s):null}var bn=class bn{constructor(e,n,s){this._element=e,this._startStyles=n,this._endStyles=s,this._state=0;let r=bn.initialStylesByElement.get(e);r||bn.initialStylesByElement.set(e,r=new Map),this._initialStyles=r}start(){this._state<1&&(this._startStyles&&Xe(this._element,this._startStyles,this._initialStyles),this._state=1)}finish(){this.start(),this._state<2&&(Xe(this._element,this._initialStyles),this._endStyles&&(Xe(this._element,this._endStyles),this._endStyles=null),this._state=1)}destroy(){this.finish(),this._state<3&&(bn.initialStylesByElement.delete(this._element),this._startStyles&&(qt(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(qt(this._element,this._endStyles),this._endStyles=null),Xe(this._element,this._initialStyles),this._state=3)}};bn.initialStylesByElement=new WeakMap;var Qo=bn;function xo(t){let e=null;return t.forEach((n,s)=>{K_(s)&&(e=e||new Map,e.set(s,n))}),e}function K_(t){return t==="display"||t==="position"}var Wr=class{constructor(e,n,s,r){this.element=e,this.keyframes=n,this.options=s,this._specialStyles=r,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._initialized=!1,this._finished=!1,this._started=!1,this._destroyed=!1,this._originalOnDoneFns=[],this._originalOnStartFns=[],this.time=0,this.parentPlayer=null,this.currentSnapshot=new Map,this._duration=s.duration,this._delay=s.delay||0,this.time=this._duration+this._delay}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}init(){this._buildPlayer(),this._preparePlayerBeforeStart()}_buildPlayer(){if(this._initialized)return;this._initialized=!0;let e=this.keyframes;this.domPlayer=this._triggerWebAnimation(this.element,e,this.options),this._finalKeyframe=e.length?e[e.length-1]:new Map;let n=()=>this._onFinish();this.domPlayer.addEventListener("finish",n),this.onDestroy(()=>{this.domPlayer.removeEventListener("finish",n)})}_preparePlayerBeforeStart(){this._delay?this._resetDomPlayerState():this.domPlayer.pause()}_convertKeyframesToObject(e){let n=[];return e.forEach(s=>{n.push(Object.fromEntries(s))}),n}_triggerWebAnimation(e,n,s){return e.animate(this._convertKeyframesToObject(n),s)}onStart(e){this._originalOnStartFns.push(e),this._onStartFns.push(e)}onDone(e){this._originalOnDoneFns.push(e),this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}play(){this._buildPlayer(),this.hasStarted()||(this._onStartFns.forEach(e=>e()),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),this.domPlayer.play()}pause(){this.init(),this.domPlayer.pause()}finish(){this.init(),this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish()}reset(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}_resetDomPlayerState(){this.domPlayer&&this.domPlayer.cancel()}restart(){this.reset(),this.play()}hasStarted(){return this._started}destroy(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}setPosition(e){this.domPlayer===void 0&&this.init(),this.domPlayer.currentTime=e*this.time}getPosition(){return+(this.domPlayer.currentTime??0)/this.time}get totalTime(){return this._delay+this._duration}beforeDestroy(){let e=new Map;this.hasStarted()&&this._finalKeyframe.forEach((s,r)=>{r!=="offset"&&e.set(r,this._finished?s:ta(this.element,r))}),this.currentSnapshot=e}triggerCallback(e){let n=e==="start"?this._onStartFns:this._onDoneFns;n.forEach(s=>s()),n.length=0}},Qr=class{validateStyleProperty(e){return!0}validateAnimatableStyleProperty(e){return!0}matchesElement(e,n){return!1}containsElement(e,n){return Fh(e,n)}getParentElement(e){return Jo(e)}query(e,n,s){return Vh(e,n,s)}computeStyle(e,n,s){return ta(e,n)}animate(e,n,s,r,i,o=[]){let a=r==0?"both":"forwards",l={duration:s,delay:r,fill:a};i&&(l.easing=i);let c=new Map,u=o.filter(p=>p instanceof Wr);d_(s,r)&&u.forEach(p=>{p.currentSnapshot.forEach((f,m)=>c.set(m,f))});let h=c_(n).map(p=>new Map(p));h=f_(e,h,c);let d=G_(e,h);return new Wr(e,h,l,d)}};var Ur="@",Wh="@.disabled",Hr=class{constructor(e,n,s,r){this.namespaceId=e,this.delegate=n,this.engine=s,this._onDestroy=r,this.\u0275type=0}get data(){return this.delegate.data}destroyNode(e){this.delegate.destroyNode?.(e)}destroy(){this.engine.destroy(this.namespaceId,this.delegate),this.engine.afterFlushAnimationsDone(()=>{queueMicrotask(()=>{this.delegate.destroy()})}),this._onDestroy?.()}createElement(e,n){return this.delegate.createElement(e,n)}createComment(e){return this.delegate.createComment(e)}createText(e){return this.delegate.createText(e)}appendChild(e,n){this.delegate.appendChild(e,n),this.engine.onInsert(this.namespaceId,n,e,!1)}insertBefore(e,n,s,r=!0){this.delegate.insertBefore(e,n,s),this.engine.onInsert(this.namespaceId,n,e,r)}removeChild(e,n,s){this.engine.onRemove(this.namespaceId,n,this.delegate)}selectRootElement(e,n){return this.delegate.selectRootElement(e,n)}parentNode(e){return this.delegate.parentNode(e)}nextSibling(e){return this.delegate.nextSibling(e)}setAttribute(e,n,s,r){this.delegate.setAttribute(e,n,s,r)}removeAttribute(e,n,s){this.delegate.removeAttribute(e,n,s)}addClass(e,n){this.delegate.addClass(e,n)}removeClass(e,n){this.delegate.removeClass(e,n)}setStyle(e,n,s,r){this.delegate.setStyle(e,n,s,r)}removeStyle(e,n,s){this.delegate.removeStyle(e,n,s)}setProperty(e,n,s){n.charAt(0)==Ur&&n==Wh?this.disableAnimations(e,!!s):this.delegate.setProperty(e,n,s)}setValue(e,n){this.delegate.setValue(e,n)}listen(e,n,s){return this.delegate.listen(e,n,s)}disableAnimations(e,n){this.engine.disableAnimations(e,n)}},Ho=class extends Hr{constructor(e,n,s,r,i){super(n,s,r,i),this.factory=e,this.namespaceId=n}setProperty(e,n,s){n.charAt(0)==Ur?n.charAt(1)=="."&&n==Wh?(s=s===void 0?!0:!!s,this.disableAnimations(e,s)):this.engine.process(this.namespaceId,e,n.slice(1),s):this.delegate.setProperty(e,n,s)}listen(e,n,s){if(n.charAt(0)==Ur){let r=W_(e),i=n.slice(1),o="";return i.charAt(0)!=Ur&&([i,o]=Q_(i)),this.engine.listen(this.namespaceId,r,i,o,a=>{let l=a._data||-1;this.factory.scheduleListenerCallback(l,s,a)})}return this.delegate.listen(e,n,s)}};function W_(t){switch(t){case"body":return document.body;case"document":return document;case"window":return window;default:return t}}function Q_(t){let e=t.indexOf("."),n=t.substring(0,e),s=t.slice(e+1);return[n,s]}var Yr=class{constructor(e,n,s){this.delegate=e,this.engine=n,this._zone=s,this._currentId=0,this._microtaskId=1,this._animationCallbacksBuffer=[],this._rendererCache=new Map,this._cdRecurDepth=0,n.onRemovalComplete=(r,i)=>{let o=i?.parentNode(r);o&&i.removeChild(o,r)}}createRenderer(e,n){let s="",r=this.delegate.createRenderer(e,n);if(!e||!n?.data?.animation){let c=this._rendererCache,u=c.get(r);if(!u){let h=()=>c.delete(r);u=new Hr(s,r,this.engine,h),c.set(r,u)}return u}let i=n.id,o=n.id+"-"+this._currentId;this._currentId++,this.engine.register(o,e);let a=c=>{Array.isArray(c)?c.forEach(a):this.engine.registerTrigger(i,o,e,c.name,c)};return n.data.animation.forEach(a),new Ho(this,o,r,this.engine)}begin(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}_scheduleCountTask(){queueMicrotask(()=>{this._microtaskId++})}scheduleListenerCallback(e,n,s){if(e>=0&&e<this._microtaskId){this._zone.run(()=>n(s));return}let r=this._animationCallbacksBuffer;r.length==0&&queueMicrotask(()=>{this._zone.run(()=>{r.forEach(i=>{let[o,a]=i;o(a)}),this._animationCallbacksBuffer=[]})}),r.push([n,s])}end(){this._cdRecurDepth--,this._cdRecurDepth==0&&this._zone.runOutsideAngular(()=>{this._scheduleCountTask(),this.engine.flush(this._microtaskId)}),this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.engine.whenRenderingDone()}};var Y_=(()=>{let e=class e extends Cn{constructor(s,r,i){super(s,r,i,$(Mu,{optional:!0}))}ngOnDestroy(){this.flush()}};e.\u0275fac=function(r){return new(r||e)(Q(zu),Q($t),Q(zt))},e.\u0275prov=W({token:e,factory:e.\u0275fac});let t=e;return t})();function X_(){return new $r}function J_(t,e,n){return new Yr(t,e,n)}var Qh=[{provide:zt,useFactory:X_},{provide:Cn,useClass:Y_},{provide:Fu,useFactory:J_,deps:[ju,Cn,Ge]}],Z_=[{provide:$t,useFactory:()=>new Qr},{provide:Eo,useValue:"BrowserAnimations"},...Qh],UI=[{provide:$t,useClass:Zo},{provide:Eo,useValue:"NoopAnimations"},...Qh];function Hh(){return Vu("NgEagerAnimations"),[...Z_]}var Yh={firebaseConfig:{apiKey:"AIzaSyBGVGYRAZFP5Q5pTrBmcqufoAUpIw27SlM",authDomain:"pil-addc9.firebaseapp.com",projectId:"pil-addc9",storageBucket:"pil-addc9.appspot.com",databaseURL:"https://pil-addc9-default-rtdb.europe-west1.firebasedatabase.app",messagingSenderId:"801219582636",appId:"1:801219582636:web:145dbe3d8a4b8da461dd09",measurementId:"G-XEW4C6GCCK"}};var ey=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Ue={},_,Aa=Aa||{},S=ey||self;function ui(t){var e=typeof t;return e=e!="object"?e:t?Array.isArray(t)?"array":e:"null",e=="array"||e=="object"&&typeof t.length=="number"}function bs(t){var e=typeof t;return e=="object"&&t!=null||e=="function"}function ty(t){return Object.prototype.hasOwnProperty.call(t,ra)&&t[ra]||(t[ra]=++ny)}var ra="closure_uid_"+(1e9*Math.random()>>>0),ny=0;function sy(t,e,n){return t.call.apply(t.bind,arguments)}function ry(t,e,n){if(!t)throw Error();if(2<arguments.length){var s=Array.prototype.slice.call(arguments,2);return function(){var r=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(r,s),t.apply(e,r)}}return function(){return t.apply(e,arguments)}}function fe(t,e,n){return Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?fe=sy:fe=ry,fe.apply(null,arguments)}function Xr(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var s=n.slice();return s.push.apply(s,arguments),t.apply(this,s)}}function re(t,e){function n(){}n.prototype=e.prototype,t.$=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.ac=function(s,r,i){for(var o=Array(arguments.length-2),a=2;a<arguments.length;a++)o[a-2]=arguments[a];return e.prototype[r].apply(s,o)}}function bt(){this.s=this.s,this.o=this.o}var iy=0;bt.prototype.s=!1;bt.prototype.sa=function(){!this.s&&(this.s=!0,this.N(),iy!=0)&&ty(this)};bt.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};var cd=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if(typeof t=="string")return typeof e!="string"||e.length!=1?-1:t.indexOf(e,0);for(let n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1};function ba(t){let e=t.length;if(0<e){let n=Array(e);for(let s=0;s<e;s++)n[s]=t[s];return n}return[]}function Xh(t,e){for(let n=1;n<arguments.length;n++){let s=arguments[n];if(ui(s)){let r=t.length||0,i=s.length||0;t.length=r+i;for(let o=0;o<i;o++)t[r+o]=s[o]}else t.push(s)}}function pe(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}pe.prototype.h=function(){this.defaultPrevented=!0};var oy=function(){if(!S.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{let n=()=>{};S.addEventListener("test",n,e),S.removeEventListener("test",n,e)}catch{}return t}();function ys(t){return/^[\s\xa0]*$/.test(t)}function hi(){var t=S.navigator;return t&&(t=t.userAgent)?t:""}function Je(t){return hi().indexOf(t)!=-1}function Ca(t){return Ca[" "](t),t}Ca[" "]=function(){};function ay(t,e){var n=Hy;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t)}var ly=Je("Opera"),Dn=Je("Trident")||Je("MSIE"),ud=Je("Edge"),ca=ud||Dn,hd=Je("Gecko")&&!(hi().toLowerCase().indexOf("webkit")!=-1&&!Je("Edge"))&&!(Je("Trident")||Je("MSIE"))&&!Je("Edge"),cy=hi().toLowerCase().indexOf("webkit")!=-1&&!Je("Edge");function dd(){var t=S.document;return t?t.documentMode:void 0}var ua;e:{if(Jr="",Zr=function(){var t=hi();if(hd)return/rv:([^\);]+)(\)|;)/.exec(t);if(ud)return/Edge\/([\d\.]+)/.exec(t);if(Dn)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(t);if(cy)return/WebKit\/(\S+)/.exec(t);if(ly)return/(?:Version)[ \/]?(\S+)/.exec(t)}(),Zr&&(Jr=Zr?Zr[1]:""),Dn&&(ei=dd(),ei!=null&&ei>parseFloat(Jr))){ua=String(ei);break e}ua=Jr}var Jr,Zr,ei,ha;S.document&&Dn?(ia=dd(),ha=ia||parseInt(ua,10)||void 0):ha=void 0;var ia,uy=ha;function vs(t,e){if(pe.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var n=this.type=t.type,s=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(hd){e:{try{Ca(e.nodeName);var r=!0;break e}catch{}r=!1}r||(e=null)}}else n=="mouseover"?e=t.fromElement:n=="mouseout"&&(e=t.toElement);this.relatedTarget=e,s?(this.clientX=s.clientX!==void 0?s.clientX:s.pageX,this.clientY=s.clientY!==void 0?s.clientY:s.pageY,this.screenX=s.screenX||0,this.screenY=s.screenY||0):(this.clientX=t.clientX!==void 0?t.clientX:t.pageX,this.clientY=t.clientY!==void 0?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType=typeof t.pointerType=="string"?t.pointerType:hy[t.pointerType]||"",this.state=t.state,this.i=t,t.defaultPrevented&&vs.$.h.call(this)}}re(vs,pe);var hy={2:"touch",3:"pen",4:"mouse"};vs.prototype.h=function(){vs.$.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var Cs="closure_listenable_"+(1e6*Math.random()|0),dy=0;function fy(t,e,n,s,r){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!s,this.la=r,this.key=++dy,this.fa=this.ia=!1}function di(t){t.fa=!0,t.listener=null,t.proxy=null,t.src=null,t.la=null}function Ra(t,e,n){for(let s in t)e.call(n,t[s],s,t)}function py(t,e){for(let n in t)e.call(void 0,t[n],n,t)}function fd(t){let e={};for(let n in t)e[n]=t[n];return e}var Jh="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function pd(t,e){let n,s;for(let r=1;r<arguments.length;r++){s=arguments[r];for(n in s)t[n]=s[n];for(let i=0;i<Jh.length;i++)n=Jh[i],Object.prototype.hasOwnProperty.call(s,n)&&(t[n]=s[n])}}function fi(t){this.src=t,this.g={},this.h=0}fi.prototype.add=function(t,e,n,s,r){var i=t.toString();t=this.g[i],t||(t=this.g[i]=[],this.h++);var o=fa(t,e,s,r);return-1<o?(e=t[o],n||(e.ia=!1)):(e=new fy(e,this.src,i,!!s,r),e.ia=n,t.push(e)),e};function da(t,e){var n=e.type;if(n in t.g){var s=t.g[n],r=cd(s,e),i;(i=0<=r)&&Array.prototype.splice.call(s,r,1),i&&(di(e),t.g[n].length==0&&(delete t.g[n],t.h--))}}function fa(t,e,n,s){for(var r=0;r<t.length;++r){var i=t[r];if(!i.fa&&i.listener==e&&i.capture==!!n&&i.la==s)return r}return-1}var Pa="closure_lm_"+(1e6*Math.random()|0),oa={};function md(t,e,n,s,r){if(s&&s.once)return _d(t,e,n,s,r);if(Array.isArray(e)){for(var i=0;i<e.length;i++)md(t,e[i],n,s,r);return null}return n=ka(n),t&&t[Cs]?t.O(e,n,bs(s)?!!s.capture:!!s,r):gd(t,e,n,!1,s,r)}function gd(t,e,n,s,r,i){if(!e)throw Error("Invalid event type");var o=bs(r)?!!r.capture:!!r,a=Da(t);if(a||(t[Pa]=a=new fi(t)),n=a.add(e,n,s,o,i),n.proxy)return n;if(s=my(),n.proxy=s,s.src=t,s.listener=n,t.addEventListener)oy||(r=o),r===void 0&&(r=!1),t.addEventListener(e.toString(),s,r);else if(t.attachEvent)t.attachEvent(vd(e.toString()),s);else if(t.addListener&&t.removeListener)t.addListener(s);else throw Error("addEventListener and attachEvent are unavailable.");return n}function my(){function t(n){return e.call(t.src,t.listener,n)}let e=gy;return t}function _d(t,e,n,s,r){if(Array.isArray(e)){for(var i=0;i<e.length;i++)_d(t,e[i],n,s,r);return null}return n=ka(n),t&&t[Cs]?t.P(e,n,bs(s)?!!s.capture:!!s,r):gd(t,e,n,!0,s,r)}function yd(t,e,n,s,r){if(Array.isArray(e))for(var i=0;i<e.length;i++)yd(t,e[i],n,s,r);else s=bs(s)?!!s.capture:!!s,n=ka(n),t&&t[Cs]?(t=t.i,e=String(e).toString(),e in t.g&&(i=t.g[e],n=fa(i,n,s,r),-1<n&&(di(i[n]),Array.prototype.splice.call(i,n,1),i.length==0&&(delete t.g[e],t.h--)))):t&&(t=Da(t))&&(e=t.g[e.toString()],t=-1,e&&(t=fa(e,n,s,r)),(n=-1<t?e[t]:null)&&Na(n))}function Na(t){if(typeof t!="number"&&t&&!t.fa){var e=t.src;if(e&&e[Cs])da(e.i,t);else{var n=t.type,s=t.proxy;e.removeEventListener?e.removeEventListener(n,s,t.capture):e.detachEvent?e.detachEvent(vd(n),s):e.addListener&&e.removeListener&&e.removeListener(s),(n=Da(e))?(da(n,t),n.h==0&&(n.src=null,e[Pa]=null)):di(t)}}}function vd(t){return t in oa?oa[t]:oa[t]="on"+t}function gy(t,e){if(t.fa)t=!0;else{e=new vs(e,this);var n=t.listener,s=t.la||t.src;t.ia&&Na(t),t=n.call(s,e)}return t}function Da(t){return t=t[Pa],t instanceof fi?t:null}var aa="__closure_events_fn_"+(1e9*Math.random()>>>0);function ka(t){return typeof t=="function"?t:(t[aa]||(t[aa]=function(e){return t.handleEvent(e)}),t[aa])}function se(){bt.call(this),this.i=new fi(this),this.S=this,this.J=null}re(se,bt);se.prototype[Cs]=!0;se.prototype.removeEventListener=function(t,e,n,s){yd(this,t,e,n,s)};function ce(t,e){var n,s=t.J;if(s)for(n=[];s;s=s.J)n.push(s);if(t=t.S,s=e.type||e,typeof e=="string")e=new pe(e,t);else if(e instanceof pe)e.target=e.target||t;else{var r=e;e=new pe(s,t),pd(e,r)}if(r=!0,n)for(var i=n.length-1;0<=i;i--){var o=e.g=n[i];r=ti(o,s,!0,e)&&r}if(o=e.g=t,r=ti(o,s,!0,e)&&r,r=ti(o,s,!1,e)&&r,n)for(i=0;i<n.length;i++)o=e.g=n[i],r=ti(o,s,!1,e)&&r}se.prototype.N=function(){if(se.$.N.call(this),this.i){var t=this.i,e;for(e in t.g){for(var n=t.g[e],s=0;s<n.length;s++)di(n[s]);delete t.g[e],t.h--}}this.J=null};se.prototype.O=function(t,e,n,s){return this.i.add(String(t),e,!1,n,s)};se.prototype.P=function(t,e,n,s){return this.i.add(String(t),e,!0,n,s)};function ti(t,e,n,s){if(e=t.i.g[String(e)],!e)return!0;e=e.concat();for(var r=!0,i=0;i<e.length;++i){var o=e[i];if(o&&!o.fa&&o.capture==n){var a=o.listener,l=o.la||o.src;o.ia&&da(t.i,o),r=a.call(l,s)!==!1&&r}}return r&&!s.defaultPrevented}var xa=S.JSON.stringify,pa=class{constructor(e,n){this.i=e,this.j=n,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}};function _y(){var t=Oa;let e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}var ma=class{constructor(){this.h=this.g=null}add(e,n){let s=Ed.get();s.set(e,n),this.h?this.h.next=s:this.g=s,this.h=s}},Ed=new pa(()=>new ga,t=>t.reset()),ga=class{constructor(){this.next=this.g=this.h=null}set(e,n){this.h=e,this.g=n,this.next=null}reset(){this.next=this.g=this.h=null}};function yy(t){var e=1;t=t.split(":");let n=[];for(;0<e&&t.length;)n.push(t.shift()),e--;return t.length&&n.push(t.join(":")),n}function vy(t){S.setTimeout(()=>{throw t},0)}var Es,ws=!1,Oa=new ma,wd=()=>{let t=S.Promise.resolve(void 0);Es=()=>{t.then(Ey)}},Ey=()=>{for(var t;t=_y();){try{t.h.call(t.g)}catch(n){vy(n)}var e=Ed;e.j(t),100>e.h&&(e.h++,t.next=e.g,e.g=t)}ws=!1};function pi(t,e){se.call(this),this.h=t||1,this.g=e||S,this.j=fe(this.qb,this),this.l=Date.now()}re(pi,se);_=pi.prototype;_.ga=!1;_.T=null;_.qb=function(){if(this.ga){var t=Date.now()-this.l;0<t&&t<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-t):(this.T&&(this.g.clearTimeout(this.T),this.T=null),ce(this,"tick"),this.ga&&(Ma(this),this.start()))}};_.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())};function Ma(t){t.ga=!1,t.T&&(t.g.clearTimeout(t.T),t.T=null)}_.N=function(){pi.$.N.call(this),Ma(this),delete this.g};function Fa(t,e,n){if(typeof t=="function")n&&(t=fe(t,n));else if(t&&typeof t.handleEvent=="function")t=fe(t.handleEvent,t);else throw Error("Invalid listener argument");return 2147483647<Number(e)?-1:S.setTimeout(t,e||0)}function Td(t){t.g=Fa(()=>{t.g=null,t.i&&(t.i=!1,Td(t))},t.j);let e=t.h;t.h=null,t.m.apply(null,e)}var _a=class extends bt{constructor(e,n){super(),this.m=e,this.j=n,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:Td(this)}N(){super.N(),this.g&&(S.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}};function Ts(t){bt.call(this),this.h=t,this.g={}}re(Ts,bt);var Zh=[];function Id(t,e,n,s){Array.isArray(n)||(n&&(Zh[0]=n.toString()),n=Zh);for(var r=0;r<n.length;r++){var i=md(e,n[r],s||t.handleEvent,!1,t.h||t);if(!i)break;t.g[i.key]=i}}function Sd(t){Ra(t.g,function(e,n){this.g.hasOwnProperty(n)&&Na(e)},t),t.g={}}Ts.prototype.N=function(){Ts.$.N.call(this),Sd(this)};Ts.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};function mi(){this.g=!0}mi.prototype.Ea=function(){this.g=!1};function wy(t,e,n,s,r,i){t.info(function(){if(t.g)if(i)for(var o="",a=i.split("&"),l=0;l<a.length;l++){var c=a[l].split("=");if(1<c.length){var u=c[0];c=c[1];var h=u.split("_");o=2<=h.length&&h[1]=="type"?o+(u+"="+c+"&"):o+(u+"=redacted&")}}else o=null;else o=i;return"XMLHTTP REQ ("+s+") [attempt "+r+"]: "+e+`
`+n+`
`+o})}function Ty(t,e,n,s,r,i,o){t.info(function(){return"XMLHTTP RESP ("+s+") [ attempt "+r+"]: "+e+`
`+n+`
`+i+" "+o})}function Pn(t,e,n,s){t.info(function(){return"XMLHTTP TEXT ("+e+"): "+Sy(t,n)+(s?" "+s:"")})}function Iy(t,e){t.info(function(){return"TIMEOUT: "+e})}mi.prototype.info=function(){};function Sy(t,e){if(!t.g)return e;if(!e)return null;try{var n=JSON.parse(e);if(n){for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var s=n[t];if(!(2>s.length)){var r=s[1];if(Array.isArray(r)&&!(1>r.length)){var i=r[0];if(i!="noop"&&i!="stop"&&i!="close")for(var o=1;o<r.length;o++)r[o]=""}}}}return xa(n)}catch{return e}}var Wt={},ed=null;function gi(){return ed=ed||new se}Wt.Ta="serverreachability";function Ad(t){pe.call(this,Wt.Ta,t)}re(Ad,pe);function Is(t){let e=gi();ce(e,new Ad(e))}Wt.STAT_EVENT="statevent";function bd(t,e){pe.call(this,Wt.STAT_EVENT,t),this.stat=e}re(bd,pe);function ye(t){let e=gi();ce(e,new bd(e,t))}Wt.Ua="timingevent";function Cd(t,e){pe.call(this,Wt.Ua,t),this.size=e}re(Cd,pe);function Rs(t,e){if(typeof t!="function")throw Error("Fn must not be null and must be a function");return S.setTimeout(function(){t()},e)}var _i={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},Rd={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function Va(){}Va.prototype.h=null;function td(t){return t.h||(t.h=t.i())}function Pd(){}var Ps={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function La(){pe.call(this,"d")}re(La,pe);function Ua(){pe.call(this,"c")}re(Ua,pe);var ya;function yi(){}re(yi,Va);yi.prototype.g=function(){return new XMLHttpRequest};yi.prototype.i=function(){return{}};ya=new yi;function Ns(t,e,n,s){this.l=t,this.j=e,this.m=n,this.W=s||1,this.U=new Ts(this),this.P=Ay,t=ca?125:void 0,this.V=new pi(t),this.I=null,this.i=!1,this.u=this.B=this.A=this.L=this.G=this.Y=this.C=null,this.F=[],this.g=null,this.o=0,this.s=this.v=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new Nd}function Nd(){this.i=null,this.g="",this.h=!1}var Ay=45e3,Dd={},va={};_=Ns.prototype;_.setTimeout=function(t){this.P=t};function Ea(t,e,n){t.L=1,t.A=Ei(ft(e)),t.u=n,t.S=!0,kd(t,null)}function kd(t,e){t.G=Date.now(),Ds(t),t.B=ft(t.A);var n=t.B,s=t.W;Array.isArray(s)||(s=[String(s)]),Bd(n.i,"t",s),t.o=0,n=t.l.J,t.h=new Nd,t.g=lf(t.l,n?e:null,!t.u),0<t.O&&(t.M=new _a(fe(t.Pa,t,t.g),t.O)),Id(t.U,t.g,"readystatechange",t.nb),e=t.I?fd(t.I):{},t.u?(t.v||(t.v="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ha(t.B,t.v,t.u,e)):(t.v="GET",t.g.ha(t.B,t.v,null,e)),Is(),wy(t.j,t.v,t.B,t.m,t.W,t.u)}_.nb=function(t){t=t.target;let e=this.M;e&&Ze(t)==3?e.l():this.Pa(t)};_.Pa=function(t){try{if(t==this.g)e:{let u=Ze(this.g);var e=this.g.Ia();let h=this.g.da();if(!(3>u)&&(u!=3||ca||this.g&&(this.h.h||this.g.ja()||id(this.g)))){this.J||u!=4||e==7||(e==8||0>=h?Is(3):Is(2)),vi(this);var n=this.g.da();this.ca=n;t:if(xd(this)){var s=id(this.g);t="";var r=s.length,i=Ze(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){jt(this),_s(this);var o="";break t}this.h.i=new S.TextDecoder}for(e=0;e<r;e++)this.h.h=!0,t+=this.h.i.decode(s[e],{stream:i&&e==r-1});s.length=0,this.h.g+=t,this.o=0,o=this.h.g}else o=this.g.ja();if(this.i=n==200,Ty(this.j,this.v,this.B,this.m,this.W,u,n),this.i){if(this.aa&&!this.K){t:{if(this.g){var a,l=this.g;if((a=l.g?l.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!ys(a)){var c=a;break t}}c=null}if(n=c)Pn(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,wa(this,n);else{this.i=!1,this.s=3,ye(12),jt(this),_s(this);break e}}this.S?(Od(this,u,o),ca&&this.i&&u==3&&(Id(this.U,this.V,"tick",this.mb),this.V.start())):(Pn(this.j,this.m,o,null),wa(this,o)),u==4&&jt(this),this.i&&!this.J&&(u==4?sf(this.l,this):(this.i=!1,Ds(this)))}else Ky(this.g),n==400&&0<o.indexOf("Unknown SID")?(this.s=3,ye(12)):(this.s=0,ye(13)),jt(this),_s(this)}}}catch{}finally{}};function xd(t){return t.g?t.v=="GET"&&t.L!=2&&t.l.Ha:!1}function Od(t,e,n){let s=!0,r;for(;!t.J&&t.o<n.length;)if(r=by(t,n),r==va){e==4&&(t.s=4,ye(14),s=!1),Pn(t.j,t.m,null,"[Incomplete Response]");break}else if(r==Dd){t.s=4,ye(15),Pn(t.j,t.m,n,"[Invalid Chunk]"),s=!1;break}else Pn(t.j,t.m,r,null),wa(t,r);xd(t)&&t.o!=0&&(t.h.g=t.h.g.slice(t.o),t.o=0),e!=4||n.length!=0||t.h.h||(t.s=1,ye(16),s=!1),t.i=t.i&&s,s?0<n.length&&!t.ba&&(t.ba=!0,e=t.l,e.g==t&&e.ca&&!e.M&&(e.l.info("Great, no buffering proxy detected. Bytes received: "+n.length),Ga(e),e.M=!0,ye(11))):(Pn(t.j,t.m,n,"[Invalid Chunked Response]"),jt(t),_s(t))}_.mb=function(){if(this.g){var t=Ze(this.g),e=this.g.ja();this.o<e.length&&(vi(this),Od(this,t,e),this.i&&t!=4&&Ds(this))}};function by(t,e){var n=t.o,s=e.indexOf(`
`,n);return s==-1?va:(n=Number(e.substring(n,s)),isNaN(n)?Dd:(s+=1,s+n>e.length?va:(e=e.slice(s,s+n),t.o=s+n,e)))}_.cancel=function(){this.J=!0,jt(this)};function Ds(t){t.Y=Date.now()+t.P,Md(t,t.P)}function Md(t,e){if(t.C!=null)throw Error("WatchDog timer not null");t.C=Rs(fe(t.lb,t),e)}function vi(t){t.C&&(S.clearTimeout(t.C),t.C=null)}_.lb=function(){this.C=null;let t=Date.now();0<=t-this.Y?(Iy(this.j,this.B),this.L!=2&&(Is(),ye(17)),jt(this),this.s=2,_s(this)):Md(this,this.Y-t)};function _s(t){t.l.H==0||t.J||sf(t.l,t)}function jt(t){vi(t);var e=t.M;e&&typeof e.sa=="function"&&e.sa(),t.M=null,Ma(t.V),Sd(t.U),t.g&&(e=t.g,t.g=null,e.abort(),e.sa())}function wa(t,e){try{var n=t.l;if(n.H!=0&&(n.g==t||Ta(n.i,t))){if(!t.K&&Ta(n.i,t)&&n.H==3){try{var s=n.Ja.g.parse(e)}catch{s=null}if(Array.isArray(s)&&s.length==3){var r=s;if(r[0]==0){e:if(!n.u){if(n.g)if(n.g.G+3e3<t.G)oi(n),Ii(n);else break e;ja(n),ye(18)}}else n.Fa=r[1],0<n.Fa-n.V&&37500>r[2]&&n.G&&n.A==0&&!n.v&&(n.v=Rs(fe(n.ib,n),6e3));if(1>=zd(n.i)&&n.oa){try{n.oa()}catch{}n.oa=void 0}}else Gt(n,11)}else if((t.K||n.g==t)&&oi(n),!ys(e))for(r=n.Ja.g.parse(e),e=0;e<r.length;e++){let c=r[e];if(n.V=c[0],c=c[1],n.H==2)if(c[0]=="c"){n.K=c[1],n.pa=c[2];let u=c[3];u!=null&&(n.ra=u,n.l.info("VER="+n.ra));let h=c[4];h!=null&&(n.Ga=h,n.l.info("SVER="+n.Ga));let d=c[5];d!=null&&typeof d=="number"&&0<d&&(s=1.5*d,n.L=s,n.l.info("backChannelRequestTimeoutMs_="+s)),s=n;let p=t.g;if(p){let f=p.g?p.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(f){var i=s.i;i.g||f.indexOf("spdy")==-1&&f.indexOf("quic")==-1&&f.indexOf("h2")==-1||(i.j=i.l,i.g=new Set,i.h&&(Ba(i,i.h),i.h=null))}if(s.F){let m=p.g?p.g.getResponseHeader("X-HTTP-Session-Id"):null;m&&(s.Da=m,j(s.I,s.F,m))}}n.H=3,n.h&&n.h.Ba(),n.ca&&(n.S=Date.now()-t.G,n.l.info("Handshake RTT: "+n.S+"ms")),s=n;var o=t;if(s.wa=af(s,s.J?s.pa:null,s.Y),o.K){jd(s.i,o);var a=o,l=s.L;l&&a.setTimeout(l),a.C&&(vi(a),Ds(a)),s.g=o}else tf(s);0<n.j.length&&Si(n)}else c[0]!="stop"&&c[0]!="close"||Gt(n,7);else n.H==3&&(c[0]=="stop"||c[0]=="close"?c[0]=="stop"?Gt(n,7):za(n):c[0]!="noop"&&n.h&&n.h.Aa(c),n.A=0)}}Is(4)}catch{}}function Cy(t){if(t.Z&&typeof t.Z=="function")return t.Z();if(typeof Map<"u"&&t instanceof Map||typeof Set<"u"&&t instanceof Set)return Array.from(t.values());if(typeof t=="string")return t.split("");if(ui(t)){for(var e=[],n=t.length,s=0;s<n;s++)e.push(t[s]);return e}e=[],n=0;for(s in t)e[n++]=t[s];return e}function Ry(t){if(t.ta&&typeof t.ta=="function")return t.ta();if(!t.Z||typeof t.Z!="function"){if(typeof Map<"u"&&t instanceof Map)return Array.from(t.keys());if(!(typeof Set<"u"&&t instanceof Set)){if(ui(t)||typeof t=="string"){var e=[];t=t.length;for(var n=0;n<t;n++)e.push(n);return e}e=[],n=0;for(let s in t)e[n++]=s;return e}}}function Fd(t,e){if(t.forEach&&typeof t.forEach=="function")t.forEach(e,void 0);else if(ui(t)||typeof t=="string")Array.prototype.forEach.call(t,e,void 0);else for(var n=Ry(t),s=Cy(t),r=s.length,i=0;i<r;i++)e.call(void 0,s[i],n&&n[i],t)}var Vd=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Py(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var s=t[n].indexOf("="),r=null;if(0<=s){var i=t[n].substring(0,s);r=t[n].substring(s+1)}else i=t[n];e(i,r?decodeURIComponent(r.replace(/\+/g," ")):"")}}}function Kt(t){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,t instanceof Kt){this.h=t.h,ri(this,t.j),this.s=t.s,this.g=t.g,ii(this,t.m),this.l=t.l;var e=t.i,n=new Ss;n.i=e.i,e.g&&(n.g=new Map(e.g),n.h=e.h),nd(this,n),this.o=t.o}else t&&(e=String(t).match(Vd))?(this.h=!1,ri(this,e[1]||"",!0),this.s=ms(e[2]||""),this.g=ms(e[3]||"",!0),ii(this,e[4]),this.l=ms(e[5]||"",!0),nd(this,e[6]||"",!0),this.o=ms(e[7]||"")):(this.h=!1,this.i=new Ss(null,this.h))}Kt.prototype.toString=function(){var t=[],e=this.j;e&&t.push(gs(e,sd,!0),":");var n=this.g;return(n||e=="file")&&(t.push("//"),(e=this.s)&&t.push(gs(e,sd,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n=this.m,n!=null&&t.push(":",String(n))),(n=this.l)&&(this.g&&n.charAt(0)!="/"&&t.push("/"),t.push(gs(n,n.charAt(0)=="/"?ky:Dy,!0))),(n=this.i.toString())&&t.push("?",n),(n=this.o)&&t.push("#",gs(n,Oy)),t.join("")};function ft(t){return new Kt(t)}function ri(t,e,n){t.j=n?ms(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function ii(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.m=e}else t.m=null}function nd(t,e,n){e instanceof Ss?(t.i=e,My(t.i,t.h)):(n||(e=gs(e,xy)),t.i=new Ss(e,t.h))}function j(t,e,n){t.i.set(e,n)}function Ei(t){return j(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function ms(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function gs(t,e,n){return typeof t=="string"?(t=encodeURI(t).replace(e,Ny),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function Ny(t){return t=t.charCodeAt(0),"%"+(t>>4&15).toString(16)+(t&15).toString(16)}var sd=/[#\/\?@]/g,Dy=/[#\?:]/g,ky=/[#\?]/g,xy=/[#\?@]/g,Oy=/#/g;function Ss(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function Ct(t){t.g||(t.g=new Map,t.h=0,t.i&&Py(t.i,function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)}))}_=Ss.prototype;_.add=function(t,e){Ct(this),this.i=null,t=kn(this,t);var n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this};function Ld(t,e){Ct(t),e=kn(t,e),t.g.has(e)&&(t.i=null,t.h-=t.g.get(e).length,t.g.delete(e))}function Ud(t,e){return Ct(t),e=kn(t,e),t.g.has(e)}_.forEach=function(t,e){Ct(this),this.g.forEach(function(n,s){n.forEach(function(r){t.call(e,r,s,this)},this)},this)};_.ta=function(){Ct(this);let t=Array.from(this.g.values()),e=Array.from(this.g.keys()),n=[];for(let s=0;s<e.length;s++){let r=t[s];for(let i=0;i<r.length;i++)n.push(e[s])}return n};_.Z=function(t){Ct(this);let e=[];if(typeof t=="string")Ud(this,t)&&(e=e.concat(this.g.get(kn(this,t))));else{t=Array.from(this.g.values());for(let n=0;n<t.length;n++)e=e.concat(t[n])}return e};_.set=function(t,e){return Ct(this),this.i=null,t=kn(this,t),Ud(this,t)&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this};_.get=function(t,e){return t?(t=this.Z(t),0<t.length?String(t[0]):e):e};function Bd(t,e,n){Ld(t,e),0<n.length&&(t.i=null,t.g.set(kn(t,e),ba(n)),t.h+=n.length)}_.toString=function(){if(this.i)return this.i;if(!this.g)return"";let t=[],e=Array.from(this.g.keys());for(var n=0;n<e.length;n++){var s=e[n];let i=encodeURIComponent(String(s)),o=this.Z(s);for(s=0;s<o.length;s++){var r=i;o[s]!==""&&(r+="="+encodeURIComponent(String(o[s]))),t.push(r)}}return this.i=t.join("&")};function kn(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}function My(t,e){e&&!t.j&&(Ct(t),t.i=null,t.g.forEach(function(n,s){var r=s.toLowerCase();s!=r&&(Ld(this,s),Bd(this,r,n))},t)),t.j=e}var Fy=class{constructor(t,e){this.g=t,this.map=e}};function qd(t){this.l=t||Vy,S.PerformanceNavigationTiming?(t=S.performance.getEntriesByType("navigation"),t=0<t.length&&(t[0].nextHopProtocol=="hq"||t[0].nextHopProtocol=="h2")):t=!!(S.g&&S.g.Ka&&S.g.Ka()&&S.g.Ka().dc),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var Vy=10;function $d(t){return t.h?!0:t.g?t.g.size>=t.j:!1}function zd(t){return t.h?1:t.g?t.g.size:0}function Ta(t,e){return t.h?t.h==e:t.g?t.g.has(e):!1}function Ba(t,e){t.g?t.g.add(e):t.h=e}function jd(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}qd.prototype.cancel=function(){if(this.i=Gd(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let t of this.g.values())t.cancel();this.g.clear()}};function Gd(t){if(t.h!=null)return t.i.concat(t.h.F);if(t.g!=null&&t.g.size!==0){let e=t.i;for(let n of t.g.values())e=e.concat(n.F);return e}return ba(t.i)}var Ly=class{stringify(t){return S.JSON.stringify(t,void 0)}parse(t){return S.JSON.parse(t,void 0)}};function Uy(){this.g=new Ly}function By(t,e,n){let s=n||"";try{Fd(t,function(r,i){let o=r;bs(r)&&(o=xa(r)),e.push(s+i+"="+encodeURIComponent(o))})}catch(r){throw e.push(s+"type="+encodeURIComponent("_badmap")),r}}function qy(t,e){let n=new mi;if(S.Image){let s=new Image;s.onload=Xr(ni,n,s,"TestLoadImage: loaded",!0,e),s.onerror=Xr(ni,n,s,"TestLoadImage: error",!1,e),s.onabort=Xr(ni,n,s,"TestLoadImage: abort",!1,e),s.ontimeout=Xr(ni,n,s,"TestLoadImage: timeout",!1,e),S.setTimeout(function(){s.ontimeout&&s.ontimeout()},1e4),s.src=t}else e(!1)}function ni(t,e,n,s,r){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,r(s)}catch{}}function ks(t){this.l=t.ec||null,this.j=t.ob||!1}re(ks,Va);ks.prototype.g=function(){return new wi(this.l,this.j)};ks.prototype.i=function(t){return function(){return t}}({});function wi(t,e){se.call(this),this.F=t,this.u=e,this.m=void 0,this.readyState=qa,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}re(wi,se);var qa=0;_=wi.prototype;_.open=function(t,e){if(this.readyState!=qa)throw this.abort(),Error("Error reopening a connection");this.C=t,this.B=e,this.readyState=1,As(this)};_.send=function(t){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};t&&(e.body=t),(this.F||S).fetch(new Request(this.B,e)).then(this.$a.bind(this),this.ka.bind(this))};_.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,xs(this)),this.readyState=qa};_.$a=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,As(this)),this.g&&(this.readyState=3,As(this),this.g)))if(this.responseType==="arraybuffer")t.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(typeof S.ReadableStream<"u"&&"body"in t){if(this.j=t.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;Kd(this)}else t.text().then(this.Za.bind(this),this.ka.bind(this))};function Kd(t){t.j.read().then(t.Xa.bind(t)).catch(t.ka.bind(t))}_.Xa=function(t){if(this.g){if(this.u&&t.value)this.response.push(t.value);else if(!this.u){var e=t.value?t.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?xs(this):As(this),this.readyState==3&&Kd(this)}};_.Za=function(t){this.g&&(this.response=this.responseText=t,xs(this))};_.Ya=function(t){this.g&&(this.response=t,xs(this))};_.ka=function(){this.g&&xs(this)};function xs(t){t.readyState=4,t.l=null,t.j=null,t.A=null,As(t)}_.setRequestHeader=function(t,e){this.v.append(t,e)};_.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""};_.getAllResponseHeaders=function(){if(!this.h)return"";let t=[],e=this.h.entries();for(var n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join(`\r
`)};function As(t){t.onreadystatechange&&t.onreadystatechange.call(t)}Object.defineProperty(wi.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(t){this.m=t?"include":"same-origin"}});var $y=S.JSON.parse;function H(t){se.call(this),this.headers=new Map,this.u=t||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=Wd,this.L=this.M=!1}re(H,se);var Wd="",zy=/^https?$/i,jy=["POST","PUT"];_=H.prototype;_.Oa=function(t){this.M=t};_.ha=function(t,e,n,s){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+t);e=e?e.toUpperCase():"GET",this.I=t,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():ya.g(),this.C=this.u?td(this.u):td(ya),this.g.onreadystatechange=fe(this.La,this);try{this.G=!0,this.g.open(e,String(t),!0),this.G=!1}catch(i){rd(this,i);return}if(t=n||"",n=new Map(this.headers),s)if(Object.getPrototypeOf(s)===Object.prototype)for(var r in s)n.set(r,s[r]);else if(typeof s.keys=="function"&&typeof s.get=="function")for(let i of s.keys())n.set(i,s.get(i));else throw Error("Unknown input type for opt_headers: "+String(s));s=Array.from(n.keys()).find(i=>i.toLowerCase()=="content-type"),r=S.FormData&&t instanceof S.FormData,!(0<=cd(jy,e))||s||r||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[i,o]of n)this.g.setRequestHeader(i,o);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{Yd(this),0<this.B&&((this.L=Gy(this.g))?(this.g.timeout=this.B,this.g.ontimeout=fe(this.ua,this)):this.A=Fa(this.ua,this.B,this)),this.v=!0,this.g.send(t),this.v=!1}catch(i){rd(this,i)}};function Gy(t){return Dn&&typeof t.timeout=="number"&&t.ontimeout!==void 0}_.ua=function(){typeof Aa<"u"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,ce(this,"timeout"),this.abort(8))};function rd(t,e){t.h=!1,t.g&&(t.l=!0,t.g.abort(),t.l=!1),t.j=e,t.m=5,Qd(t),Ti(t)}function Qd(t){t.F||(t.F=!0,ce(t,"complete"),ce(t,"error"))}_.abort=function(t){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=t||7,ce(this,"complete"),ce(this,"abort"),Ti(this))};_.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Ti(this,!0)),H.$.N.call(this)};_.La=function(){this.s||(this.G||this.v||this.l?Hd(this):this.kb())};_.kb=function(){Hd(this)};function Hd(t){if(t.h&&typeof Aa<"u"&&(!t.C[1]||Ze(t)!=4||t.da()!=2)){if(t.v&&Ze(t)==4)Fa(t.La,0,t);else if(ce(t,"readystatechange"),Ze(t)==4){t.h=!1;try{let o=t.da();e:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break e;default:e=!1}var n;if(!(n=e)){var s;if(s=o===0){var r=String(t.I).match(Vd)[1]||null;!r&&S.self&&S.self.location&&(r=S.self.location.protocol.slice(0,-1)),s=!zy.test(r?r.toLowerCase():"")}n=s}if(n)ce(t,"complete"),ce(t,"success");else{t.m=6;try{var i=2<Ze(t)?t.g.statusText:""}catch{i=""}t.j=i+" ["+t.da()+"]",Qd(t)}}finally{Ti(t)}}}}function Ti(t,e){if(t.g){Yd(t);let n=t.g,s=t.C[0]?()=>{}:null;t.g=null,t.C=null,e||ce(t,"ready");try{n.onreadystatechange=s}catch{}}}function Yd(t){t.g&&t.L&&(t.g.ontimeout=null),t.A&&(S.clearTimeout(t.A),t.A=null)}_.isActive=function(){return!!this.g};function Ze(t){return t.g?t.g.readyState:0}_.da=function(){try{return 2<Ze(this)?this.g.status:-1}catch{return-1}};_.ja=function(){try{return this.g?this.g.responseText:""}catch{return""}};_.Wa=function(t){if(this.g){var e=this.g.responseText;return t&&e.indexOf(t)==0&&(e=e.substring(t.length)),$y(e)}};function id(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.K){case Wd:case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch{return null}}function Ky(t){let e={};t=(t.g&&2<=Ze(t)&&t.g.getAllResponseHeaders()||"").split(`\r
`);for(let s=0;s<t.length;s++){if(ys(t[s]))continue;var n=yy(t[s]);let r=n[0];if(n=n[1],typeof n!="string")continue;n=n.trim();let i=e[r]||[];e[r]=i,i.push(n)}py(e,function(s){return s.join(", ")})}_.Ia=function(){return this.m};_.Sa=function(){return typeof this.j=="string"?this.j:String(this.j)};function Xd(t){let e="";return Ra(t,function(n,s){e+=s,e+=":",e+=n,e+=`\r
`}),e}function $a(t,e,n){e:{for(s in n){var s=!1;break e}s=!0}s||(n=Xd(n),typeof t=="string"?n!=null&&encodeURIComponent(String(n)):j(t,e,n))}function fs(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function Jd(t){this.Ga=0,this.j=[],this.l=new mi,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=fs("failFast",!1,t),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=fs("baseRetryDelayMs",5e3,t),this.hb=fs("retryDelaySeedMs",1e4,t),this.eb=fs("forwardChannelMaxRetries",2,t),this.xa=fs("forwardChannelRequestTimeoutMs",2e4,t),this.va=t&&t.xmlHttpFactory||void 0,this.Ha=t&&t.useFetchStreams||!1,this.L=void 0,this.J=t&&t.supportsCrossDomainXhr||!1,this.K="",this.i=new qd(t&&t.concurrentRequestLimit),this.Ja=new Uy,this.P=t&&t.fastHandshake||!1,this.O=t&&t.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=t&&t.bc||!1,t&&t.Ea&&this.l.Ea(),t&&t.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&t&&t.detectBufferingProxy||!1,this.qa=void 0,t&&t.longPollingTimeout&&0<t.longPollingTimeout&&(this.qa=t.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}_=Jd.prototype;_.ra=8;_.H=1;function za(t){if(Zd(t),t.H==3){var e=t.W++,n=ft(t.I);if(j(n,"SID",t.K),j(n,"RID",e),j(n,"TYPE","terminate"),Os(t,n),e=new Ns(t,t.l,e),e.L=2,e.A=Ei(ft(n)),n=!1,S.navigator&&S.navigator.sendBeacon)try{n=S.navigator.sendBeacon(e.A.toString(),"")}catch{}!n&&S.Image&&(new Image().src=e.A,n=!0),n||(e.g=lf(e.l,null),e.g.ha(e.A)),e.G=Date.now(),Ds(e)}of(t)}function Ii(t){t.g&&(Ga(t),t.g.cancel(),t.g=null)}function Zd(t){Ii(t),t.u&&(S.clearTimeout(t.u),t.u=null),oi(t),t.i.cancel(),t.m&&(typeof t.m=="number"&&S.clearTimeout(t.m),t.m=null)}function Si(t){if(!$d(t.i)&&!t.m){t.m=!0;var e=t.Na;Es||wd(),ws||(Es(),ws=!0),Oa.add(e,t),t.C=0}}function Wy(t,e){return zd(t.i)>=t.i.j-(t.m?1:0)?!1:t.m?(t.j=e.F.concat(t.j),!0):t.H==1||t.H==2||t.C>=(t.cb?0:t.eb)?!1:(t.m=Rs(fe(t.Na,t,e),rf(t,t.C)),t.C++,!0)}_.Na=function(t){if(this.m)if(this.m=null,this.H==1){if(!t){this.W=Math.floor(1e5*Math.random()),t=this.W++;let r=new Ns(this,this.l,t),i=this.s;if(this.U&&(i?(i=fd(i),pd(i,this.U)):i=this.U),this.o!==null||this.O||(r.I=i,i=null),this.P)e:{for(var e=0,n=0;n<this.j.length;n++){t:{var s=this.j[n];if("__data__"in s.map&&(s=s.map.__data__,typeof s=="string")){s=s.length;break t}s=void 0}if(s===void 0)break;if(e+=s,4096<e){e=n;break e}if(e===4096||n===this.j.length-1){e=n+1;break e}}e=1e3}else e=1e3;e=ef(this,r,e),n=ft(this.I),j(n,"RID",t),j(n,"CVER",22),this.F&&j(n,"X-HTTP-Session-Id",this.F),Os(this,n),i&&(this.O?e="headers="+encodeURIComponent(String(Xd(i)))+"&"+e:this.o&&$a(n,this.o,i)),Ba(this.i,r),this.bb&&j(n,"TYPE","init"),this.P?(j(n,"$req",e),j(n,"SID","null"),r.aa=!0,Ea(r,n,null)):Ea(r,n,e),this.H=2}}else this.H==3&&(t?od(this,t):this.j.length==0||$d(this.i)||od(this))};function od(t,e){var n;e?n=e.m:n=t.W++;let s=ft(t.I);j(s,"SID",t.K),j(s,"RID",n),j(s,"AID",t.V),Os(t,s),t.o&&t.s&&$a(s,t.o,t.s),n=new Ns(t,t.l,n,t.C+1),t.o===null&&(n.I=t.s),e&&(t.j=e.F.concat(t.j)),e=ef(t,n,1e3),n.setTimeout(Math.round(.5*t.xa)+Math.round(.5*t.xa*Math.random())),Ba(t.i,n),Ea(n,s,e)}function Os(t,e){t.na&&Ra(t.na,function(n,s){j(e,s,n)}),t.h&&Fd({},function(n,s){j(e,s,n)})}function ef(t,e,n){n=Math.min(t.j.length,n);var s=t.h?fe(t.h.Va,t.h,t):null;e:{var r=t.j;let i=-1;for(;;){let o=["count="+n];i==-1?0<n?(i=r[0].g,o.push("ofs="+i)):i=0:o.push("ofs="+i);let a=!0;for(let l=0;l<n;l++){let c=r[l].g,u=r[l].map;if(c-=i,0>c)i=Math.max(0,r[l].g-100),a=!1;else try{By(u,o,"req"+c+"_")}catch{s&&s(u)}}if(a){s=o.join("&");break e}}}return t=t.j.splice(0,n),e.F=t,s}function tf(t){if(!t.g&&!t.u){t.ba=1;var e=t.Ma;Es||wd(),ws||(Es(),ws=!0),Oa.add(e,t),t.A=0}}function ja(t){return t.g||t.u||3<=t.A?!1:(t.ba++,t.u=Rs(fe(t.Ma,t),rf(t,t.A)),t.A++,!0)}_.Ma=function(){if(this.u=null,nf(this),this.ca&&!(this.M||this.g==null||0>=this.S)){var t=2*this.S;this.l.info("BP detection timer enabled: "+t),this.B=Rs(fe(this.jb,this),t)}};_.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,ye(10),Ii(this),nf(this))};function Ga(t){t.B!=null&&(S.clearTimeout(t.B),t.B=null)}function nf(t){t.g=new Ns(t,t.l,"rpc",t.ba),t.o===null&&(t.g.I=t.s),t.g.O=0;var e=ft(t.wa);j(e,"RID","rpc"),j(e,"SID",t.K),j(e,"AID",t.V),j(e,"CI",t.G?"0":"1"),!t.G&&t.qa&&j(e,"TO",t.qa),j(e,"TYPE","xmlhttp"),Os(t,e),t.o&&t.s&&$a(e,t.o,t.s),t.L&&t.g.setTimeout(t.L);var n=t.g;t=t.pa,n.L=1,n.A=Ei(ft(e)),n.u=null,n.S=!0,kd(n,t)}_.ib=function(){this.v!=null&&(this.v=null,Ii(this),ja(this),ye(19))};function oi(t){t.v!=null&&(S.clearTimeout(t.v),t.v=null)}function sf(t,e){var n=null;if(t.g==e){oi(t),Ga(t),t.g=null;var s=2}else if(Ta(t.i,e))n=e.F,jd(t.i,e),s=1;else return;if(t.H!=0){if(e.i)if(s==1){n=e.u?e.u.length:0,e=Date.now()-e.G;var r=t.C;s=gi(),ce(s,new Cd(s,n)),Si(t)}else tf(t);else if(r=e.s,r==3||r==0&&0<e.ca||!(s==1&&Wy(t,e)||s==2&&ja(t)))switch(n&&0<n.length&&(e=t.i,e.i=e.i.concat(n)),r){case 1:Gt(t,5);break;case 4:Gt(t,10);break;case 3:Gt(t,6);break;default:Gt(t,2)}}}function rf(t,e){let n=t.ab+Math.floor(Math.random()*t.hb);return t.isActive()||(n*=2),n*e}function Gt(t,e){if(t.l.info("Error code "+e),e==2){var n=null;t.h&&(n=null);var s=fe(t.pb,t);n||(n=new Kt("//www.google.com/images/cleardot.gif"),S.location&&S.location.protocol=="http"||ri(n,"https"),Ei(n)),qy(n.toString(),s)}else ye(2);t.H=0,t.h&&t.h.za(e),of(t),Zd(t)}_.pb=function(t){t?(this.l.info("Successfully pinged google.com"),ye(2)):(this.l.info("Failed to ping google.com"),ye(1))};function of(t){if(t.H=0,t.ma=[],t.h){let e=Gd(t.i);(e.length!=0||t.j.length!=0)&&(Xh(t.ma,e),Xh(t.ma,t.j),t.i.i.length=0,ba(t.j),t.j.length=0),t.h.ya()}}function af(t,e,n){var s=n instanceof Kt?ft(n):new Kt(n);if(s.g!="")e&&(s.g=e+"."+s.g),ii(s,s.m);else{var r=S.location;s=r.protocol,e=e?e+"."+r.hostname:r.hostname,r=+r.port;var i=new Kt(null);s&&ri(i,s),e&&(i.g=e),r&&ii(i,r),n&&(i.l=n),s=i}return n=t.F,e=t.Da,n&&e&&j(s,n,e),j(s,"VER",t.ra),Os(t,s),s}function lf(t,e,n){if(e&&!t.J)throw Error("Can't create secondary domain capable XhrIo object.");return e=t.Ha&&!t.va?new H(new ks({ob:n})):new H(t.va),e.Oa(t.J),e}_.isActive=function(){return!!this.h&&this.h.isActive(this)};function cf(){}_=cf.prototype;_.Ba=function(){};_.Aa=function(){};_.za=function(){};_.ya=function(){};_.isActive=function(){return!0};_.Va=function(){};function ai(){if(Dn&&!(10<=Number(uy)))throw Error("Environmental error: no available transport.")}ai.prototype.g=function(t,e){return new Ce(t,e)};function Ce(t,e){se.call(this),this.g=new Jd(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.s=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.Ca&&(t?t["X-WebChannel-Client-Profile"]=e.Ca:t={"X-WebChannel-Client-Profile":e.Ca}),this.g.U=t,(t=e&&e.cc)&&!ys(t)&&(this.g.o=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!ys(e)&&(this.g.F=e,t=this.h,t!==null&&e in t&&(t=this.h,e in t&&delete t[e])),this.j=new xn(this)}re(Ce,se);Ce.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var t=this.g,e=this.l,n=this.h||void 0;ye(0),t.Y=e,t.na=n||{},t.G=t.aa,t.I=af(t,null,t.Y),Si(t)};Ce.prototype.close=function(){za(this.g)};Ce.prototype.u=function(t){var e=this.g;if(typeof t=="string"){var n={};n.__data__=t,t=n}else this.v&&(n={},n.__data__=xa(t),t=n);e.j.push(new Fy(e.fb++,t)),e.H==3&&Si(e)};Ce.prototype.N=function(){this.g.h=null,delete this.j,za(this.g),delete this.g,Ce.$.N.call(this)};function uf(t){La.call(this),t.__headers__&&(this.headers=t.__headers__,this.statusCode=t.__status__,delete t.__headers__,delete t.__status__);var e=t.__sm__;if(e){e:{for(let n in e){t=n;break e}t=void 0}(this.i=t)&&(t=this.i,e=e!==null&&t in e?e[t]:void 0),this.data=e}else this.data=t}re(uf,La);function hf(){Ua.call(this),this.status=1}re(hf,Ua);function xn(t){this.g=t}re(xn,cf);xn.prototype.Ba=function(){ce(this.g,"a")};xn.prototype.Aa=function(t){ce(this.g,new uf(t))};xn.prototype.za=function(t){ce(this.g,new hf)};xn.prototype.ya=function(){ce(this.g,"b")};function Qy(){this.blockSize=-1}function Le(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}re(Le,Qy);Le.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0};function la(t,e,n){n||(n=0);var s=Array(16);if(typeof e=="string")for(var r=0;16>r;++r)s[r]=e.charCodeAt(n++)|e.charCodeAt(n++)<<8|e.charCodeAt(n++)<<16|e.charCodeAt(n++)<<24;else for(r=0;16>r;++r)s[r]=e[n++]|e[n++]<<8|e[n++]<<16|e[n++]<<24;e=t.g[0],n=t.g[1],r=t.g[2];var i=t.g[3],o=e+(i^n&(r^i))+s[0]+3614090360&4294967295;e=n+(o<<7&4294967295|o>>>25),o=i+(r^e&(n^r))+s[1]+3905402710&4294967295,i=e+(o<<12&4294967295|o>>>20),o=r+(n^i&(e^n))+s[2]+606105819&4294967295,r=i+(o<<17&4294967295|o>>>15),o=n+(e^r&(i^e))+s[3]+3250441966&4294967295,n=r+(o<<22&4294967295|o>>>10),o=e+(i^n&(r^i))+s[4]+4118548399&4294967295,e=n+(o<<7&4294967295|o>>>25),o=i+(r^e&(n^r))+s[5]+1200080426&4294967295,i=e+(o<<12&4294967295|o>>>20),o=r+(n^i&(e^n))+s[6]+2821735955&4294967295,r=i+(o<<17&4294967295|o>>>15),o=n+(e^r&(i^e))+s[7]+4249261313&4294967295,n=r+(o<<22&4294967295|o>>>10),o=e+(i^n&(r^i))+s[8]+1770035416&4294967295,e=n+(o<<7&4294967295|o>>>25),o=i+(r^e&(n^r))+s[9]+2336552879&4294967295,i=e+(o<<12&4294967295|o>>>20),o=r+(n^i&(e^n))+s[10]+4294925233&4294967295,r=i+(o<<17&4294967295|o>>>15),o=n+(e^r&(i^e))+s[11]+2304563134&4294967295,n=r+(o<<22&4294967295|o>>>10),o=e+(i^n&(r^i))+s[12]+1804603682&4294967295,e=n+(o<<7&4294967295|o>>>25),o=i+(r^e&(n^r))+s[13]+4254626195&4294967295,i=e+(o<<12&4294967295|o>>>20),o=r+(n^i&(e^n))+s[14]+2792965006&4294967295,r=i+(o<<17&4294967295|o>>>15),o=n+(e^r&(i^e))+s[15]+1236535329&4294967295,n=r+(o<<22&4294967295|o>>>10),o=e+(r^i&(n^r))+s[1]+4129170786&4294967295,e=n+(o<<5&4294967295|o>>>27),o=i+(n^r&(e^n))+s[6]+3225465664&4294967295,i=e+(o<<9&4294967295|o>>>23),o=r+(e^n&(i^e))+s[11]+643717713&4294967295,r=i+(o<<14&4294967295|o>>>18),o=n+(i^e&(r^i))+s[0]+3921069994&4294967295,n=r+(o<<20&4294967295|o>>>12),o=e+(r^i&(n^r))+s[5]+3593408605&4294967295,e=n+(o<<5&4294967295|o>>>27),o=i+(n^r&(e^n))+s[10]+38016083&4294967295,i=e+(o<<9&4294967295|o>>>23),o=r+(e^n&(i^e))+s[15]+3634488961&4294967295,r=i+(o<<14&4294967295|o>>>18),o=n+(i^e&(r^i))+s[4]+3889429448&4294967295,n=r+(o<<20&4294967295|o>>>12),o=e+(r^i&(n^r))+s[9]+568446438&4294967295,e=n+(o<<5&4294967295|o>>>27),o=i+(n^r&(e^n))+s[14]+3275163606&4294967295,i=e+(o<<9&4294967295|o>>>23),o=r+(e^n&(i^e))+s[3]+4107603335&4294967295,r=i+(o<<14&4294967295|o>>>18),o=n+(i^e&(r^i))+s[8]+1163531501&4294967295,n=r+(o<<20&4294967295|o>>>12),o=e+(r^i&(n^r))+s[13]+2850285829&4294967295,e=n+(o<<5&4294967295|o>>>27),o=i+(n^r&(e^n))+s[2]+4243563512&4294967295,i=e+(o<<9&4294967295|o>>>23),o=r+(e^n&(i^e))+s[7]+1735328473&4294967295,r=i+(o<<14&4294967295|o>>>18),o=n+(i^e&(r^i))+s[12]+2368359562&4294967295,n=r+(o<<20&4294967295|o>>>12),o=e+(n^r^i)+s[5]+4294588738&4294967295,e=n+(o<<4&4294967295|o>>>28),o=i+(e^n^r)+s[8]+2272392833&4294967295,i=e+(o<<11&4294967295|o>>>21),o=r+(i^e^n)+s[11]+1839030562&4294967295,r=i+(o<<16&4294967295|o>>>16),o=n+(r^i^e)+s[14]+4259657740&4294967295,n=r+(o<<23&4294967295|o>>>9),o=e+(n^r^i)+s[1]+2763975236&4294967295,e=n+(o<<4&4294967295|o>>>28),o=i+(e^n^r)+s[4]+1272893353&4294967295,i=e+(o<<11&4294967295|o>>>21),o=r+(i^e^n)+s[7]+4139469664&4294967295,r=i+(o<<16&4294967295|o>>>16),o=n+(r^i^e)+s[10]+3200236656&4294967295,n=r+(o<<23&4294967295|o>>>9),o=e+(n^r^i)+s[13]+681279174&4294967295,e=n+(o<<4&4294967295|o>>>28),o=i+(e^n^r)+s[0]+3936430074&4294967295,i=e+(o<<11&4294967295|o>>>21),o=r+(i^e^n)+s[3]+3572445317&4294967295,r=i+(o<<16&4294967295|o>>>16),o=n+(r^i^e)+s[6]+76029189&4294967295,n=r+(o<<23&4294967295|o>>>9),o=e+(n^r^i)+s[9]+3654602809&4294967295,e=n+(o<<4&4294967295|o>>>28),o=i+(e^n^r)+s[12]+3873151461&4294967295,i=e+(o<<11&4294967295|o>>>21),o=r+(i^e^n)+s[15]+530742520&4294967295,r=i+(o<<16&4294967295|o>>>16),o=n+(r^i^e)+s[2]+3299628645&4294967295,n=r+(o<<23&4294967295|o>>>9),o=e+(r^(n|~i))+s[0]+4096336452&4294967295,e=n+(o<<6&4294967295|o>>>26),o=i+(n^(e|~r))+s[7]+1126891415&4294967295,i=e+(o<<10&4294967295|o>>>22),o=r+(e^(i|~n))+s[14]+2878612391&4294967295,r=i+(o<<15&4294967295|o>>>17),o=n+(i^(r|~e))+s[5]+4237533241&4294967295,n=r+(o<<21&4294967295|o>>>11),o=e+(r^(n|~i))+s[12]+1700485571&4294967295,e=n+(o<<6&4294967295|o>>>26),o=i+(n^(e|~r))+s[3]+2399980690&4294967295,i=e+(o<<10&4294967295|o>>>22),o=r+(e^(i|~n))+s[10]+4293915773&4294967295,r=i+(o<<15&4294967295|o>>>17),o=n+(i^(r|~e))+s[1]+2240044497&4294967295,n=r+(o<<21&4294967295|o>>>11),o=e+(r^(n|~i))+s[8]+1873313359&4294967295,e=n+(o<<6&4294967295|o>>>26),o=i+(n^(e|~r))+s[15]+4264355552&4294967295,i=e+(o<<10&4294967295|o>>>22),o=r+(e^(i|~n))+s[6]+2734768916&4294967295,r=i+(o<<15&4294967295|o>>>17),o=n+(i^(r|~e))+s[13]+1309151649&4294967295,n=r+(o<<21&4294967295|o>>>11),o=e+(r^(n|~i))+s[4]+4149444226&4294967295,e=n+(o<<6&4294967295|o>>>26),o=i+(n^(e|~r))+s[11]+3174756917&4294967295,i=e+(o<<10&4294967295|o>>>22),o=r+(e^(i|~n))+s[2]+718787259&4294967295,r=i+(o<<15&4294967295|o>>>17),o=n+(i^(r|~e))+s[9]+3951481745&4294967295,t.g[0]=t.g[0]+e&4294967295,t.g[1]=t.g[1]+(r+(o<<21&4294967295|o>>>11))&4294967295,t.g[2]=t.g[2]+r&4294967295,t.g[3]=t.g[3]+i&4294967295}Le.prototype.j=function(t,e){e===void 0&&(e=t.length);for(var n=e-this.blockSize,s=this.m,r=this.h,i=0;i<e;){if(r==0)for(;i<=n;)la(this,t,i),i+=this.blockSize;if(typeof t=="string"){for(;i<e;)if(s[r++]=t.charCodeAt(i++),r==this.blockSize){la(this,s),r=0;break}}else for(;i<e;)if(s[r++]=t[i++],r==this.blockSize){la(this,s),r=0;break}}this.h=r,this.i+=e};Le.prototype.l=function(){var t=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);t[0]=128;for(var e=1;e<t.length-8;++e)t[e]=0;var n=8*this.i;for(e=t.length-8;e<t.length;++e)t[e]=n&255,n/=256;for(this.j(t),t=Array(16),e=n=0;4>e;++e)for(var s=0;32>s;s+=8)t[n++]=this.g[e]>>>s&255;return t};function U(t,e){this.h=e;for(var n=[],s=!0,r=t.length-1;0<=r;r--){var i=t[r]|0;s&&i==e||(n[r]=i,s=!1)}this.g=n}var Hy={};function Ka(t){return-128<=t&&128>t?ay(t,function(e){return new U([e|0],0>e?-1:0)}):new U([t|0],0>t?-1:0)}function et(t){if(isNaN(t)||!isFinite(t))return Nn;if(0>t)return le(et(-t));for(var e=[],n=1,s=0;t>=n;s++)e[s]=t/n|0,n*=Ia;return new U(e,0)}function df(t,e){if(t.length==0)throw Error("number format error: empty string");if(e=e||10,2>e||36<e)throw Error("radix out of range: "+e);if(t.charAt(0)=="-")return le(df(t.substring(1),e));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var n=et(Math.pow(e,8)),s=Nn,r=0;r<t.length;r+=8){var i=Math.min(8,t.length-r),o=parseInt(t.substring(r,r+i),e);8>i?(i=et(Math.pow(e,i)),s=s.R(i).add(et(o))):(s=s.R(n),s=s.add(et(o)))}return s}var Ia=4294967296,Nn=Ka(0),Sa=Ka(1),ad=Ka(16777216);_=U.prototype;_.ea=function(){if(xe(this))return-le(this).ea();for(var t=0,e=1,n=0;n<this.g.length;n++){var s=this.D(n);t+=(0<=s?s:Ia+s)*e,e*=Ia}return t};_.toString=function(t){if(t=t||10,2>t||36<t)throw Error("radix out of range: "+t);if(dt(this))return"0";if(xe(this))return"-"+le(this).toString(t);for(var e=et(Math.pow(t,6)),n=this,s="";;){var r=ci(n,e).g;n=li(n,r.R(e));var i=((0<n.g.length?n.g[0]:n.h)>>>0).toString(t);if(n=r,dt(n))return i+s;for(;6>i.length;)i="0"+i;s=i+s}};_.D=function(t){return 0>t?0:t<this.g.length?this.g[t]:this.h};function dt(t){if(t.h!=0)return!1;for(var e=0;e<t.g.length;e++)if(t.g[e]!=0)return!1;return!0}function xe(t){return t.h==-1}_.X=function(t){return t=li(this,t),xe(t)?-1:dt(t)?0:1};function le(t){for(var e=t.g.length,n=[],s=0;s<e;s++)n[s]=~t.g[s];return new U(n,~t.h).add(Sa)}_.abs=function(){return xe(this)?le(this):this};_.add=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],s=0,r=0;r<=e;r++){var i=s+(this.D(r)&65535)+(t.D(r)&65535),o=(i>>>16)+(this.D(r)>>>16)+(t.D(r)>>>16);s=o>>>16,i&=65535,o&=65535,n[r]=o<<16|i}return new U(n,n[n.length-1]&-2147483648?-1:0)};function li(t,e){return t.add(le(e))}_.R=function(t){if(dt(this)||dt(t))return Nn;if(xe(this))return xe(t)?le(this).R(le(t)):le(le(this).R(t));if(xe(t))return le(this.R(le(t)));if(0>this.X(ad)&&0>t.X(ad))return et(this.ea()*t.ea());for(var e=this.g.length+t.g.length,n=[],s=0;s<2*e;s++)n[s]=0;for(s=0;s<this.g.length;s++)for(var r=0;r<t.g.length;r++){var i=this.D(s)>>>16,o=this.D(s)&65535,a=t.D(r)>>>16,l=t.D(r)&65535;n[2*s+2*r]+=o*l,si(n,2*s+2*r),n[2*s+2*r+1]+=i*l,si(n,2*s+2*r+1),n[2*s+2*r+1]+=o*a,si(n,2*s+2*r+1),n[2*s+2*r+2]+=i*a,si(n,2*s+2*r+2)}for(s=0;s<e;s++)n[s]=n[2*s+1]<<16|n[2*s];for(s=e;s<2*e;s++)n[s]=0;return new U(n,0)};function si(t,e){for(;(t[e]&65535)!=t[e];)t[e+1]+=t[e]>>>16,t[e]&=65535,e++}function ps(t,e){this.g=t,this.h=e}function ci(t,e){if(dt(e))throw Error("division by zero");if(dt(t))return new ps(Nn,Nn);if(xe(t))return e=ci(le(t),e),new ps(le(e.g),le(e.h));if(xe(e))return e=ci(t,le(e)),new ps(le(e.g),e.h);if(30<t.g.length){if(xe(t)||xe(e))throw Error("slowDivide_ only works with positive integers.");for(var n=Sa,s=e;0>=s.X(t);)n=ld(n),s=ld(s);var r=Rn(n,1),i=Rn(s,1);for(s=Rn(s,2),n=Rn(n,2);!dt(s);){var o=i.add(s);0>=o.X(t)&&(r=r.add(n),i=o),s=Rn(s,1),n=Rn(n,1)}return e=li(t,r.R(e)),new ps(r,e)}for(r=Nn;0<=t.X(e);){for(n=Math.max(1,Math.floor(t.ea()/e.ea())),s=Math.ceil(Math.log(n)/Math.LN2),s=48>=s?1:Math.pow(2,s-48),i=et(n),o=i.R(e);xe(o)||0<o.X(t);)n-=s,i=et(n),o=i.R(e);dt(i)&&(i=Sa),r=r.add(i),t=li(t,o)}return new ps(r,t)}_.gb=function(t){return ci(this,t).h};_.and=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],s=0;s<e;s++)n[s]=this.D(s)&t.D(s);return new U(n,this.h&t.h)};_.or=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],s=0;s<e;s++)n[s]=this.D(s)|t.D(s);return new U(n,this.h|t.h)};_.xor=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],s=0;s<e;s++)n[s]=this.D(s)^t.D(s);return new U(n,this.h^t.h)};function ld(t){for(var e=t.g.length+1,n=[],s=0;s<e;s++)n[s]=t.D(s)<<1|t.D(s-1)>>>31;return new U(n,t.h)}function Rn(t,e){var n=e>>5;e%=32;for(var s=t.g.length-n,r=[],i=0;i<s;i++)r[i]=0<e?t.D(i+n)>>>e|t.D(i+n+1)<<32-e:t.D(i+n);return new U(r,t.h)}ai.prototype.createWebChannel=ai.prototype.g;Ce.prototype.send=Ce.prototype.u;Ce.prototype.open=Ce.prototype.m;Ce.prototype.close=Ce.prototype.close;_i.NO_ERROR=0;_i.TIMEOUT=8;_i.HTTP_ERROR=6;Rd.COMPLETE="complete";Pd.EventType=Ps;Ps.OPEN="a";Ps.CLOSE="b";Ps.ERROR="c";Ps.MESSAGE="d";se.prototype.listen=se.prototype.O;H.prototype.listenOnce=H.prototype.P;H.prototype.getLastError=H.prototype.Sa;H.prototype.getLastErrorCode=H.prototype.Ia;H.prototype.getStatus=H.prototype.da;H.prototype.getResponseJson=H.prototype.Wa;H.prototype.getResponseText=H.prototype.ja;H.prototype.send=H.prototype.ha;H.prototype.setWithCredentials=H.prototype.Oa;Le.prototype.digest=Le.prototype.l;Le.prototype.reset=Le.prototype.reset;Le.prototype.update=Le.prototype.j;U.prototype.add=U.prototype.add;U.prototype.multiply=U.prototype.R;U.prototype.modulo=U.prototype.gb;U.prototype.compare=U.prototype.X;U.prototype.toNumber=U.prototype.ea;U.prototype.toString=U.prototype.toString;U.prototype.getBits=U.prototype.D;U.fromNumber=et;U.fromString=df;var Yy=Ue.createWebChannelTransport=function(){return new ai},Xy=Ue.getStatEventTarget=function(){return gi()},Jy=Ue.ErrorCode=_i,Zy=Ue.EventType=Rd,ev=Ue.Event=Wt,tv=Ue.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},nv=Ue.FetchXmlHttpFactory=ks,sv=Ue.WebChannel=Pd,rv=Ue.XhrIo=H,iv=Ue.Md5=Le,ff=Ue.Integer=U;var pf="@firebase/firestore";var ie=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};ie.UNAUTHENTICATED=new ie(null),ie.GOOGLE_CREDENTIALS=new ie("google-credentials-uid"),ie.FIRST_PARTY=new ie("first-party-uid"),ie.MOCK_USER=new ie("mock-user");var Fs="10.11.1";var Mn=new Ir("@firebase/firestore");function Re(t,...e){if(Mn.logLevel<=hn.DEBUG){let n=e.map(fl);Mn.debug(`Firestore (${Fs}): ${t}`,...n)}}function dl(t,...e){if(Mn.logLevel<=hn.ERROR){let n=e.map(fl);Mn.error(`Firestore (${Fs}): ${t}`,...n)}}function ov(t,...e){if(Mn.logLevel<=hn.WARN){let n=e.map(fl);Mn.warn(`Firestore (${Fs}): ${t}`,...n)}}function fl(t){if(typeof t=="string")return t;try{return function(n){return JSON.stringify(n)}(t)}catch{return t}}function Ee(t="Unexpected state"){let e=`FIRESTORE (${Fs}) INTERNAL ASSERTION FAILED: `+t;throw dl(e),new Error(e)}function Ms(t,e){t||Ee()}var ue={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},ee=class extends Er{constructor(e,n){super(e,n),this.code=e,this.message=n,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var Pt=class{constructor(){this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}};var Ai=class{constructor(e,n){this.user=n,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},Qa=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,n){e.enqueueRetryable(()=>n(ie.UNAUTHENTICATED))}shutdown(){}},Ha=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,n){this.changeListener=n,e.enqueueRetryable(()=>n(this.token.user))}shutdown(){this.changeListener=null}},Ya=class{constructor(e){this.t=e,this.currentUser=ie.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,n){let s=this.i,r=l=>this.i!==s?(s=this.i,n(l)):Promise.resolve(),i=new Pt;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new Pt,e.enqueueRetryable(()=>r(this.currentUser))};let o=()=>{let l=i;e.enqueueRetryable(()=>ae(this,null,function*(){yield l.promise,yield r(this.currentUser)}))},a=l=>{Re("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.auth.addAuthTokenListener(this.o),o()};this.t.onInit(l=>a(l)),setTimeout(()=>{if(!this.auth){let l=this.t.getImmediate({optional:!0});l?a(l):(Re("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new Pt)}},0),o()}getToken(){let e=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then(s=>this.i!==e?(Re("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):s?(Ms(typeof s.accessToken=="string"),new Ai(s.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){let e=this.auth&&this.auth.getUid();return Ms(e===null||typeof e=="string"),new ie(e)}},Xa=class{constructor(e,n,s){this.l=e,this.h=n,this.P=s,this.type="FirstParty",this.user=ie.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);let e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}},Ja=class{constructor(e,n,s){this.l=e,this.h=n,this.P=s}getToken(){return Promise.resolve(new Xa(this.l,this.h,this.P))}start(e,n){e.enqueueRetryable(()=>n(ie.FIRST_PARTY))}shutdown(){}invalidateToken(){}},Za=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},el=class{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,n){let s=i=>{i.error!=null&&Re("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);let o=i.token!==this.R;return this.R=i.token,Re("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?n(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>s(i))};let r=i=>{Re("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.appCheck.addTokenListener(this.o)};this.A.onInit(i=>r(i)),setTimeout(()=>{if(!this.appCheck){let i=this.A.getImmediate({optional:!0});i?r(i):Re("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(n=>n?(Ms(typeof n.token=="string"),this.R=n.token,new Za(n.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}};function av(t){let e=typeof self<"u"&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(n);else for(let s=0;s<t;s++)n[s]=Math.floor(256*Math.random());return n}var tl=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=Math.floor(256/e.length)*e.length,s="";for(;s.length<20;){let r=av(40);for(let i=0;i<r.length;++i)s.length<20&&r[i]<n&&(s+=e.charAt(r[i]%e.length))}return s}};function vf(t,e){return t<e?-1:t>e?1:0}var nl=class t{constructor(e,n,s){n===void 0?n=0:n>e.length&&Ee(),s===void 0?s=e.length-n:s>e.length-n&&Ee(),this.segments=e,this.offset=n,this.len=s}get length(){return this.len}isEqual(e){return t.comparator(this,e)===0}child(e){let n=this.segments.slice(this.offset,this.limit());return e instanceof t?e.forEach(s=>{n.push(s)}):n.push(e),this.construct(n)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}forEach(e){for(let n=this.offset,s=this.limit();n<s;n++)e(this.segments[n])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,n){let s=Math.min(e.length,n.length);for(let r=0;r<s;r++){let i=e.get(r),o=n.get(r);if(i<o)return-1;if(i>o)return 1}return e.length<n.length?-1:e.length>n.length?1:0}},Rt=class t extends nl{construct(e,n,s){return new t(e,n,s)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let n=[];for(let s of e){if(s.indexOf("//")>=0)throw new ee(ue.INVALID_ARGUMENT,`Invalid segment (${s}). Paths must not contain // in them.`);n.push(...s.split("/").filter(r=>r.length>0))}return new t(n)}static emptyPath(){return new t([])}};var Qt=class t{constructor(e){this.path=e}static fromPath(e){return new t(Rt.fromString(e))}static fromName(e){return new t(Rt.fromString(e).popFirst(5))}static empty(){return new t(Rt.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Rt.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,n){return Rt.comparator(e.path,n.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new t(new Rt(e.slice()))}};var sl=class{constructor(e,n,s,r){this.indexId=e,this.collectionGroup=n,this.fields=s,this.indexState=r}};sl.UNKNOWN_ID=-1;function Ef(t){return t.name==="IndexedDbTransactionError"}function lv(t){return t===0&&1/t==-1/0}var cv=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],nS=[...cv,"documentOverlays"],uv=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],hv=uv,sS=[...hv,"indexConfiguration","indexState","indexEntries"];var Fn=class t{constructor(e,n){this.comparator=e,this.root=n||nt.EMPTY}insert(e,n){return new t(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,nt.BLACK,null,null))}remove(e){return new t(this.comparator,this.root.remove(e,this.comparator).copy(null,null,nt.BLACK,null,null))}get(e){let n=this.root;for(;!n.isEmpty();){let s=this.comparator(e,n.key);if(s===0)return n.value;s<0?n=n.left:s>0&&(n=n.right)}return null}indexOf(e){let n=0,s=this.root;for(;!s.isEmpty();){let r=this.comparator(e,s.key);if(r===0)return n+s.left.size;r<0?s=s.left:(n+=s.left.size+1,s=s.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((n,s)=>(e(n,s),!1))}toString(){let e=[];return this.inorderTraversal((n,s)=>(e.push(`${n}:${s}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new On(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new On(this.root,e,this.comparator,!1)}getReverseIterator(){return new On(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new On(this.root,e,this.comparator,!0)}},On=class{constructor(e,n,s,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=n?s(e.key,n):1,n&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),n={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return n}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},nt=class t{constructor(e,n,s,r,i){this.key=e,this.value=n,this.color=s??t.RED,this.left=r??t.EMPTY,this.right=i??t.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,n,s,r,i){return new t(e??this.key,n??this.value,s??this.color,r??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,s){let r=this,i=s(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,n,s),null):i===0?r.copy(null,n,null,null,null):r.copy(null,null,null,null,r.right.insert(e,n,s)),r.fixUp()}removeMin(){if(this.left.isEmpty())return t.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,n){let s,r=this;if(n(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,n),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),n(e,r.key)===0){if(r.right.isEmpty())return t.EMPTY;s=r.right.min(),r=r.copy(s.key,s.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,n))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){let e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth(){let e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw Ee();let e=this.left.check();if(e!==this.right.check())throw Ee();return e+(this.isRed()?0:1)}};nt.EMPTY=null,nt.RED=!0,nt.BLACK=!1;nt.EMPTY=new class{constructor(){this.size=0}get key(){throw Ee()}get value(){throw Ee()}get color(){throw Ee()}get left(){throw Ee()}get right(){throw Ee()}copy(e,n,s,r,i){return this}insert(e,n,s){return new nt(e,n)}remove(e,n){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var bi=class t{constructor(e){this.comparator=e,this.data=new Fn(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((n,s)=>(e(n),!1))}forEachInRange(e,n){let s=this.data.getIteratorFrom(e[0]);for(;s.hasNext();){let r=s.getNext();if(this.comparator(r.key,e[1])>=0)return;n(r.key)}}forEachWhile(e,n){let s;for(s=n!==void 0?this.data.getIteratorFrom(n):this.data.getIterator();s.hasNext();)if(!e(s.getNext().key))return}firstAfterOrEqual(e){let n=this.data.getIteratorFrom(e);return n.hasNext()?n.getNext().key:null}getIterator(){return new Ci(this.data.getIterator())}getIteratorFrom(e){return new Ci(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let n=this;return n.size<e.size&&(n=e,e=this),e.forEach(s=>{n=n.add(s)}),n}isEqual(e){if(!(e instanceof t)||this.size!==e.size)return!1;let n=this.data.getIterator(),s=e.data.getIterator();for(;n.hasNext();){let r=n.getNext().key,i=s.getNext().key;if(this.comparator(r,i)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(n=>{e.push(n)}),e}toString(){let e=[];return this.forEach(n=>e.push(n)),"SortedSet("+e.toString()+")"}copy(e){let n=new t(this.comparator);return n.data=e,n}},Ci=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};var rl=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};var Vn=class t{constructor(e){this.binaryString=e}static fromBase64String(e){let n=function(r){try{return atob(r)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new rl("Invalid base64 string: "+i):i}}(e);return new t(n)}static fromUint8Array(e){let n=function(r){let i="";for(let o=0;o<r.length;++o)i+=String.fromCharCode(r[o]);return i}(e);return new t(n)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(n){return btoa(n)}(this.binaryString)}toUint8Array(){return function(n){let s=new Uint8Array(n.length);for(let r=0;r<n.length;r++)s[r]=n.charCodeAt(r);return s}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return vf(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};Vn.EMPTY_BYTE_STRING=new Vn("");var dv=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function fv(t){if(Ms(!!t),typeof t=="string"){let e=0,n=dv.exec(t);if(Ms(!!n),n[1]){let r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}let s=new Date(t);return{seconds:Math.floor(s.getTime()/1e3),nanos:e}}return{seconds:Ri(t.seconds),nanos:Ri(t.nanos)}}function Ri(t){return typeof t=="number"?t:typeof t=="string"?Number(t):0}function pv(t){return typeof t=="string"?Vn.fromBase64String(t):Vn.fromUint8Array(t)}var il=class{constructor(e,n,s,r,i,o,a,l,c){this.databaseId=e,this.appId=n,this.persistenceKey=s,this.host=r,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=l,this.useFetchStreams=c}},ol=class t{constructor(e,n){this.projectId=e,this.database=n||"(default)"}static empty(){return new t("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof t&&e.projectId===this.projectId&&e.database===this.database}};function mv(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}var iS=new Fn(Qt.comparator);var oS=new Fn(Qt.comparator);var aS=new Fn(Qt.comparator),lS=new bi(Qt.comparator);var cS=new bi(vf);var mf,k;(k=mf||(mf={}))[k.OK=0]="OK",k[k.CANCELLED=1]="CANCELLED",k[k.UNKNOWN=2]="UNKNOWN",k[k.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",k[k.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",k[k.NOT_FOUND=5]="NOT_FOUND",k[k.ALREADY_EXISTS=6]="ALREADY_EXISTS",k[k.PERMISSION_DENIED=7]="PERMISSION_DENIED",k[k.UNAUTHENTICATED=16]="UNAUTHENTICATED",k[k.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",k[k.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",k[k.ABORTED=10]="ABORTED",k[k.OUT_OF_RANGE=11]="OUT_OF_RANGE",k[k.UNIMPLEMENTED=12]="UNIMPLEMENTED",k[k.INTERNAL=13]="INTERNAL",k[k.UNAVAILABLE=14]="UNAVAILABLE",k[k.DATA_LOSS=15]="DATA_LOSS";var uS=new ff([4294967295,4294967295],0);var Pi=class{constructor(){}ht(e,n){this.Pt(e,n),n.It()}Pt(e,n){if("nullValue"in e)this.Tt(n,5);else if("booleanValue"in e)this.Tt(n,10),n.Et(e.booleanValue?1:0);else if("integerValue"in e)this.Tt(n,15),n.Et(Ri(e.integerValue));else if("doubleValue"in e){let s=Ri(e.doubleValue);isNaN(s)?this.Tt(n,13):(this.Tt(n,15),lv(s)?n.Et(0):n.Et(s))}else if("timestampValue"in e){let s=e.timestampValue;this.Tt(n,20),typeof s=="string"&&(s=fv(s)),n.dt(`${s.seconds||""}`),n.Et(s.nanos||0)}else if("stringValue"in e)this.At(e.stringValue,n),this.Rt(n);else if("bytesValue"in e)this.Tt(n,30),n.Vt(pv(e.bytesValue)),this.Rt(n);else if("referenceValue"in e)this.ft(e.referenceValue,n);else if("geoPointValue"in e){let s=e.geoPointValue;this.Tt(n,45),n.Et(s.latitude||0),n.Et(s.longitude||0)}else"mapValue"in e?mv(e)?this.Tt(n,Number.MAX_SAFE_INTEGER):(this.gt(e.mapValue,n),this.Rt(n)):"arrayValue"in e?(this.yt(e.arrayValue,n),this.Rt(n)):Ee()}At(e,n){this.Tt(n,25),this.wt(e,n)}wt(e,n){n.dt(e)}gt(e,n){let s=e.fields||{};this.Tt(n,55);for(let r of Object.keys(s))this.At(r,n),this.Pt(s[r],n)}yt(e,n){let s=e.values||[];this.Tt(n,50);for(let r of s)this.Pt(r,n)}ft(e,n){this.Tt(n,37),Qt.fromName(e).path.forEach(s=>{this.Tt(n,60),this.wt(s,n)})}Tt(e,n){e.Et(n)}Rt(e){e.Et(2)}};Pi.St=new Pi;var hS=new Uint8Array(0);var tt=class t{constructor(e,n,s){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=n,this.maximumSequenceNumbersToCollect=s}static withCacheSize(e){return new t(e,t.DEFAULT_COLLECTION_PERCENTILE,t.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}};tt.DEFAULT_COLLECTION_PERCENTILE=10,tt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,tt.DEFAULT=new tt(41943040,tt.DEFAULT_COLLECTION_PERCENTILE,tt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),tt.DISABLED=new tt(-1,0,0);function Wa(){return typeof document<"u"?document:null}var al=class{constructor(e,n,s=1e3,r=1.5,i=6e4){this.si=e,this.timerId=n,this.Oo=s,this.No=r,this.Lo=i,this.Bo=0,this.ko=null,this.qo=Date.now(),this.reset()}reset(){this.Bo=0}Qo(){this.Bo=this.Lo}Ko(e){this.cancel();let n=Math.floor(this.Bo+this.$o()),s=Math.max(0,Date.now()-this.qo),r=Math.max(0,n-s);r>0&&Re("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.Bo} ms, delay with jitter: ${n} ms, last attempt: ${s} ms ago)`),this.ko=this.si.enqueueAfterDelay(this.timerId,r,()=>(this.qo=Date.now(),e())),this.Bo*=this.No,this.Bo<this.Oo&&(this.Bo=this.Oo),this.Bo>this.Lo&&(this.Bo=this.Lo)}Uo(){this.ko!==null&&(this.ko.skipDelay(),this.ko=null)}cancel(){this.ko!==null&&(this.ko.cancel(),this.ko=null)}$o(){return(Math.random()-.5)*this.Bo}};var ll=class t{constructor(e,n,s,r,i){this.asyncQueue=e,this.timerId=n,this.targetTimeMs=s,this.op=r,this.removalCallback=i,this.deferred=new Pt,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,n,s,r,i){let o=Date.now()+s,a=new t(e,n,o,r,i);return a.start(s),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new ee(ue.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function gv(t,e){if(dl("AsyncQueue",`${e}: ${t}`),Ef(t))return new ee(ue.UNAVAILABLE,`${e}: ${t}`);throw t}var gf,_f;(_f=gf||(gf={})).J_="default",_f.Cache="cache";var cl=class{constructor(e,n,s,r){this.authCredentials=e,this.appCheckCredentials=n,this.asyncQueue=s,this.databaseInfo=r,this.user=ie.UNAUTHENTICATED,this.clientId=tl.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(s,i=>ae(this,null,function*(){Re("FirestoreClient","Received user=",i.uid),yield this.authCredentialListener(i),this.user=i})),this.appCheckCredentials.start(s,i=>(Re("FirestoreClient","Received new app check token=",i),this.appCheckCredentialListener(i,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new ee(ue.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();let e=new Pt;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>ae(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){let s=gv(n,"Failed to shutdown persistence");e.reject(s)}})),e.promise}};function wf(t){let e={};return t.timeoutSeconds!==void 0&&(e.timeoutSeconds=t.timeoutSeconds),e}var yf=new Map;function _v(t,e,n,s){if(e===!0&&s===!0)throw new ee(ue.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`)}function yv(t){if(t===void 0)return"undefined";if(t===null)return"null";if(typeof t=="string")return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if(typeof t=="number"||typeof t=="boolean")return""+t;if(typeof t=="object"){if(t instanceof Array)return"an array";{let e=function(s){return s.constructor?s.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return typeof t=="function"?"a function":Ee()}function vv(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new ee(ue.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let n=yv(t);throw new ee(ue.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}var Ni=class{constructor(e){var n,s;if(e.host===void 0){if(e.ssl!==void 0)throw new ee(ue.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(n=e.ssl)===null||n===void 0||n;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new ee(ue.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}_v("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=wf((s=e.experimentalLongPollingOptions)!==null&&s!==void 0?s:{}),function(i){if(i.timeoutSeconds!==void 0){if(isNaN(i.timeoutSeconds))throw new ee(ue.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (must not be NaN)`);if(i.timeoutSeconds<5)throw new ee(ue.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (minimum allowed value is 5)`);if(i.timeoutSeconds>30)throw new ee(ue.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(s,r){return s.timeoutSeconds===r.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}},Di=class{constructor(e,n,s,r){this._authCredentials=e,this._appCheckCredentials=n,this._databaseId=s,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Ni({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new ee(ue.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(e){if(this._settingsFrozen)throw new ee(ue.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Ni(e),e.credentials!==void 0&&(this._authCredentials=function(s){if(!s)return new Qa;switch(s.type){case"firstParty":return new Ja(s.sessionIndex||"0",s.iamToken||null,s.authTokenFactory||null);case"provider":return s.client;default:throw new ee(ue.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(n){let s=yf.get(n);s&&(Re("ComponentProvider","Removing Datastore"),yf.delete(n),s.terminate())}(this),Promise.resolve()}};function Tf(t,e,n,s={}){var r;let i=(t=vv(t,Di))._getSettings(),o=`${e}:${n}`;if(i.host!=="firestore.googleapis.com"&&i.host!==o&&ov("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),t._setSettings(Object.assign(Object.assign({},i),{host:o,ssl:!1})),s.mockUserToken){let a,l;if(typeof s.mockUserToken=="string")a=s.mockUserToken,l=ie.MOCK_USER;else{a=cn(s.mockUserToken,(r=t._app)===null||r===void 0?void 0:r.options.projectId);let c=s.mockUserToken.sub||s.mockUserToken.user_id;if(!c)throw new ee(ue.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");l=new ie(c)}t._authCredentials=new Ha(new Ai(a,l))}}var ul=class{constructor(){this.iu=Promise.resolve(),this.su=[],this.ou=!1,this._u=[],this.au=null,this.uu=!1,this.cu=!1,this.lu=[],this.Jo=new al(this,"async_queue_retry"),this.hu=()=>{let n=Wa();n&&Re("AsyncQueue","Visibility state changed to "+n.visibilityState),this.Jo.Uo()};let e=Wa();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this.hu)}get isShuttingDown(){return this.ou}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Pu(),this.Iu(e)}enterRestrictedMode(e){if(!this.ou){this.ou=!0,this.cu=e||!1;let n=Wa();n&&typeof n.removeEventListener=="function"&&n.removeEventListener("visibilitychange",this.hu)}}enqueue(e){if(this.Pu(),this.ou)return new Promise(()=>{});let n=new Pt;return this.Iu(()=>this.ou&&this.cu?Promise.resolve():(e().then(n.resolve,n.reject),n.promise)).then(()=>n.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.su.push(e),this.Tu()))}Tu(){return ae(this,null,function*(){if(this.su.length!==0){try{yield this.su[0](),this.su.shift(),this.Jo.reset()}catch(e){if(!Ef(e))throw e;Re("AsyncQueue","Operation failed with retryable error: "+e)}this.su.length>0&&this.Jo.Ko(()=>this.Tu())}})}Iu(e){let n=this.iu.then(()=>(this.uu=!0,e().catch(s=>{this.au=s,this.uu=!1;let r=function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),a}(s);throw dl("INTERNAL UNHANDLED ERROR: ",r),s}).then(s=>(this.uu=!1,s))));return this.iu=n,n}enqueueAfterDelay(e,n,s){this.Pu(),this.lu.indexOf(e)>-1&&(n=0);let r=ll.createAndSchedule(this,e,n,s,i=>this.Eu(i));return this._u.push(r),r}Pu(){this.au&&Ee()}verifyOperationInProgress(){}du(){return ae(this,null,function*(){let e;do e=this.iu,yield e;while(e!==this.iu)})}Au(e){for(let n of this._u)if(n.timerId===e)return!0;return!1}Ru(e){return this.du().then(()=>{this._u.sort((n,s)=>n.targetTimeMs-s.targetTimeMs);for(let n of this._u)if(n.skipDelay(),e!=="all"&&n.timerId===e)break;return this.du()})}Vu(e){this.lu.push(e)}Eu(e){let n=this._u.indexOf(e);this._u.splice(n,1)}};var hl=class extends Di{constructor(e,n,s,r){super(e,n,s,r),this.type="firestore",this._queue=function(){return new ul}(),this._persistenceKey=r?.name||"[DEFAULT]"}_terminate(){return this._firestoreClient||Ev(this),this._firestoreClient.terminate()}};function If(t,e){let n=typeof t=="object"?t:mn(),s=typeof t=="string"?t:e||"(default)",r=fn(n,"firestore").getImmediate({identifier:s});if(!r._initialized){let i=ln("firestore");i&&Tf(r,...i)}return r}function Ev(t){var e,n,s;let r=t._freezeSettings(),i=function(a,l,c,u){return new il(a,l,c,u.host,u.ssl,u.experimentalForceLongPolling,u.experimentalAutoDetectLongPolling,wf(u.experimentalLongPollingOptions),u.useFetchStreams)}(t._databaseId,((e=t._app)===null||e===void 0?void 0:e.options.appId)||"",t._persistenceKey,r);t._firestoreClient=new cl(t._authCredentials,t._appCheckCredentials,t._queue,i),!((n=r.localCache)===null||n===void 0)&&n._offlineComponentProvider&&(!((s=r.localCache)===null||s===void 0)&&s._onlineComponentProvider)&&(t._firestoreClient._uninitializedComponentsProvider={_offlineKind:r.localCache.kind,_offline:r.localCache._offlineComponentProvider,_online:r.localCache._onlineComponentProvider})}var dS=new RegExp("[~\\*/\\[\\]]");(function(e,n=!0){(function(r){Fs=r})(pn),dn(new un("firestore",(s,{instanceIdentifier:r,options:i})=>{let o=s.getProvider("app").getImmediate(),a=new hl(new Ya(s.getProvider("auth-internal")),new el(s.getProvider("app-check-internal")),function(c,u){if(!Object.prototype.hasOwnProperty.apply(c.options,["projectId"]))throw new ee(ue.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new ol(c.options.projectId,u)}(o,r),o);return i=Object.assign({useFetchStreams:n},i),a._setSettings(i),a},"PUBLIC").setMultipleInstances(!0)),_e(pf,"4.6.1",e),_e(pf,"4.6.1","esm2017")})();var pt=class{constructor(e){return e}},Sf="firestore",pl=class{constructor(){return yn(Sf)}};var ml=new Z("angularfire2.firestore-instances");function wv(t,e){let n=_n(Sf,t,e);return n&&new pt(n)}function Tv(t){return(e,n)=>{let s=e.runOutsideAngular(()=>t(n));return new pt(s)}}var Iv={provide:pl,deps:[[new ge,ml]]},Sv={provide:pt,useFactory:wv,deps:[[new ge,ml],wn]},Av=(()=>{class t{constructor(){_e("angularfire",gn.full,"fst")}static \u0275fac=function(s){return new(s||t)};static \u0275mod=ut({type:t});static \u0275inj=ct({providers:[Sv,Iv]})}return t})();function Af(t,...e){return{ngModule:Av,providers:[{provide:ml,useFactory:Tv(t),multi:!0,deps:[Ge,on,En,Tn,[new ge,In],[new ge,vn],...e]}]}}var bf=He(If,!0);var kf="firebasestorage.googleapis.com",bv="storageBucket",Cv=2*60*1e3,Rv=10*60*1e3;var st=class t extends Er{constructor(e,n,s=0){super(gl(e),`Firebase Storage: ${n} (${gl(e)})`),this.status_=s,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,t.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return gl(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}},gt=function(t){return t.UNKNOWN="unknown",t.OBJECT_NOT_FOUND="object-not-found",t.BUCKET_NOT_FOUND="bucket-not-found",t.PROJECT_NOT_FOUND="project-not-found",t.QUOTA_EXCEEDED="quota-exceeded",t.UNAUTHENTICATED="unauthenticated",t.UNAUTHORIZED="unauthorized",t.UNAUTHORIZED_APP="unauthorized-app",t.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",t.INVALID_CHECKSUM="invalid-checksum",t.CANCELED="canceled",t.INVALID_EVENT_NAME="invalid-event-name",t.INVALID_URL="invalid-url",t.INVALID_DEFAULT_BUCKET="invalid-default-bucket",t.NO_DEFAULT_BUCKET="no-default-bucket",t.CANNOT_SLICE_BLOB="cannot-slice-blob",t.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",t.NO_DOWNLOAD_URL="no-download-url",t.INVALID_ARGUMENT="invalid-argument",t.INVALID_ARGUMENT_COUNT="invalid-argument-count",t.APP_DELETED="app-deleted",t.INVALID_ROOT_OPERATION="invalid-root-operation",t.INVALID_FORMAT="invalid-format",t.INTERNAL_ERROR="internal-error",t.UNSUPPORTED_ENVIRONMENT="unsupported-environment",t}(gt||{});function gl(t){return"storage/"+t}function Pv(){let t="An unknown error occurred, please check the error payload for server response.";return new st(gt.UNKNOWN,t)}function Nv(){return new st(gt.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function Dv(){return new st(gt.CANCELED,"User canceled the upload/download.")}function kv(t){return new st(gt.INVALID_URL,"Invalid URL '"+t+"'.")}function xv(t){return new st(gt.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+t+"'.")}function Cf(t){return new st(gt.INVALID_ARGUMENT,t)}function xf(){return new st(gt.APP_DELETED,"The Firebase app was deleted.")}function Ov(t){return new st(gt.INVALID_ROOT_OPERATION,"The operation '"+t+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}var mt=class t{constructor(e,n){this.bucket=e,this.path_=n}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){let e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,n){let s;try{s=t.makeFromUrl(e,n)}catch{return new t(e,"")}if(s.path==="")return s;throw xv(e)}static makeFromUrl(e,n){let s=null,r="([A-Za-z0-9.\\-_]+)";function i(E){E.path.charAt(E.path.length-1)==="/"&&(E.path_=E.path_.slice(0,-1))}let o="(/(.*))?$",a=new RegExp("^gs://"+r+o,"i"),l={bucket:1,path:3};function c(E){E.path_=decodeURIComponent(E.path)}let u="v[A-Za-z0-9_]+",h=n.replace(/[.]/g,"\\."),d="(/([^?#]*).*)?$",p=new RegExp(`^https?://${h}/${u}/b/${r}/o${d}`,"i"),f={bucket:1,path:3},m=n===kf?"(?:storage.googleapis.com|storage.cloud.google.com)":n,y="([^?#]*)",I=new RegExp(`^https?://${m}/${r}/${y}`,"i"),x=[{regex:a,indices:l,postModify:i},{regex:p,indices:f,postModify:c},{regex:I,indices:{bucket:1,path:2},postModify:c}];for(let E=0;E<x.length;E++){let F=x[E],A=F.regex.exec(e);if(A){let q=A[F.indices.bucket],L=A[F.indices.path];L||(L=""),s=new t(q,L),F.postModify(s);break}}if(s==null)throw kv(e);return s}},_l=class{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}};function Mv(t,e,n){let s=1,r=null,i=null,o=!1,a=0;function l(){return a===2}let c=!1;function u(...y){c||(c=!0,e.apply(null,y))}function h(y){r=setTimeout(()=>{r=null,t(p,l())},y)}function d(){i&&clearTimeout(i)}function p(y,...I){if(c){d();return}if(y){d(),u.call(null,y,...I);return}if(l()||o){d(),u.call(null,y,...I);return}s<64&&(s*=2);let x;a===1?(a=2,x=0):x=(s+Math.random())*1e3,h(x)}let f=!1;function m(y){f||(f=!0,d(),!c&&(r!==null?(y||(a=2),clearTimeout(r),h(0)):y||(a=1)))}return h(0),i=setTimeout(()=>{o=!0,m(!0)},n),m}function Fv(t){t(!1)}function Vv(t){return t!==void 0}function Rf(t,e,n,s){if(s<e)throw Cf(`Invalid value for '${t}'. Expected ${e} or greater.`);if(s>n)throw Cf(`Invalid value for '${t}'. Expected ${n} or less.`)}function Lv(t){let e=encodeURIComponent,n="?";for(let s in t)if(t.hasOwnProperty(s)){let r=e(s)+"="+e(t[s]);n=n+r+"&"}return n=n.slice(0,-1),n}var yl=function(t){return t[t.NO_ERROR=0]="NO_ERROR",t[t.NETWORK_ERROR=1]="NETWORK_ERROR",t[t.ABORT=2]="ABORT",t}(yl||{});function Uv(t,e){let n=t>=500&&t<600,r=[408,429].indexOf(t)!==-1,i=e.indexOf(t)!==-1;return n||r||i}var vl=class{constructor(e,n,s,r,i,o,a,l,c,u,h,d=!0){this.url_=e,this.method_=n,this.headers_=s,this.body_=r,this.successCodes_=i,this.additionalRetryCodes_=o,this.callback_=a,this.errorCallback_=l,this.timeout_=c,this.progressCallback_=u,this.connectionFactory_=h,this.retry=d,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((p,f)=>{this.resolve_=p,this.reject_=f,this.start_()})}start_(){let e=(s,r)=>{if(r){s(!1,new Ln(!1,null,!0));return}let i=this.connectionFactory_();this.pendingConnection_=i;let o=a=>{let l=a.loaded,c=a.lengthComputable?a.total:-1;this.progressCallback_!==null&&this.progressCallback_(l,c)};this.progressCallback_!==null&&i.addUploadProgressListener(o),i.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&i.removeUploadProgressListener(o),this.pendingConnection_=null;let a=i.getErrorCode()===yl.NO_ERROR,l=i.getStatus();if(!a||Uv(l,this.additionalRetryCodes_)&&this.retry){let u=i.getErrorCode()===yl.ABORT;s(!1,new Ln(!1,null,u));return}let c=this.successCodes_.indexOf(l)!==-1;s(!0,new Ln(c,i))})},n=(s,r)=>{let i=this.resolve_,o=this.reject_,a=r.connection;if(r.wasSuccessCode)try{let l=this.callback_(a,a.getResponse());Vv(l)?i(l):i()}catch(l){o(l)}else if(a!==null){let l=Pv();l.serverResponse=a.getErrorText(),this.errorCallback_?o(this.errorCallback_(a,l)):o(l)}else if(r.canceled){let l=this.appDelete_?xf():Dv();o(l)}else{let l=Nv();o(l)}};this.canceled_?n(!1,new Ln(!1,null,!0)):this.backoffId_=Mv(e,n,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&Fv(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}},Ln=class{constructor(e,n,s){this.wasSuccessCode=e,this.connection=n,this.canceled=!!s}};function Bv(t,e){e!==null&&e.length>0&&(t.Authorization="Firebase "+e)}function qv(t,e){t["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function $v(t,e){e&&(t["X-Firebase-GMPID"]=e)}function zv(t,e){e!==null&&(t["X-Firebase-AppCheck"]=e)}function jv(t,e,n,s,r,i,o=!0){let a=Lv(t.urlParams),l=t.url+a,c=Object.assign({},t.headers);return $v(c,e),Bv(c,n),qv(c,i),zv(c,s),new vl(l,t.method,c,t.body,t.successCodes,t.additionalRetryCodes,t.handler,t.errorHandler,t.timeout,t.progressCallback,r,o)}function Gv(t){if(t.length===0)return null;let e=t.lastIndexOf("/");return e===-1?"":t.slice(0,e)}function Kv(t){let e=t.lastIndexOf("/",t.length-2);return e===-1?t:t.slice(e+1)}var qA=256*1024;var El=class t{constructor(e,n){this._service=e,n instanceof mt?this._location=n:this._location=mt.makeFromUrl(n,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,n){return new t(e,n)}get root(){let e=new mt(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return Kv(this._location.path)}get storage(){return this._service}get parent(){let e=Gv(this._location.path);if(e===null)return null;let n=new mt(this._location.bucket,e);return new t(this._service,n)}_throwIfRoot(e){if(this._location.path==="")throw Ov(e)}};function Pf(t,e){let n=e?.[bv];return n==null?null:mt.makeFromBucketSpec(n,t)}function Wv(t,e,n,s={}){t.host=`${e}:${n}`,t._protocol="http";let{mockUserToken:r}=s;r&&(t._overrideAuthToken=typeof r=="string"?r:cn(r,t.app.options.projectId))}var wl=class{constructor(e,n,s,r,i){this.app=e,this._authProvider=n,this._appCheckProvider=s,this._url=r,this._firebaseVersion=i,this._bucket=null,this._host=kf,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=Cv,this._maxUploadRetryTime=Rv,this._requests=new Set,r!=null?this._bucket=mt.makeFromBucketSpec(r,this._host):this._bucket=Pf(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=mt.makeFromBucketSpec(this._url,e):this._bucket=Pf(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){Rf("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){Rf("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}_getAuthToken(){return ae(this,null,function*(){if(this._overrideAuthToken)return this._overrideAuthToken;let e=this._authProvider.getImmediate({optional:!0});if(e){let n=yield e.getToken();if(n!==null)return n.accessToken}return null})}_getAppCheckToken(){return ae(this,null,function*(){let e=this._appCheckProvider.getImmediate({optional:!0});return e?(yield e.getToken()).token:null})}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new El(this,e)}_makeRequest(e,n,s,r,i=!0){if(this._deleted)return new _l(xf());{let o=jv(e,this._appId,s,r,n,this._firebaseVersion,i);return this._requests.add(o),o.getPromise().then(()=>this._requests.delete(o),()=>this._requests.delete(o)),o}}makeRequestWithTokens(e,n){return ae(this,null,function*(){let[s,r]=yield Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,n,s,r).getPromise()})}},Nf="@firebase/storage",Df="0.12.4";var Of="storage";function Mf(t=mn(),e){t=Qe(t);let s=fn(t,Of).getImmediate({identifier:e}),r=ln("storage");return r&&Ff(s,...r),s}function Ff(t,e,n,s={}){Wv(t,e,n,s)}function Qv(t,{instanceIdentifier:e}){let n=t.getProvider("app").getImmediate(),s=t.getProvider("auth-internal"),r=t.getProvider("app-check-internal");return new wl(n,s,r,e,pn)}function Hv(){dn(new un(Of,Qv,"PUBLIC").setMultipleInstances(!0)),_e(Nf,Df,""),_e(Nf,Df,"esm2017")}Hv();var Vs=class{constructor(e){return e}},Vf="storage",Tl=class{constructor(){return yn(Vf)}};var Il=new Z("angularfire2.storage-instances");function Yv(t,e){let n=_n(Vf,t,e);return n&&new Vs(n)}function Xv(t){return(e,n)=>{let s=e.runOutsideAngular(()=>t(n));return new Vs(s)}}var Jv={provide:Tl,deps:[[new ge,Il]]},Zv={provide:Vs,useFactory:Yv,deps:[[new ge,Il],wn]},eE=(()=>{class t{constructor(){_e("angularfire",gn.full,"gcs")}static \u0275fac=function(s){return new(s||t)};static \u0275mod=ut({type:t});static \u0275inj=ct({providers:[Zv,Jv]})}return t})();function Lf(t,...e){return{ngModule:eE,providers:[{provide:Il,useFactory:Xv(t),multi:!0,deps:[Ge,on,En,Tn,[new ge,In],[new ge,vn],...e]}]}}var Uf=He(Mf,!0);var Bf="@firebase/database",qf="1.0.4";var bc="";function tE(t){bc=t}var Dl=class{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,n){n==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),X(n))}get(e){let n=this.domStorage_.getItem(this.prefixedName_(e));return n==null?null:wr(n)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}};var kl=class{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,n){n==null?delete this.cache_[e]:this.cache_[e]=n}get(e){return We(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}};var yp=function(t){try{if(typeof window<"u"&&typeof window[t]<"u"){let e=window[t];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new Dl(e)}}catch{}return new kl},Yt=yp("localStorage"),xl=yp("sessionStorage");var qn=new Ir("@firebase/database"),nE=function(){let t=1;return function(){return t++}}(),vp=function(t){let e=sh(t),n=new nh;n.update(e);let s=n.digest();return Hu.encodeByteArray(s)},tr=function(...t){let e="";for(let n=0;n<t.length;n++){let s=t[n];Array.isArray(s)||s&&typeof s=="object"&&typeof s.length=="number"?e+=tr.apply(null,s):typeof s=="object"?e+=X(s):e+=s,e+=" "}return e},Jt=null,$f=!0,sE=function(t,e){g(!e||t===!0||t===!1,"Can't turn on custom loggers persistently."),t===!0?(qn.logLevel=hn.VERBOSE,Jt=qn.log.bind(qn),e&&xl.set("logging_enabled",!0)):typeof t=="function"?Jt=t:(Jt=null,xl.remove("logging_enabled"))},me=function(...t){if($f===!0&&($f=!1,Jt===null&&xl.get("logging_enabled")===!0&&sE(!0)),Jt){let e=tr.apply(null,t);Jt(e)}},nr=function(t){return function(...e){me(t,...e)}},Ol=function(...t){let e="FIREBASE INTERNAL ERROR: "+tr(...t);qn.error(e)},_t=function(...t){let e=`FIREBASE FATAL ERROR: ${tr(...t)}`;throw qn.error(e),new Error(e)},we=function(...t){let e="FIREBASE WARNING: "+tr(...t);qn.warn(e)},rE=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&we("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},Ep=function(t){return typeof t=="number"&&(t!==t||t===Number.POSITIVE_INFINITY||t===Number.NEGATIVE_INFINITY)},iE=function(t){if(Ke()||document.readyState==="complete")t();else{let e=!1,n=function(){if(!document.body){setTimeout(n,Math.floor(10));return}e||(e=!0,t())};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&n()}),window.attachEvent("onload",n))}},zn="[MIN_NAME]",Zt="[MAX_NAME]",Yn=function(t,e){if(t===e)return 0;if(t===zn||e===Zt)return-1;if(e===zn||t===Zt)return 1;{let n=zf(t),s=zf(e);return n!==null?s!==null?n-s===0?t.length-e.length:n-s:-1:s!==null?1:t<e?-1:1}},oE=function(t,e){return t===e?0:t<e?-1:1},Ls=function(t,e){if(e&&t in e)return e[t];throw new Error("Missing required key ("+t+") in object: "+X(e))},Cc=function(t){if(typeof t!="object"||t===null)return X(t);let e=[];for(let s in t)e.push(s);e.sort();let n="{";for(let s=0;s<e.length;s++)s!==0&&(n+=","),n+=X(e[s]),n+=":",n+=Cc(t[e[s]]);return n+="}",n},wp=function(t,e){let n=t.length;if(n<=e)return[t];let s=[];for(let r=0;r<n;r+=e)r+e>n?s.push(t.substring(r,n)):s.push(t.substring(r,r+e));return s};function Te(t,e){for(let n in t)t.hasOwnProperty(n)&&e(n,t[n])}var Tp=function(t){g(!Ep(t),"Invalid JSON number");let e=11,n=52,s=(1<<e-1)-1,r,i,o,a,l;t===0?(i=0,o=0,r=1/t===-1/0?1:0):(r=t<0,t=Math.abs(t),t>=Math.pow(2,1-s)?(a=Math.min(Math.floor(Math.log(t)/Math.LN2),s),i=a+s,o=Math.round(t*Math.pow(2,n-a)-Math.pow(2,n))):(i=0,o=Math.round(t/Math.pow(2,1-s-n))));let c=[];for(l=n;l;l-=1)c.push(o%2?1:0),o=Math.floor(o/2);for(l=e;l;l-=1)c.push(i%2?1:0),i=Math.floor(i/2);c.push(r?1:0),c.reverse();let u=c.join(""),h="";for(l=0;l<64;l+=8){let d=parseInt(u.substr(l,8),2).toString(16);d.length===1&&(d="0"+d),h=h+d}return h.toLowerCase()},aE=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},lE=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function cE(t,e){let n="Unknown Error";t==="too_big"?n="The data requested exceeds the maximum size that can be accessed with a single request.":t==="permission_denied"?n="Client doesn't have permission to access the desired data.":t==="unavailable"&&(n="The service is unavailable");let s=new Error(t+" at "+e._path.toString()+": "+n);return s.code=t.toUpperCase(),s}var uE=new RegExp("^-?(0*)\\d{1,10}$"),hE=-2147483648,dE=2147483647,zf=function(t){if(uE.test(t)){let e=Number(t);if(e>=hE&&e<=dE)return e}return null},Xn=function(t){try{t()}catch(e){setTimeout(()=>{let n=e.stack||"";throw we("Exception was thrown by user callback.",n),e},Math.floor(0))}},fE=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},zs=function(t,e){let n=setTimeout(t,e);return typeof n=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(n):typeof n=="object"&&n.unref&&n.unref(),n};var Ml=class{constructor(e,n){this.appName_=e,this.appCheckProvider=n,this.appCheck=n?.getImmediate({optional:!0}),this.appCheck||n?.get().then(s=>this.appCheck=s)}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise((n,s)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(n,s):n(null)},0)})}addTokenChangeListener(e){var n;(n=this.appCheckProvider)===null||n===void 0||n.get().then(s=>s.addTokenListener(e))}notifyForInvalidToken(){we(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}};var Fl=class{constructor(e,n,s){this.appName_=e,this.firebaseOptions_=n,this.authProvider_=s,this.auth_=null,this.auth_=s.getImmediate({optional:!0}),this.auth_||s.onInit(r=>this.auth_=r)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(n=>n&&n.code==="auth/token-not-initialized"?(me("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(n)):new Promise((n,s)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(n,s):n(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(n=>n.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(n=>n.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',we(e)}},js=(()=>{class t{constructor(n){this.accessToken=n}getToken(n){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(n){n(this.accessToken)}removeTokenChangeListener(n){}notifyForInvalidToken(){}}t.OWNER="owner";return t})(),xi="5",Ip="v",Sp="s",Ap="r",bp="f",Cp=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,Rp="ls",Pp="p",Vl="ac",Np="websocket",Dp="long_polling";var Oi=class{constructor(e,n,s,r,i=!1,o="",a=!1,l=!1){this.secure=n,this.namespace=s,this.webSocketOnly=r,this.nodeAdmin=i,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=l,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=Yt.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&Yt.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){let e=this.secure?"https://":"http://",n=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${n}`}};function pE(t){return t.host!==t.internalHost||t.isCustomHost()||t.includeNamespaceInQueryParams}function kp(t,e,n){g(typeof e=="string","typeof type must == string"),g(typeof n=="object","typeof params must == object");let s;if(e===Np)s=(t.secure?"wss://":"ws://")+t.internalHost+"/.ws?";else if(e===Dp)s=(t.secure?"https://":"http://")+t.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);pE(t)&&(n.ns=t.namespace);let r=[];return Te(n,(i,o)=>{r.push(i+"="+o)}),s+r.join("&")}var Ll=class{constructor(){this.counters_={}}incrementCounter(e,n=1){We(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=n}get(){return Xu(this.counters_)}};var Sl={},Al={};function Rc(t){let e=t.toString();return Sl[e]||(Sl[e]=new Ll),Sl[e]}function mE(t,e){let n=t.toString();return Al[n]||(Al[n]=e()),Al[n]}var Ul=class{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,n){this.closeAfterResponse=e,this.onClose=n,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,n){for(this.pendingResponses[e]=n;this.pendingResponses[this.currentResponseNum];){let s=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let r=0;r<s.length;++r)s[r]&&Xn(()=>{this.onMessage_(s[r])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}};var jf="start",gE="close",_E="pLPCommand",yE="pRTLPCB",xp="id",Op="pw",Mp="ser",vE="cb",EE="seg",wE="ts",TE="d",IE="dframe",Fp=1870,Vp=30,SE=Fp-Vp,AE=25e3,bE=3e4,Bl=class t{constructor(e,n,s,r,i,o,a){this.connId=e,this.repoInfo=n,this.applicationId=s,this.appCheckToken=r,this.authToken=i,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=nr(e),this.stats_=Rc(n),this.urlFn=l=>(this.appCheckToken&&(l[Vl]=this.appCheckToken),kp(n,Dp,l))}open(e,n){this.curSegmentNum=0,this.onDisconnect_=n,this.myPacketOrderer=new Ul(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(bE)),iE(()=>{if(this.isClosed_)return;this.scriptTagHolder=new ql((...i)=>{let[o,a,l,c,u]=i;if(this.incrementIncomingBytes_(i),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===jf)this.id=a,this.password=l;else if(o===gE)a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...i)=>{let[o,a]=i;this.incrementIncomingBytes_(i),this.myPacketOrderer.handleResponse(o,a)},()=>{this.onClosed_()},this.urlFn);let s={};s[jf]="t",s[Mp]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(s[vE]=this.scriptTagHolder.uniqueCallbackIdentifier),s[Ip]=xi,this.transportSessionId&&(s[Sp]=this.transportSessionId),this.lastSessionId&&(s[Rp]=this.lastSessionId),this.applicationId&&(s[Pp]=this.applicationId),this.appCheckToken&&(s[Vl]=this.appCheckToken),typeof location<"u"&&location.hostname&&Cp.test(location.hostname)&&(s[Ap]=bp);let r=this.urlFn(s);this.log_("Connecting via long-poll to "+r),this.scriptTagHolder.addTag(r,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){t.forceAllow_=!0}static forceDisallow(){t.forceDisallow_=!0}static isAvailable(){return Ke()?!1:t.forceAllow_?!0:!t.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!aE()&&!lE()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){let n=X(e);this.bytesSent+=n.length,this.stats_.incrementCounter("bytes_sent",n.length);let s=Yu(n),r=wp(s,SE);for(let i=0;i<r.length;i++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,r.length,r[i]),this.curSegmentNum++}addDisconnectPingFrame(e,n){if(Ke())return;this.myDisconnFrame=document.createElement("iframe");let s={};s[IE]="t",s[xp]=e,s[Op]=n,this.myDisconnFrame.src=this.urlFn(s),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){let n=X(e).length;this.bytesReceived+=n,this.stats_.incrementCounter("bytes_received",n)}},ql=class t{constructor(e,n,s,r){if(this.onDisconnect=s,this.urlFn=r,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0,Ke())this.commandCB=e,this.onMessageCB=n;else{this.uniqueCallbackIdentifier=nE(),window[_E+this.uniqueCallbackIdentifier]=e,window[yE+this.uniqueCallbackIdentifier]=n,this.myIFrame=t.createIFrame_();let i="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(i='<script>document.domain="'+document.domain+'";<\/script>');let o="<html><body>"+i+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(a){me("frame writing exception"),a.stack&&me(a.stack),me(a)}}}static createIFrame_(){let e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||me("No IE domain setting required")}catch{let s=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+s+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));let e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,n){for(this.myID=e,this.myPW=n,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;let e={};e[xp]=this.myID,e[Op]=this.myPW,e[Mp]=this.currentSerial;let n=this.urlFn(e),s="",r=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+Vp+s.length<=Fp;){let o=this.pendingSegs.shift();s=s+"&"+EE+r+"="+o.seg+"&"+wE+r+"="+o.ts+"&"+TE+r+"="+o.d,r++}return n=n+s,this.addLongPollTag_(n,this.currentSerial),!0}else return!1}enqueueSegment(e,n,s){this.pendingSegs.push({seg:e,ts:n,d:s}),this.alive&&this.newRequest_()}addLongPollTag_(e,n){this.outstandingRequests.add(n);let s=()=>{this.outstandingRequests.delete(n),this.newRequest_()},r=setTimeout(s,Math.floor(AE)),i=()=>{clearTimeout(r),s()};this.addTag(e,i)}addTag(e,n){Ke()?this.doNodeLongPoll(e,n):setTimeout(()=>{try{if(!this.sendNewPolls)return;let s=this.myIFrame.doc.createElement("script");s.type="text/javascript",s.async=!0,s.src=e,s.onload=s.onreadystatechange=function(){let r=s.readyState;(!r||r==="loaded"||r==="complete")&&(s.onload=s.onreadystatechange=null,s.parentNode&&s.parentNode.removeChild(s),n())},s.onerror=()=>{me("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(s)}catch{}},Math.floor(1))}};var CE=16384,RE=45e3,Mi=null;typeof MozWebSocket<"u"?Mi=MozWebSocket:typeof WebSocket<"u"&&(Mi=WebSocket);var Us=(()=>{class t{constructor(n,s,r,i,o,a,l){this.connId=n,this.applicationId=r,this.appCheckToken=i,this.authToken=o,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=nr(this.connId),this.stats_=Rc(s),this.connURL=t.connectionURL_(s,a,l,i,r),this.nodeAdmin=s.nodeAdmin}static connectionURL_(n,s,r,i,o){let a={};return a[Ip]=xi,!Ke()&&typeof location<"u"&&location.hostname&&Cp.test(location.hostname)&&(a[Ap]=bp),s&&(a[Sp]=s),r&&(a[Rp]=r),i&&(a[Vl]=i),o&&(a[Pp]=o),kp(n,Np,a)}open(n,s){this.onDisconnect=s,this.onMessage=n,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Yt.set("previous_websocket_failure",!0);try{let r;if(Ke()){let i=this.nodeAdmin?"AdminNode":"Node";r={headers:{"User-Agent":`Firebase/${xi}/${bc}/${process.platform}/${i}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(r.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(r.headers["X-Firebase-AppCheck"]=this.appCheckToken);let o=process.env,a=this.connURL.indexOf("wss://")===0?o.HTTPS_PROXY||o.https_proxy:o.HTTP_PROXY||o.http_proxy;a&&(r.proxy={origin:a})}this.mySock=new Mi(this.connURL,[],r)}catch(r){this.log_("Error instantiating WebSocket.");let i=r.message||r.data;i&&this.log_(i),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=r=>{this.handleIncomingFrame(r)},this.mySock.onerror=r=>{this.log_("WebSocket error.  Closing connection.");let i=r.message||r.data;i&&this.log_(i),this.onClosed_()}}start(){}static forceDisallow(){t.forceDisallow_=!0}static isAvailable(){let n=!1;if(typeof navigator<"u"&&navigator.userAgent){let s=/Android ([0-9]{0,}\.[0-9]{0,})/,r=navigator.userAgent.match(s);r&&r.length>1&&parseFloat(r[1])<4.4&&(n=!0)}return!n&&Mi!==null&&!t.forceDisallow_}static previouslyFailed(){return Yt.isInMemoryStorage||Yt.get("previous_websocket_failure")===!0}markConnectionHealthy(){Yt.remove("previous_websocket_failure")}appendFrame_(n){if(this.frames.push(n),this.frames.length===this.totalFrames){let s=this.frames.join("");this.frames=null;let r=wr(s);this.onMessage(r)}}handleNewFrameCount_(n){this.totalFrames=n,this.frames=[]}extractFrameCount_(n){if(g(this.frames===null,"We already have a frame buffer"),n.length<=6){let s=Number(n);if(!isNaN(s))return this.handleNewFrameCount_(s),null}return this.handleNewFrameCount_(1),n}handleIncomingFrame(n){if(this.mySock===null)return;let s=n.data;if(this.bytesReceived+=s.length,this.stats_.incrementCounter("bytes_received",s.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(s);else{let r=this.extractFrameCount_(s);r!==null&&this.appendFrame_(r)}}send(n){this.resetKeepAlive();let s=X(n);this.bytesSent+=s.length,this.stats_.incrementCounter("bytes_sent",s.length);let r=wp(s,CE);r.length>1&&this.sendString_(String(r.length));for(let i=0;i<r.length;i++)this.sendString_(r[i])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(RE))}sendString_(n){try{this.mySock.send(n)}catch(s){this.log_("Exception thrown from WebSocket.send():",s.message||s.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}t.responsesRequiredToBeHealthy=2,t.healthyTimeout=3e4;return t})(),PE=(()=>{class t{constructor(n){this.initTransports_(n)}static get ALL_TRANSPORTS(){return[Bl,Us]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(n){let s=Us&&Us.isAvailable(),r=s&&!Us.previouslyFailed();if(n.webSocketOnly&&(s||we("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),r=!0),r)this.transports_=[Us];else{let i=this.transports_=[];for(let o of t.ALL_TRANSPORTS)o&&o.isAvailable()&&i.push(o);t.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}t.globalTransportInitialized_=!1;return t})(),NE=6e4,DE=5e3,kE=10*1024,xE=100*1024,bl="t",Gf="d",OE="s",Kf="r",ME="e",Wf="o",Qf="a",Hf="n",Yf="p",FE="h",$l=class{constructor(e,n,s,r,i,o,a,l,c,u){this.id=e,this.repoInfo_=n,this.applicationId_=s,this.appCheckToken_=r,this.authToken_=i,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=l,this.onKill_=c,this.lastSessionId=u,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=nr("c:"+this.id+":"),this.transportManager_=new PE(n),this.log_("Connection created"),this.start_()}start_(){let e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let n=this.connReceiver_(this.conn_),s=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(n,s)},Math.floor(0));let r=e.healthyTimeout||0;r>0&&(this.healthyTimeout_=zs(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>xE?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>kE?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(r)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return n=>{e===this.conn_?this.onConnectionLost_(n):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return n=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(n):e===this.secondaryConn_?this.onSecondaryMessageReceived_(n):this.log_("message on old connection"))}}sendRequest(e){let n={t:"d",d:e};this.sendData_(n)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(bl in e){let n=e[bl];n===Qf?this.upgradeIfSecondaryHealthy_():n===Kf?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):n===Wf&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){let n=Ls("t",e),s=Ls("d",e);if(n==="c")this.onSecondaryControl_(s);else if(n==="d")this.pendingDataMessages.push(s);else throw new Error("Unknown protocol layer: "+n)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:Yf,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:Qf,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:Hf,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){let n=Ls("t",e),s=Ls("d",e);n==="c"?this.onControl_(s):n==="d"&&this.onDataMessage_(s)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){let n=Ls(bl,e);if(Gf in e){let s=e[Gf];if(n===FE){let r=Object.assign({},s);this.repoInfo_.isUsingEmulator&&(r.h=this.repoInfo_.host),this.onHandshake_(r)}else if(n===Hf){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let r=0;r<this.pendingDataMessages.length;++r)this.onDataMessage_(this.pendingDataMessages[r]);this.pendingDataMessages=[],this.tryCleanupConnection()}else n===OE?this.onConnectionShutdown_(s):n===Kf?this.onReset_(s):n===ME?Ol("Server Error: "+s):n===Wf?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):Ol("Unknown control packet command: "+n)}}onHandshake_(e){let n=e.ts,s=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.host=r,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,n),xi!==s&&we("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){let e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let n=this.connReceiver_(this.secondaryConn_),s=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(n,s),zs(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(NE))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,n){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(n,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):zs(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(DE))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:Yf,d:{}}}))}onSecondaryConnectionLost_(){let e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Yt.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}};var Fi=class{put(e,n,s,r){}merge(e,n,s,r){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,n,s){}onDisconnectMerge(e,n,s){}onDisconnectCancel(e,n){}reportStats(e){}};var Vi=class{constructor(e){this.allowedEvents_=e,this.listeners_={},g(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...n){if(Array.isArray(this.listeners_[e])){let s=[...this.listeners_[e]];for(let r=0;r<s.length;r++)s[r].callback.apply(s[r].context,n)}}on(e,n,s){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:n,context:s});let r=this.getInitialEvent(e);r&&n.apply(s,r)}off(e,n,s){this.validateEventType_(e);let r=this.listeners_[e]||[];for(let i=0;i<r.length;i++)if(r[i].callback===n&&(!s||s===r[i].context)){r.splice(i,1);return}}validateEventType_(e){g(this.allowedEvents_.find(n=>n===e),"Unknown event: "+e)}};var Li=class t extends Vi{constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!wo()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new t}getInitialEvent(e){return g(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}};var Xf=32,Jf=768,B=class{constructor(e,n){if(n===void 0){this.pieces_=e.split("/");let s=0;for(let r=0;r<this.pieces_.length;r++)this.pieces_[r].length>0&&(this.pieces_[s]=this.pieces_[r],s++);this.pieces_.length=s,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=n}toString(){let e="";for(let n=this.pieceNum_;n<this.pieces_.length;n++)this.pieces_[n]!==""&&(e+="/"+this.pieces_[n]);return e||"/"}};function V(){return new B("")}function D(t){return t.pieceNum_>=t.pieces_.length?null:t.pieces_[t.pieceNum_]}function kt(t){return t.pieces_.length-t.pieceNum_}function z(t){let e=t.pieceNum_;return e<t.pieces_.length&&e++,new B(t.pieces_,e)}function Lp(t){return t.pieceNum_<t.pieces_.length?t.pieces_[t.pieces_.length-1]:null}function VE(t){let e="";for(let n=t.pieceNum_;n<t.pieces_.length;n++)t.pieces_[n]!==""&&(e+="/"+encodeURIComponent(String(t.pieces_[n])));return e||"/"}function Up(t,e=0){return t.pieces_.slice(t.pieceNum_+e)}function Bp(t){if(t.pieceNum_>=t.pieces_.length)return null;let e=[];for(let n=t.pieceNum_;n<t.pieces_.length-1;n++)e.push(t.pieces_[n]);return new B(e,0)}function te(t,e){let n=[];for(let s=t.pieceNum_;s<t.pieces_.length;s++)n.push(t.pieces_[s]);if(e instanceof B)for(let s=e.pieceNum_;s<e.pieces_.length;s++)n.push(e.pieces_[s]);else{let s=e.split("/");for(let r=0;r<s.length;r++)s[r].length>0&&n.push(s[r])}return new B(n,0)}function P(t){return t.pieceNum_>=t.pieces_.length}function ve(t,e){let n=D(t),s=D(e);if(n===null)return e;if(n===s)return ve(z(t),z(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+t+")")}function qp(t,e){if(kt(t)!==kt(e))return!1;for(let n=t.pieceNum_,s=e.pieceNum_;n<=t.pieces_.length;n++,s++)if(t.pieces_[n]!==e.pieces_[s])return!1;return!0}function qe(t,e){let n=t.pieceNum_,s=e.pieceNum_;if(kt(t)>kt(e))return!1;for(;n<t.pieces_.length;){if(t.pieces_[n]!==e.pieces_[s])return!1;++n,++s}return!0}var zl=class{constructor(e,n){this.errorPrefix_=n,this.parts_=Up(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let s=0;s<this.parts_.length;s++)this.byteLength_+=is(this.parts_[s]);$p(this)}};function LE(t,e){t.parts_.length>0&&(t.byteLength_+=1),t.parts_.push(e),t.byteLength_+=is(e),$p(t)}function UE(t){let e=t.parts_.pop();t.byteLength_-=is(e),t.parts_.length>0&&(t.byteLength_-=1)}function $p(t){if(t.byteLength_>Jf)throw new Error(t.errorPrefix_+"has a key path longer than "+Jf+" bytes ("+t.byteLength_+").");if(t.parts_.length>Xf)throw new Error(t.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+Xf+") or object contains a cycle "+Ht(t))}function Ht(t){return t.parts_.length===0?"":"in property '"+t.parts_.join(".")+"'"}var jl=class t extends Vi{constructor(){super(["visible"]);let e,n;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(n="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(n="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(n="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(n="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,n&&document.addEventListener(n,()=>{let s=!document[e];s!==this.visible_&&(this.visible_=s,this.trigger("visible",s))},!1)}static getInstance(){return new t}getInitialEvent(e){return g(e==="visible","Unknown event type: "+e),[this.visible_]}};var Bs=1e3,BE=60*5*1e3,Zf=30*1e3,qE=1.3,$E=3e4,zE="server_kill",ep=3,Pc=(()=>{class t extends Fi{constructor(n,s,r,i,o,a,l,c){if(super(),this.repoInfo_=n,this.applicationId_=s,this.onDataUpdate_=r,this.onConnectStatus_=i,this.onServerInfoUpdate_=o,this.authTokenProvider_=a,this.appCheckTokenProvider_=l,this.authOverride_=c,this.id=t.nextPersistentConnectionId_++,this.log_=nr("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=Bs,this.maxReconnectDelay_=BE,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,c&&!Ke())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");jl.getInstance().on("visible",this.onVisible_,this),n.host.indexOf("fblocal")===-1&&Li.getInstance().on("online",this.onOnline_,this)}sendRequest(n,s,r){let i=++this.requestNumber_,o={r:i,a:n,b:s};this.log_(X(o)),g(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(o),r&&(this.requestCBHash_[i]=r)}get(n){this.initConnection_();let s=new vr,i={action:"g",request:{p:n._path.toString(),q:n._queryObject},onComplete:a=>{let l=a.d;a.s==="ok"?s.resolve(l):s.reject(l)}};this.outstandingGets_.push(i),this.outstandingGetCount_++;let o=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(o),s.promise}listen(n,s,r,i){this.initConnection_();let o=n._queryIdentifier,a=n._path.toString();this.log_("Listen called for "+a+" "+o),this.listens.has(a)||this.listens.set(a,new Map),g(n._queryParams.isDefault()||!n._queryParams.loadsAllData(),"listen() called for non-default but complete query"),g(!this.listens.get(a).has(o),"listen() called twice for same path/queryId.");let l={onComplete:i,hashFn:s,query:n,tag:r};this.listens.get(a).set(o,l),this.connected_&&this.sendListen_(l)}sendGet_(n){let s=this.outstandingGets_[n];this.sendRequest("g",s.request,r=>{delete this.outstandingGets_[n],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),s.onComplete&&s.onComplete(r)})}sendListen_(n){let s=n.query,r=s._path.toString(),i=s._queryIdentifier;this.log_("Listen on "+r+" for "+i);let o={p:r},a="q";n.tag&&(o.q=s._queryObject,o.t=n.tag),o.h=n.hashFn(),this.sendRequest(a,o,l=>{let c=l.d,u=l.s;t.warnOnListenWarnings_(c,s),(this.listens.get(r)&&this.listens.get(r).get(i))===n&&(this.log_("listen response",l),u!=="ok"&&this.removeListen_(r,i),n.onComplete&&n.onComplete(u,c))})}static warnOnListenWarnings_(n,s){if(n&&typeof n=="object"&&We(n,"w")){let r=Lt(n,"w");if(Array.isArray(r)&&~r.indexOf("no_index")){let i='".indexOn": "'+s._queryParams.getIndex().toString()+'"',o=s._path.toString();we(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${i} at ${o} to your security rules for better performance.`)}}}refreshAuthToken(n){this.authToken_=n,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(n)}reduceReconnectDelayIfAdminCredential_(n){(n&&n.length===40||eh(n))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=Zf)}refreshAppCheckToken(n){this.appCheckToken_=n,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){let n=this.authToken_,s=Zu(n)?"auth":"gauth",r={cred:n};this.authOverride_===null?r.noauth=!0:typeof this.authOverride_=="object"&&(r.authvar=this.authOverride_),this.sendRequest(s,r,i=>{let o=i.s,a=i.d||"error";this.authToken_===n&&(o==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(o,a))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},n=>{let s=n.s,r=n.d||"error";s==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(s,r)})}unlisten(n,s){let r=n._path.toString(),i=n._queryIdentifier;this.log_("Unlisten called for "+r+" "+i),g(n._queryParams.isDefault()||!n._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(r,i)&&this.connected_&&this.sendUnlisten_(r,i,n._queryObject,s)}sendUnlisten_(n,s,r,i){this.log_("Unlisten on "+n+" for "+s);let o={p:n},a="n";i&&(o.q=r,o.t=i),this.sendRequest(a,o)}onDisconnectPut(n,s,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",n,s,r):this.onDisconnectRequestQueue_.push({pathString:n,action:"o",data:s,onComplete:r})}onDisconnectMerge(n,s,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",n,s,r):this.onDisconnectRequestQueue_.push({pathString:n,action:"om",data:s,onComplete:r})}onDisconnectCancel(n,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",n,null,s):this.onDisconnectRequestQueue_.push({pathString:n,action:"oc",data:null,onComplete:s})}sendOnDisconnect_(n,s,r,i){let o={p:s,d:r};this.log_("onDisconnect "+n,o),this.sendRequest(n,o,a=>{i&&setTimeout(()=>{i(a.s,a.d)},Math.floor(0))})}put(n,s,r,i){this.putInternal("p",n,s,r,i)}merge(n,s,r,i){this.putInternal("m",n,s,r,i)}putInternal(n,s,r,i,o){this.initConnection_();let a={p:s,d:r};o!==void 0&&(a.h=o),this.outstandingPuts_.push({action:n,request:a,onComplete:i}),this.outstandingPutCount_++;let l=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(l):this.log_("Buffering put: "+s)}sendPut_(n){let s=this.outstandingPuts_[n].action,r=this.outstandingPuts_[n].request,i=this.outstandingPuts_[n].onComplete;this.outstandingPuts_[n].queued=this.connected_,this.sendRequest(s,r,o=>{this.log_(s+" response",o),delete this.outstandingPuts_[n],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),i&&i(o.s,o.d)})}reportStats(n){if(this.connected_){let s={c:n};this.log_("reportStats",s),this.sendRequest("s",s,r=>{if(r.s!=="ok"){let o=r.d;this.log_("reportStats","Error sending stats: "+o)}})}}onDataMessage_(n){if("r"in n){this.log_("from server: "+X(n));let s=n.r,r=this.requestCBHash_[s];r&&(delete this.requestCBHash_[s],r(n.b))}else{if("error"in n)throw"A server-side error has occurred: "+n.error;"a"in n&&this.onDataPush_(n.a,n.b)}}onDataPush_(n,s){this.log_("handleServerMessage",n,s),n==="d"?this.onDataUpdate_(s.p,s.d,!1,s.t):n==="m"?this.onDataUpdate_(s.p,s.d,!0,s.t):n==="c"?this.onListenRevoked_(s.p,s.q):n==="ac"?this.onAuthRevoked_(s.s,s.d):n==="apc"?this.onAppCheckRevoked_(s.s,s.d):n==="sd"?this.onSecurityDebugPacket_(s):Ol("Unrecognized action received from server: "+X(n)+`
Are you using the latest client?`)}onReady_(n,s){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(n),this.lastSessionId=s,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(n){g(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(n))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(n){n&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Bs,this.realtime_||this.scheduleConnect_(0)),this.visible_=n}onOnline_(n){n?(this.log_("Browser went online."),this.reconnectDelay_=Bs,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>$E&&(this.reconnectDelay_=Bs),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());let n=new Date().getTime()-this.lastConnectionAttemptTime_,s=Math.max(0,this.reconnectDelay_-n);s=Math.random()*s,this.log_("Trying to reconnect in "+s+"ms"),this.scheduleConnect_(s),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*qE)}this.onConnectStatus_(!1)}establishConnection_(){return ae(this,null,function*(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;let n=this.onDataMessage_.bind(this),s=this.onReady_.bind(this),r=this.onRealtimeDisconnect_.bind(this),i=this.id+":"+t.nextConnectionId_++,o=this.lastSessionId,a=!1,l=null,c=function(){l?l.close():(a=!0,r())},u=function(d){g(l,"sendRequest call when we're not connected not allowed."),l.sendRequest(d)};this.realtime_={close:c,sendRequest:u};let h=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{let[d,p]=yield Promise.all([this.authTokenProvider_.getToken(h),this.appCheckTokenProvider_.getToken(h)]);a?me("getToken() completed but was canceled"):(me("getToken() completed. Creating connection."),this.authToken_=d&&d.accessToken,this.appCheckToken_=p&&p.token,l=new $l(i,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,n,s,r,f=>{we(f+" ("+this.repoInfo_.toString()+")"),this.interrupt(zE)},o))}catch(d){this.log_("Failed to get token: "+d),a||(this.repoInfo_.nodeAdmin&&we(d),c())}}})}interrupt(n){me("Interrupting connection for reason: "+n),this.interruptReasons_[n]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(n){me("Resuming connection for reason: "+n),delete this.interruptReasons_[n],To(this.interruptReasons_)&&(this.reconnectDelay_=Bs,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(n){let s=n-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:s})}cancelSentTransactions_(){for(let n=0;n<this.outstandingPuts_.length;n++){let s=this.outstandingPuts_[n];s&&"h"in s.request&&s.queued&&(s.onComplete&&s.onComplete("disconnect"),delete this.outstandingPuts_[n],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(n,s){let r;s?r=s.map(o=>Cc(o)).join("$"):r="default";let i=this.removeListen_(n,r);i&&i.onComplete&&i.onComplete("permission_denied")}removeListen_(n,s){let r=new B(n).toString(),i;if(this.listens.has(r)){let o=this.listens.get(r);i=o.get(s),o.delete(s),o.size===0&&this.listens.delete(r)}else i=void 0;return i}onAuthRevoked_(n,s){me("Auth token revoked: "+n+"/"+s),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(n==="invalid_token"||n==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=ep&&(this.reconnectDelay_=Zf,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(n,s){me("App check token revoked: "+n+"/"+s),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(n==="invalid_token"||n==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=ep&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(n){this.securityDebugCallback_?this.securityDebugCallback_(n):"msg"in n&&console.log("FIREBASE: "+n.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(let n of this.listens.values())for(let s of n.values())this.sendListen_(s);for(let n=0;n<this.outstandingPuts_.length;n++)this.outstandingPuts_[n]&&this.sendPut_(n);for(;this.onDisconnectRequestQueue_.length;){let n=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(n.action,n.pathString,n.data,n.onComplete)}for(let n=0;n<this.outstandingGets_.length;n++)this.outstandingGets_[n]&&this.sendGet_(n)}sendConnectStats_(){let n={},s="js";Ke()&&(this.repoInfo_.nodeAdmin?s="admin_node":s="node"),n["sdk."+s+"."+bc.replace(/\./g,"-")]=1,wo()?n["framework.cordova"]=1:Ju()&&(n["framework.reactnative"]=1),this.reportStats(n)}shouldReconnect_(){let n=Li.getInstance().currentlyOnline();return To(this.interruptReasons_)&&n}}t.nextPersistentConnectionId_=0,t.nextConnectionId_=0;return t})(),R=class t{constructor(e,n){this.name=e,this.node=n}static Wrap(e,n){return new t(e,n)}};var jn=class{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,n){let s=new R(zn,e),r=new R(zn,n);return this.compare(s,r)!==0}minPost(){return R.MIN}};var ki,Ui=class extends jn{static get __EMPTY_NODE(){return ki}static set __EMPTY_NODE(e){ki=e}compare(e,n){return Yn(e.name,n.name)}isDefinedOn(e){throw an("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,n){return!1}minPost(){return R.MIN}maxPost(){return new R(Zt,ki)}makePost(e,n){return g(typeof e=="string","KeyIndex indexValue must always be a string."),new R(e,ki)}toString(){return".key"}},$n=new Ui;var Bn=class{constructor(e,n,s,r,i=null){this.isReverse_=r,this.resultGenerator_=i,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=n?s(e.key,n):1,r&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),n;if(this.resultGenerator_?n=this.resultGenerator_(e.key,e.value):n={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return n}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}},Be=(()=>{class t{constructor(n,s,r,i,o){this.key=n,this.value=s,this.color=r??t.RED,this.left=i??Oe.EMPTY_NODE,this.right=o??Oe.EMPTY_NODE}copy(n,s,r,i,o){return new t(n??this.key,s??this.value,r??this.color,i??this.left,o??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(n){return this.left.inorderTraversal(n)||!!n(this.key,this.value)||this.right.inorderTraversal(n)}reverseTraversal(n){return this.right.reverseTraversal(n)||n(this.key,this.value)||this.left.reverseTraversal(n)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(n,s,r){let i=this,o=r(n,i.key);return o<0?i=i.copy(null,null,null,i.left.insert(n,s,r),null):o===0?i=i.copy(null,s,null,null,null):i=i.copy(null,null,null,null,i.right.insert(n,s,r)),i.fixUp_()}removeMin_(){if(this.left.isEmpty())return Oe.EMPTY_NODE;let n=this;return!n.left.isRed_()&&!n.left.left.isRed_()&&(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.removeMin_(),null),n.fixUp_()}remove(n,s){let r,i;if(r=this,s(n,r.key)<0)!r.left.isEmpty()&&!r.left.isRed_()&&!r.left.left.isRed_()&&(r=r.moveRedLeft_()),r=r.copy(null,null,null,r.left.remove(n,s),null);else{if(r.left.isRed_()&&(r=r.rotateRight_()),!r.right.isEmpty()&&!r.right.isRed_()&&!r.right.left.isRed_()&&(r=r.moveRedRight_()),s(n,r.key)===0){if(r.right.isEmpty())return Oe.EMPTY_NODE;i=r.right.min_(),r=r.copy(i.key,i.value,null,null,r.right.removeMin_())}r=r.copy(null,null,null,null,r.right.remove(n,s))}return r.fixUp_()}isRed_(){return this.color}fixUp_(){let n=this;return n.right.isRed_()&&!n.left.isRed_()&&(n=n.rotateLeft_()),n.left.isRed_()&&n.left.left.isRed_()&&(n=n.rotateRight_()),n.left.isRed_()&&n.right.isRed_()&&(n=n.colorFlip_()),n}moveRedLeft_(){let n=this.colorFlip_();return n.right.left.isRed_()&&(n=n.copy(null,null,null,null,n.right.rotateRight_()),n=n.rotateLeft_(),n=n.colorFlip_()),n}moveRedRight_(){let n=this.colorFlip_();return n.left.left.isRed_()&&(n=n.rotateRight_(),n=n.colorFlip_()),n}rotateLeft_(){let n=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,n,null)}rotateRight_(){let n=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,n)}colorFlip_(){let n=this.left.copy(null,null,!this.left.color,null,null),s=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,n,s)}checkMaxDepth_(){let n=this.check_();return Math.pow(2,n)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");let n=this.left.check_();if(n!==this.right.check_())throw new Error("Black depths differ");return n+(this.isRed_()?0:1)}}return t.RED=!0,t.BLACK=!1,t})(),Gl=class{copy(e,n,s,r,i){return this}insert(e,n,s){return new Be(e,n,null)}remove(e,n){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}},Oe=class t{constructor(e,n=t.EMPTY_NODE){this.comparator_=e,this.root_=n}insert(e,n){return new t(this.comparator_,this.root_.insert(e,n,this.comparator_).copy(null,null,Be.BLACK,null,null))}remove(e){return new t(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,Be.BLACK,null,null))}get(e){let n,s=this.root_;for(;!s.isEmpty();){if(n=this.comparator_(e,s.key),n===0)return s.value;n<0?s=s.left:n>0&&(s=s.right)}return null}getPredecessorKey(e){let n,s=this.root_,r=null;for(;!s.isEmpty();)if(n=this.comparator_(e,s.key),n===0){if(s.left.isEmpty())return r?r.key:null;for(s=s.left;!s.right.isEmpty();)s=s.right;return s.key}else n<0?s=s.left:n>0&&(r=s,s=s.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new Bn(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,n){return new Bn(this.root_,e,this.comparator_,!1,n)}getReverseIteratorFrom(e,n){return new Bn(this.root_,e,this.comparator_,!0,n)}getReverseIterator(e){return new Bn(this.root_,null,this.comparator_,!0,e)}};Oe.EMPTY_NODE=new Gl;function jE(t,e){return Yn(t.name,e.name)}function Nc(t,e){return Yn(t,e)}var Kl;function GE(t){Kl=t}var zp=function(t){return typeof t=="number"?"number:"+Tp(t):"string:"+t},jp=function(t){if(t.isLeafNode()){let e=t.val();g(typeof e=="string"||typeof e=="number"||typeof e=="object"&&We(e,".sv"),"Priority must be a string or number.")}else g(t===Kl||t.isEmpty(),"priority of unexpected type.");g(t===Kl||t.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};var tp,Gn=(()=>{class t{constructor(n,s=t.__childrenNodeConstructor.EMPTY_NODE){this.value_=n,this.priorityNode_=s,this.lazyHash_=null,g(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),jp(this.priorityNode_)}static set __childrenNodeConstructor(n){tp=n}static get __childrenNodeConstructor(){return tp}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(n){return new t(this.value_,n)}getImmediateChild(n){return n===".priority"?this.priorityNode_:t.__childrenNodeConstructor.EMPTY_NODE}getChild(n){return P(n)?this:D(n)===".priority"?this.priorityNode_:t.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(n,s){return null}updateImmediateChild(n,s){return n===".priority"?this.updatePriority(s):s.isEmpty()&&n!==".priority"?this:t.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(n,s).updatePriority(this.priorityNode_)}updateChild(n,s){let r=D(n);return r===null?s:s.isEmpty()&&r!==".priority"?this:(g(r!==".priority"||kt(n)===1,".priority must be the last token in a path"),this.updateImmediateChild(r,t.__childrenNodeConstructor.EMPTY_NODE.updateChild(z(n),s)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(n,s){return!1}val(n){return n&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let n="";this.priorityNode_.isEmpty()||(n+="priority:"+zp(this.priorityNode_.val())+":");let s=typeof this.value_;n+=s+":",s==="number"?n+=Tp(this.value_):n+=this.value_,this.lazyHash_=vp(n)}return this.lazyHash_}getValue(){return this.value_}compareTo(n){return n===t.__childrenNodeConstructor.EMPTY_NODE?1:n instanceof t.__childrenNodeConstructor?-1:(g(n.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(n))}compareToLeafNode_(n){let s=typeof n.value_,r=typeof this.value_,i=t.VALUE_TYPE_ORDER.indexOf(s),o=t.VALUE_TYPE_ORDER.indexOf(r);return g(i>=0,"Unknown leaf type: "+s),g(o>=0,"Unknown leaf type: "+r),i===o?r==="object"?0:this.value_<n.value_?-1:this.value_===n.value_?0:1:o-i}withIndex(){return this}isIndexed(){return!0}equals(n){if(n===this)return!0;if(n.isLeafNode()){let s=n;return this.value_===s.value_&&this.priorityNode_.equals(s.priorityNode_)}else return!1}}t.VALUE_TYPE_ORDER=["object","boolean","number","string"];return t})(),Gp,Kp;function KE(t){Gp=t}function WE(t){Kp=t}var Wl=class extends jn{compare(e,n){let s=e.node.getPriority(),r=n.node.getPriority(),i=s.compareTo(r);return i===0?Yn(e.name,n.name):i}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,n){return!e.getPriority().equals(n.getPriority())}minPost(){return R.MIN}maxPost(){return new R(Zt,new Gn("[PRIORITY-POST]",Kp))}makePost(e,n){let s=Gp(e);return new R(n,new Gn("[PRIORITY-POST]",s))}toString(){return".priority"}},Y=new Wl;var QE=Math.log(2),Ql=class{constructor(e){let n=i=>parseInt(Math.log(i)/QE,10),s=i=>parseInt(Array(i+1).join("1"),2);this.count=n(e+1),this.current_=this.count-1;let r=s(this.count);this.bits_=e+1&r}nextBitIsOne(){let e=!(this.bits_&1<<this.current_);return this.current_--,e}},Bi=function(t,e,n,s){t.sort(e);let r=function(l,c){let u=c-l,h,d;if(u===0)return null;if(u===1)return h=t[l],d=n?n(h):h,new Be(d,h.node,Be.BLACK,null,null);{let p=parseInt(u/2,10)+l,f=r(l,p),m=r(p+1,c);return h=t[p],d=n?n(h):h,new Be(d,h.node,Be.BLACK,f,m)}},i=function(l){let c=null,u=null,h=t.length,d=function(f,m){let y=h-f,I=h;h-=f;let N=r(y+1,I),x=t[y],E=n?n(x):x;p(new Be(E,x.node,m,null,N))},p=function(f){c?(c.left=f,c=f):(u=f,c=f)};for(let f=0;f<l.count;++f){let m=l.nextBitIsOne(),y=Math.pow(2,l.count-(f+1));m?d(y,Be.BLACK):(d(y,Be.BLACK),d(y,Be.RED))}return u},o=new Ql(t.length),a=i(o);return new Oe(s||e,a)};var Cl,Un={},Kn=class t{constructor(e,n){this.indexes_=e,this.indexSet_=n}static get Default(){return g(Un&&Y,"ChildrenNode.ts has not been loaded"),Cl=Cl||new t({".priority":Un},{".priority":Y}),Cl}get(e){let n=Lt(this.indexes_,e);if(!n)throw new Error("No index defined for "+e);return n instanceof Oe?n:null}hasIndex(e){return We(this.indexSet_,e.toString())}addIndex(e,n){g(e!==$n,"KeyIndex always exists and isn't meant to be added to the IndexMap.");let s=[],r=!1,i=n.getIterator(R.Wrap),o=i.getNext();for(;o;)r=r||e.isDefinedOn(o.node),s.push(o),o=i.getNext();let a;r?a=Bi(s,e.getCompare()):a=Un;let l=e.toString(),c=Object.assign({},this.indexSet_);c[l]=e;let u=Object.assign({},this.indexes_);return u[l]=a,new t(u,c)}addToIndexes(e,n){let s=rs(this.indexes_,(r,i)=>{let o=Lt(this.indexSet_,i);if(g(o,"Missing index implementation for "+i),r===Un)if(o.isDefinedOn(e.node)){let a=[],l=n.getIterator(R.Wrap),c=l.getNext();for(;c;)c.name!==e.name&&a.push(c),c=l.getNext();return a.push(e),Bi(a,o.getCompare())}else return Un;else{let a=n.get(e.name),l=r;return a&&(l=l.remove(new R(e.name,a))),l.insert(e,e.node)}});return new t(s,this.indexSet_)}removeFromIndexes(e,n){let s=rs(this.indexes_,r=>{if(r===Un)return r;{let i=n.get(e.name);return i?r.remove(new R(e.name,i)):r}});return new t(s,this.indexSet_)}};var qs,b=(()=>{class t{constructor(n,s,r){this.children_=n,this.priorityNode_=s,this.indexMap_=r,this.lazyHash_=null,this.priorityNode_&&jp(this.priorityNode_),this.children_.isEmpty()&&g(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return qs||(qs=new t(new Oe(Nc),null,Kn.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||qs}updatePriority(n){return this.children_.isEmpty()?this:new t(this.children_,n,this.indexMap_)}getImmediateChild(n){if(n===".priority")return this.getPriority();{let s=this.children_.get(n);return s===null?qs:s}}getChild(n){let s=D(n);return s===null?this:this.getImmediateChild(s).getChild(z(n))}hasChild(n){return this.children_.get(n)!==null}updateImmediateChild(n,s){if(g(s,"We should always be passing snapshot nodes"),n===".priority")return this.updatePriority(s);{let r=new R(n,s),i,o;s.isEmpty()?(i=this.children_.remove(n),o=this.indexMap_.removeFromIndexes(r,this.children_)):(i=this.children_.insert(n,s),o=this.indexMap_.addToIndexes(r,this.children_));let a=i.isEmpty()?qs:this.priorityNode_;return new t(i,a,o)}}updateChild(n,s){let r=D(n);if(r===null)return s;{g(D(n)!==".priority"||kt(n)===1,".priority must be the last token in a path");let i=this.getImmediateChild(r).updateChild(z(n),s);return this.updateImmediateChild(r,i)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(n){if(this.isEmpty())return null;let s={},r=0,i=0,o=!0;if(this.forEachChild(Y,(a,l)=>{s[a]=l.val(n),r++,o&&t.INTEGER_REGEXP_.test(a)?i=Math.max(i,Number(a)):o=!1}),!n&&o&&i<2*r){let a=[];for(let l in s)a[l]=s[l];return a}else return n&&!this.getPriority().isEmpty()&&(s[".priority"]=this.getPriority().val()),s}hash(){if(this.lazyHash_===null){let n="";this.getPriority().isEmpty()||(n+="priority:"+zp(this.getPriority().val())+":"),this.forEachChild(Y,(s,r)=>{let i=r.hash();i!==""&&(n+=":"+s+":"+i)}),this.lazyHash_=n===""?"":vp(n)}return this.lazyHash_}getPredecessorChildName(n,s,r){let i=this.resolveIndex_(r);if(i){let o=i.getPredecessorKey(new R(n,s));return o?o.name:null}else return this.children_.getPredecessorKey(n)}getFirstChildName(n){let s=this.resolveIndex_(n);if(s){let r=s.minKey();return r&&r.name}else return this.children_.minKey()}getFirstChild(n){let s=this.getFirstChildName(n);return s?new R(s,this.children_.get(s)):null}getLastChildName(n){let s=this.resolveIndex_(n);if(s){let r=s.maxKey();return r&&r.name}else return this.children_.maxKey()}getLastChild(n){let s=this.getLastChildName(n);return s?new R(s,this.children_.get(s)):null}forEachChild(n,s){let r=this.resolveIndex_(n);return r?r.inorderTraversal(i=>s(i.name,i.node)):this.children_.inorderTraversal(s)}getIterator(n){return this.getIteratorFrom(n.minPost(),n)}getIteratorFrom(n,s){let r=this.resolveIndex_(s);if(r)return r.getIteratorFrom(n,i=>i);{let i=this.children_.getIteratorFrom(n.name,R.Wrap),o=i.peek();for(;o!=null&&s.compare(o,n)<0;)i.getNext(),o=i.peek();return i}}getReverseIterator(n){return this.getReverseIteratorFrom(n.maxPost(),n)}getReverseIteratorFrom(n,s){let r=this.resolveIndex_(s);if(r)return r.getReverseIteratorFrom(n,i=>i);{let i=this.children_.getReverseIteratorFrom(n.name,R.Wrap),o=i.peek();for(;o!=null&&s.compare(o,n)>0;)i.getNext(),o=i.peek();return i}}compareTo(n){return this.isEmpty()?n.isEmpty()?0:-1:n.isLeafNode()||n.isEmpty()?1:n===sr?-1:0}withIndex(n){if(n===$n||this.indexMap_.hasIndex(n))return this;{let s=this.indexMap_.addIndex(n,this.children_);return new t(this.children_,this.priorityNode_,s)}}isIndexed(n){return n===$n||this.indexMap_.hasIndex(n)}equals(n){if(n===this)return!0;if(n.isLeafNode())return!1;{let s=n;if(this.getPriority().equals(s.getPriority()))if(this.children_.count()===s.children_.count()){let r=this.getIterator(Y),i=s.getIterator(Y),o=r.getNext(),a=i.getNext();for(;o&&a;){if(o.name!==a.name||!o.node.equals(a.node))return!1;o=r.getNext(),a=i.getNext()}return o===null&&a===null}else return!1;else return!1}}resolveIndex_(n){return n===$n?null:this.indexMap_.get(n.toString())}}return t.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,t})(),Hl=class extends b{constructor(){super(new Oe(Nc),b.EMPTY_NODE,Kn.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return b.EMPTY_NODE}isEmpty(){return!1}},sr=new Hl;Object.defineProperties(R,{MIN:{value:new R(zn,b.EMPTY_NODE)},MAX:{value:new R(Zt,sr)}});Ui.__EMPTY_NODE=b.EMPTY_NODE;Gn.__childrenNodeConstructor=b;GE(sr);WE(sr);var HE=!0;function oe(t,e=null){if(t===null)return b.EMPTY_NODE;if(typeof t=="object"&&".priority"in t&&(e=t[".priority"]),g(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof t=="object"&&".value"in t&&t[".value"]!==null&&(t=t[".value"]),typeof t!="object"||".sv"in t){let n=t;return new Gn(n,oe(e))}if(!(t instanceof Array)&&HE){let n=[],s=!1;if(Te(t,(o,a)=>{if(o.substring(0,1)!=="."){let l=oe(a);l.isEmpty()||(s=s||!l.getPriority().isEmpty(),n.push(new R(o,l)))}}),n.length===0)return b.EMPTY_NODE;let i=Bi(n,jE,o=>o.name,Nc);if(s){let o=Bi(n,Y.getCompare());return new b(i,oe(e),new Kn({".priority":o},{".priority":Y}))}else return new b(i,oe(e),Kn.Default)}else{let n=b.EMPTY_NODE;return Te(t,(s,r)=>{if(We(t,s)&&s.substring(0,1)!=="."){let i=oe(r);(i.isLeafNode()||!i.isEmpty())&&(n=n.updateImmediateChild(s,i))}}),n.updatePriority(oe(e))}}KE(oe);var Yl=class extends jn{constructor(e){super(),this.indexPath_=e,g(!P(e)&&D(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,n){let s=this.extractChild(e.node),r=this.extractChild(n.node),i=s.compareTo(r);return i===0?Yn(e.name,n.name):i}makePost(e,n){let s=oe(e),r=b.EMPTY_NODE.updateChild(this.indexPath_,s);return new R(n,r)}maxPost(){let e=b.EMPTY_NODE.updateChild(this.indexPath_,sr);return new R(Zt,e)}toString(){return Up(this.indexPath_,0).join("/")}};var Xl=class extends jn{compare(e,n){let s=e.node.compareTo(n.node);return s===0?Yn(e.name,n.name):s}isDefinedOn(e){return!0}indexedValueChanged(e,n){return!e.equals(n)}minPost(){return R.MIN}maxPost(){return R.MAX}makePost(e,n){let s=oe(e);return new R(n,s)}toString(){return".value"}},YE=new Xl;function Wp(t){return{type:"value",snapshotNode:t}}function Wn(t,e){return{type:"child_added",snapshotNode:e,childName:t}}function Qs(t,e){return{type:"child_removed",snapshotNode:e,childName:t}}function Hs(t,e,n){return{type:"child_changed",snapshotNode:e,childName:t,oldSnap:n}}function XE(t,e){return{type:"child_moved",snapshotNode:e,childName:t}}var Ys=class{constructor(e){this.index_=e}updateChild(e,n,s,r,i,o){g(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");let a=e.getImmediateChild(n);return a.getChild(r).equals(s.getChild(r))&&a.isEmpty()===s.isEmpty()||(o!=null&&(s.isEmpty()?e.hasChild(n)?o.trackChildChange(Qs(n,a)):g(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(Wn(n,s)):o.trackChildChange(Hs(n,s,a))),e.isLeafNode()&&s.isEmpty())?e:e.updateImmediateChild(n,s).withIndex(this.index_)}updateFullNode(e,n,s){return s!=null&&(e.isLeafNode()||e.forEachChild(Y,(r,i)=>{n.hasChild(r)||s.trackChildChange(Qs(r,i))}),n.isLeafNode()||n.forEachChild(Y,(r,i)=>{if(e.hasChild(r)){let o=e.getImmediateChild(r);o.equals(i)||s.trackChildChange(Hs(r,i,o))}else s.trackChildChange(Wn(r,i))})),n.withIndex(this.index_)}updatePriority(e,n){return e.isEmpty()?b.EMPTY_NODE:e.updatePriority(n)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}};var qi=class t{constructor(e){this.indexedFilter_=new Ys(e.getIndex()),this.index_=e.getIndex(),this.startPost_=t.getStartPost_(e),this.endPost_=t.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){let n=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,s=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return n&&s}updateChild(e,n,s,r,i,o){return this.matches(new R(n,s))||(s=b.EMPTY_NODE),this.indexedFilter_.updateChild(e,n,s,r,i,o)}updateFullNode(e,n,s){n.isLeafNode()&&(n=b.EMPTY_NODE);let r=n.withIndex(this.index_);r=r.updatePriority(b.EMPTY_NODE);let i=this;return n.forEachChild(Y,(o,a)=>{i.matches(new R(o,a))||(r=r.updateImmediateChild(o,b.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,r,s)}updatePriority(e,n){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){let n=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),n)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){let n=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),n)}else return e.getIndex().maxPost()}};var Jl=class{constructor(e){this.withinDirectionalStart=n=>this.reverse_?this.withinEndPost(n):this.withinStartPost(n),this.withinDirectionalEnd=n=>this.reverse_?this.withinStartPost(n):this.withinEndPost(n),this.withinStartPost=n=>{let s=this.index_.compare(this.rangedFilter_.getStartPost(),n);return this.startIsInclusive_?s<=0:s<0},this.withinEndPost=n=>{let s=this.index_.compare(n,this.rangedFilter_.getEndPost());return this.endIsInclusive_?s<=0:s<0},this.rangedFilter_=new qi(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,n,s,r,i,o){return this.rangedFilter_.matches(new R(n,s))||(s=b.EMPTY_NODE),e.getImmediateChild(n).equals(s)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,n,s,r,i,o):this.fullLimitUpdateChild_(e,n,s,i,o)}updateFullNode(e,n,s){let r;if(n.isLeafNode()||n.isEmpty())r=b.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<n.numChildren()&&n.isIndexed(this.index_)){r=b.EMPTY_NODE.withIndex(this.index_);let i;this.reverse_?i=n.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):i=n.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;i.hasNext()&&o<this.limit_;){let a=i.getNext();if(this.withinDirectionalStart(a))if(this.withinDirectionalEnd(a))r=r.updateImmediateChild(a.name,a.node),o++;else break;else continue}}else{r=n.withIndex(this.index_),r=r.updatePriority(b.EMPTY_NODE);let i;this.reverse_?i=r.getReverseIterator(this.index_):i=r.getIterator(this.index_);let o=0;for(;i.hasNext();){let a=i.getNext();o<this.limit_&&this.withinDirectionalStart(a)&&this.withinDirectionalEnd(a)?o++:r=r.updateImmediateChild(a.name,b.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,r,s)}updatePriority(e,n){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,n,s,r,i){let o;if(this.reverse_){let h=this.index_.getCompare();o=(d,p)=>h(p,d)}else o=this.index_.getCompare();let a=e;g(a.numChildren()===this.limit_,"");let l=new R(n,s),c=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),u=this.rangedFilter_.matches(l);if(a.hasChild(n)){let h=a.getImmediateChild(n),d=r.getChildAfterChild(this.index_,c,this.reverse_);for(;d!=null&&(d.name===n||a.hasChild(d.name));)d=r.getChildAfterChild(this.index_,d,this.reverse_);let p=d==null?1:o(d,l);if(u&&!s.isEmpty()&&p>=0)return i?.trackChildChange(Hs(n,s,h)),a.updateImmediateChild(n,s);{i?.trackChildChange(Qs(n,h));let m=a.updateImmediateChild(n,b.EMPTY_NODE);return d!=null&&this.rangedFilter_.matches(d)?(i?.trackChildChange(Wn(d.name,d.node)),m.updateImmediateChild(d.name,d.node)):m}}else return s.isEmpty()?e:u&&o(c,l)>=0?(i!=null&&(i.trackChildChange(Qs(c.name,c.node)),i.trackChildChange(Wn(n,s))),a.updateImmediateChild(n,s).updateImmediateChild(c.name,b.EMPTY_NODE)):e}};var Zl=class t{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Y}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return g(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return g(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:zn}hasEnd(){return this.endSet_}getIndexEndValue(){return g(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return g(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Zt}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return g(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===Y}copy(){let e=new t;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}};function JE(t){return t.loadsAllData()?new Ys(t.getIndex()):t.hasLimit()?new Jl(t):new qi(t)}function np(t){let e={};if(t.isDefault())return e;let n;if(t.index_===Y?n="$priority":t.index_===YE?n="$value":t.index_===$n?n="$key":(g(t.index_ instanceof Yl,"Unrecognized index type!"),n=t.index_.toString()),e.orderBy=X(n),t.startSet_){let s=t.startAfterSet_?"startAfter":"startAt";e[s]=X(t.indexStartValue_),t.startNameSet_&&(e[s]+=","+X(t.indexStartName_))}if(t.endSet_){let s=t.endBeforeSet_?"endBefore":"endAt";e[s]=X(t.indexEndValue_),t.endNameSet_&&(e[s]+=","+X(t.indexEndName_))}return t.limitSet_&&(t.isViewFromLeft()?e.limitToFirst=t.limit_:e.limitToLast=t.limit_),e}function sp(t){let e={};if(t.startSet_&&(e.sp=t.indexStartValue_,t.startNameSet_&&(e.sn=t.indexStartName_),e.sin=!t.startAfterSet_),t.endSet_&&(e.ep=t.indexEndValue_,t.endNameSet_&&(e.en=t.indexEndName_),e.ein=!t.endBeforeSet_),t.limitSet_){e.l=t.limit_;let n=t.viewFrom_;n===""&&(t.isViewFromLeft()?n="l":n="r"),e.vf=n}return t.index_!==Y&&(e.i=t.index_.toString()),e}var ec=class t extends Fi{constructor(e,n,s,r){super(),this.repoInfo_=e,this.onDataUpdate_=n,this.authTokenProvider_=s,this.appCheckTokenProvider_=r,this.log_=nr("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,n){return n!==void 0?"tag$"+n:(g(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,n,s,r){let i=e._path.toString();this.log_("Listen called for "+i+" "+e._queryIdentifier);let o=t.getListenId_(e,s),a={};this.listens_[o]=a;let l=np(e._queryParams);this.restRequest_(i+".json",l,(c,u)=>{let h=u;if(c===404&&(h=null,c=null),c===null&&this.onDataUpdate_(i,h,!1,s),Lt(this.listens_,o)===a){let d;c?c===401?d="permission_denied":d="rest_error:"+c:d="ok",r(d,null)}})}unlisten(e,n){let s=t.getListenId_(e,n);delete this.listens_[s]}get(e){let n=np(e._queryParams),s=e._path.toString(),r=new vr;return this.restRequest_(s+".json",n,(i,o)=>{let a=o;i===404&&(a=null,i=null),i===null?(this.onDataUpdate_(s,a,!1,null),r.resolve(a)):r.reject(new Error(a))}),r.promise}refreshAuthToken(e){}restRequest_(e,n={},s){return n.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([r,i])=>{r&&r.accessToken&&(n.auth=r.accessToken),i&&i.token&&(n.ac=i.token);let o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+th(n);this.log_("Sending REST request for "+o);let a=new XMLHttpRequest;a.onreadystatechange=()=>{if(s&&a.readyState===4){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let l=null;if(a.status>=200&&a.status<300){try{l=wr(a.responseText)}catch{we("Failed to parse JSON response for "+o+": "+a.responseText)}s(null,l)}else a.status!==401&&a.status!==404&&we("Got unsuccessful REST response for "+o+" Status: "+a.status),s(a.status);s=null}},a.open("GET",o,!0),a.send()})}};var tc=class{constructor(){this.rootNode_=b.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,n){this.rootNode_=this.rootNode_.updateChild(e,n)}};function $i(){return{value:null,children:new Map}}function Qp(t,e,n){if(P(e))t.value=n,t.children.clear();else if(t.value!==null)t.value=t.value.updateChild(e,n);else{let s=D(e);t.children.has(s)||t.children.set(s,$i());let r=t.children.get(s);e=z(e),Qp(r,e,n)}}function nc(t,e,n){t.value!==null?n(e,t.value):ZE(t,(s,r)=>{let i=new B(e.toString()+"/"+s);nc(r,i,n)})}function ZE(t,e){t.children.forEach((n,s)=>{e(s,n)})}var sc=class{constructor(e){this.collection_=e,this.last_=null}get(){let e=this.collection_.get(),n=Object.assign({},e);return this.last_&&Te(this.last_,(s,r)=>{n[s]=n[s]-r}),this.last_=e,n}};var rp=10*1e3,ew=30*1e3,tw=5*60*1e3,rc=class{constructor(e,n){this.server_=n,this.statsToReport_={},this.statsListener_=new sc(e);let s=rp+(ew-rp)*Math.random();zs(this.reportStats_.bind(this),Math.floor(s))}reportStats_(){let e=this.statsListener_.get(),n={},s=!1;Te(e,(r,i)=>{i>0&&We(this.statsToReport_,r)&&(n[r]=i,s=!0)}),s&&this.server_.reportStats(n),zs(this.reportStats_.bind(this),Math.floor(Math.random()*2*tw))}};var rt=function(t){return t[t.OVERWRITE=0]="OVERWRITE",t[t.MERGE=1]="MERGE",t[t.ACK_USER_WRITE=2]="ACK_USER_WRITE",t[t.LISTEN_COMPLETE=3]="LISTEN_COMPLETE",t}(rt||{});function Hp(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function Dc(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function kc(t){return{fromUser:!1,fromServer:!0,queryId:t,tagged:!0}}var ic=class t{constructor(e,n,s){this.path=e,this.affectedTree=n,this.revert=s,this.type=rt.ACK_USER_WRITE,this.source=Hp()}operationForChild(e){if(P(this.path)){if(this.affectedTree.value!=null)return g(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{let n=this.affectedTree.subtree(new B(e));return new t(V(),n,this.revert)}}else return g(D(this.path)===e,"operationForChild called for unrelated child."),new t(z(this.path),this.affectedTree,this.revert)}};var zi=class t{constructor(e,n){this.source=e,this.path=n,this.type=rt.LISTEN_COMPLETE}operationForChild(e){return P(this.path)?new t(this.source,V()):new t(this.source,z(this.path))}};var Qn=class t{constructor(e,n,s){this.source=e,this.path=n,this.snap=s,this.type=rt.OVERWRITE}operationForChild(e){return P(this.path)?new t(this.source,V(),this.snap.getImmediateChild(e)):new t(this.source,z(this.path),this.snap)}};var ji=class t{constructor(e,n,s){this.source=e,this.path=n,this.children=s,this.type=rt.MERGE}operationForChild(e){if(P(this.path)){let n=this.children.subtree(new B(e));return n.isEmpty()?null:n.value?new Qn(this.source,V(),n.value):new t(this.source,V(),n)}else return g(D(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new t(this.source,z(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}};var it=class{constructor(e,n,s){this.node_=e,this.fullyInitialized_=n,this.filtered_=s}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(P(e))return this.isFullyInitialized()&&!this.filtered_;let n=D(e);return this.isCompleteForChild(n)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}};var oc=class{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}};function nw(t,e,n,s){let r=[],i=[];return e.forEach(o=>{o.type==="child_changed"&&t.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&i.push(XE(o.childName,o.snapshotNode))}),$s(t,r,"child_removed",e,s,n),$s(t,r,"child_added",e,s,n),$s(t,r,"child_moved",i,s,n),$s(t,r,"child_changed",e,s,n),$s(t,r,"value",e,s,n),r}function $s(t,e,n,s,r,i){let o=s.filter(a=>a.type===n);o.sort((a,l)=>rw(t,a,l)),o.forEach(a=>{let l=sw(t,a,i);r.forEach(c=>{c.respondsTo(a.type)&&e.push(c.createEvent(l,t.query_))})})}function sw(t,e,n){return e.type==="value"||e.type==="child_removed"||(e.prevName=n.getPredecessorChildName(e.childName,e.snapshotNode,t.index_)),e}function rw(t,e,n){if(e.childName==null||n.childName==null)throw an("Should only compare child_ events.");let s=new R(e.childName,e.snapshotNode),r=new R(n.childName,n.snapshotNode);return t.index_.compare(s,r)}function eo(t,e){return{eventCache:t,serverCache:e}}function Gs(t,e,n,s){return eo(new it(e,n,s),t.serverCache)}function Yp(t,e,n,s){return eo(t.eventCache,new it(e,n,s))}function Gi(t){return t.eventCache.isFullyInitialized()?t.eventCache.getNode():null}function en(t){return t.serverCache.isFullyInitialized()?t.serverCache.getNode():null}var Rl,iw=()=>(Rl||(Rl=new Oe(oE)),Rl),Ie=class t{constructor(e,n=iw()){this.value=e,this.children=n}static fromObject(e){let n=new t(null);return Te(e,(s,r)=>{n=n.set(new B(s),r)}),n}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,n){if(this.value!=null&&n(this.value))return{path:V(),value:this.value};if(P(e))return null;{let s=D(e),r=this.children.get(s);if(r!==null){let i=r.findRootMostMatchingPathAndValue(z(e),n);return i!=null?{path:te(new B(s),i.path),value:i.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(P(e))return this;{let n=D(e),s=this.children.get(n);return s!==null?s.subtree(z(e)):new t(null)}}set(e,n){if(P(e))return new t(n,this.children);{let s=D(e),i=(this.children.get(s)||new t(null)).set(z(e),n),o=this.children.insert(s,i);return new t(this.value,o)}}remove(e){if(P(e))return this.children.isEmpty()?new t(null):new t(null,this.children);{let n=D(e),s=this.children.get(n);if(s){let r=s.remove(z(e)),i;return r.isEmpty()?i=this.children.remove(n):i=this.children.insert(n,r),this.value===null&&i.isEmpty()?new t(null):new t(this.value,i)}else return this}}get(e){if(P(e))return this.value;{let n=D(e),s=this.children.get(n);return s?s.get(z(e)):null}}setTree(e,n){if(P(e))return n;{let s=D(e),i=(this.children.get(s)||new t(null)).setTree(z(e),n),o;return i.isEmpty()?o=this.children.remove(s):o=this.children.insert(s,i),new t(this.value,o)}}fold(e){return this.fold_(V(),e)}fold_(e,n){let s={};return this.children.inorderTraversal((r,i)=>{s[r]=i.fold_(te(e,r),n)}),n(e,this.value,s)}findOnPath(e,n){return this.findOnPath_(e,V(),n)}findOnPath_(e,n,s){let r=this.value?s(n,this.value):!1;if(r)return r;if(P(e))return null;{let i=D(e),o=this.children.get(i);return o?o.findOnPath_(z(e),te(n,i),s):null}}foreachOnPath(e,n){return this.foreachOnPath_(e,V(),n)}foreachOnPath_(e,n,s){if(P(e))return this;{this.value&&s(n,this.value);let r=D(e),i=this.children.get(r);return i?i.foreachOnPath_(z(e),te(n,r),s):new t(null)}}foreach(e){this.foreach_(V(),e)}foreach_(e,n){this.children.inorderTraversal((s,r)=>{r.foreach_(te(e,s),n)}),this.value&&n(e,this.value)}foreachChild(e){this.children.inorderTraversal((n,s)=>{s.value&&e(n,s.value)})}};var $e=class t{constructor(e){this.writeTree_=e}static empty(){return new t(new Ie(null))}};function Ks(t,e,n){if(P(e))return new $e(new Ie(n));{let s=t.writeTree_.findRootMostValueAndPath(e);if(s!=null){let r=s.path,i=s.value,o=ve(r,e);return i=i.updateChild(o,n),new $e(t.writeTree_.set(r,i))}else{let r=new Ie(n),i=t.writeTree_.setTree(e,r);return new $e(i)}}}function ip(t,e,n){let s=t;return Te(n,(r,i)=>{s=Ks(s,te(e,r),i)}),s}function op(t,e){if(P(e))return $e.empty();{let n=t.writeTree_.setTree(e,new Ie(null));return new $e(n)}}function ac(t,e){return tn(t,e)!=null}function tn(t,e){let n=t.writeTree_.findRootMostValueAndPath(e);return n!=null?t.writeTree_.get(n.path).getChild(ve(n.path,e)):null}function ap(t){let e=[],n=t.writeTree_.value;return n!=null?n.isLeafNode()||n.forEachChild(Y,(s,r)=>{e.push(new R(s,r))}):t.writeTree_.children.inorderTraversal((s,r)=>{r.value!=null&&e.push(new R(s,r.value))}),e}function Nt(t,e){if(P(e))return t;{let n=tn(t,e);return n!=null?new $e(new Ie(n)):new $e(t.writeTree_.subtree(e))}}function lc(t){return t.writeTree_.isEmpty()}function Hn(t,e){return Xp(V(),t.writeTree_,e)}function Xp(t,e,n){if(e.value!=null)return n.updateChild(t,e.value);{let s=null;return e.children.inorderTraversal((r,i)=>{r===".priority"?(g(i.value!==null,"Priority writes must always be leaf nodes"),s=i.value):n=Xp(te(t,r),i,n)}),!n.getChild(t).isEmpty()&&s!==null&&(n=n.updateChild(te(t,".priority"),s)),n}}function to(t,e){return tm(e,t)}function ow(t,e,n,s,r){g(s>t.lastWriteId,"Stacking an older write on top of newer ones"),r===void 0&&(r=!0),t.allWrites.push({path:e,snap:n,writeId:s,visible:r}),r&&(t.visibleWrites=Ks(t.visibleWrites,e,n)),t.lastWriteId=s}function aw(t,e){for(let n=0;n<t.allWrites.length;n++){let s=t.allWrites[n];if(s.writeId===e)return s}return null}function lw(t,e){let n=t.allWrites.findIndex(a=>a.writeId===e);g(n>=0,"removeWrite called with nonexistent writeId.");let s=t.allWrites[n];t.allWrites.splice(n,1);let r=s.visible,i=!1,o=t.allWrites.length-1;for(;r&&o>=0;){let a=t.allWrites[o];a.visible&&(o>=n&&cw(a,s.path)?r=!1:qe(s.path,a.path)&&(i=!0)),o--}if(r){if(i)return uw(t),!0;if(s.snap)t.visibleWrites=op(t.visibleWrites,s.path);else{let a=s.children;Te(a,l=>{t.visibleWrites=op(t.visibleWrites,te(s.path,l))})}return!0}else return!1}function cw(t,e){if(t.snap)return qe(t.path,e);for(let n in t.children)if(t.children.hasOwnProperty(n)&&qe(te(t.path,n),e))return!0;return!1}function uw(t){t.visibleWrites=Jp(t.allWrites,hw,V()),t.allWrites.length>0?t.lastWriteId=t.allWrites[t.allWrites.length-1].writeId:t.lastWriteId=-1}function hw(t){return t.visible}function Jp(t,e,n){let s=$e.empty();for(let r=0;r<t.length;++r){let i=t[r];if(e(i)){let o=i.path,a;if(i.snap)qe(n,o)?(a=ve(n,o),s=Ks(s,a,i.snap)):qe(o,n)&&(a=ve(o,n),s=Ks(s,V(),i.snap.getChild(a)));else if(i.children){if(qe(n,o))a=ve(n,o),s=ip(s,a,i.children);else if(qe(o,n))if(a=ve(o,n),P(a))s=ip(s,V(),i.children);else{let l=Lt(i.children,D(a));if(l){let c=l.getChild(z(a));s=Ks(s,V(),c)}}}else throw an("WriteRecord should have .snap or .children")}}return s}function Zp(t,e,n,s,r){if(!s&&!r){let i=tn(t.visibleWrites,e);if(i!=null)return i;{let o=Nt(t.visibleWrites,e);if(lc(o))return n;if(n==null&&!ac(o,V()))return null;{let a=n||b.EMPTY_NODE;return Hn(o,a)}}}else{let i=Nt(t.visibleWrites,e);if(!r&&lc(i))return n;if(!r&&n==null&&!ac(i,V()))return null;{let o=function(c){return(c.visible||r)&&(!s||!~s.indexOf(c.writeId))&&(qe(c.path,e)||qe(e,c.path))},a=Jp(t.allWrites,o,e),l=n||b.EMPTY_NODE;return Hn(a,l)}}}function dw(t,e,n){let s=b.EMPTY_NODE,r=tn(t.visibleWrites,e);if(r)return r.isLeafNode()||r.forEachChild(Y,(i,o)=>{s=s.updateImmediateChild(i,o)}),s;if(n){let i=Nt(t.visibleWrites,e);return n.forEachChild(Y,(o,a)=>{let l=Hn(Nt(i,new B(o)),a);s=s.updateImmediateChild(o,l)}),ap(i).forEach(o=>{s=s.updateImmediateChild(o.name,o.node)}),s}else{let i=Nt(t.visibleWrites,e);return ap(i).forEach(o=>{s=s.updateImmediateChild(o.name,o.node)}),s}}function fw(t,e,n,s,r){g(s||r,"Either existingEventSnap or existingServerSnap must exist");let i=te(e,n);if(ac(t.visibleWrites,i))return null;{let o=Nt(t.visibleWrites,i);return lc(o)?r.getChild(n):Hn(o,r.getChild(n))}}function pw(t,e,n,s){let r=te(e,n),i=tn(t.visibleWrites,r);if(i!=null)return i;if(s.isCompleteForChild(n)){let o=Nt(t.visibleWrites,r);return Hn(o,s.getNode().getImmediateChild(n))}else return null}function mw(t,e){return tn(t.visibleWrites,e)}function gw(t,e,n,s,r,i,o){let a,l=Nt(t.visibleWrites,e),c=tn(l,V());if(c!=null)a=c;else if(n!=null)a=Hn(l,n);else return[];if(a=a.withIndex(o),!a.isEmpty()&&!a.isLeafNode()){let u=[],h=o.getCompare(),d=i?a.getReverseIteratorFrom(s,o):a.getIteratorFrom(s,o),p=d.getNext();for(;p&&u.length<r;)h(p,s)!==0&&u.push(p),p=d.getNext();return u}else return[]}function _w(){return{visibleWrites:$e.empty(),allWrites:[],lastWriteId:-1}}function Ki(t,e,n,s){return Zp(t.writeTree,t.treePath,e,n,s)}function xc(t,e){return dw(t.writeTree,t.treePath,e)}function lp(t,e,n,s){return fw(t.writeTree,t.treePath,e,n,s)}function Wi(t,e){return mw(t.writeTree,te(t.treePath,e))}function yw(t,e,n,s,r,i){return gw(t.writeTree,t.treePath,e,n,s,r,i)}function Oc(t,e,n){return pw(t.writeTree,t.treePath,e,n)}function em(t,e){return tm(te(t.treePath,e),t.writeTree)}function tm(t,e){return{treePath:t,writeTree:e}}var cc=class{constructor(){this.changeMap=new Map}trackChildChange(e){let n=e.type,s=e.childName;g(n==="child_added"||n==="child_changed"||n==="child_removed","Only child changes supported for tracking"),g(s!==".priority","Only non-priority child changes can be tracked.");let r=this.changeMap.get(s);if(r){let i=r.type;if(n==="child_added"&&i==="child_removed")this.changeMap.set(s,Hs(s,e.snapshotNode,r.snapshotNode));else if(n==="child_removed"&&i==="child_added")this.changeMap.delete(s);else if(n==="child_removed"&&i==="child_changed")this.changeMap.set(s,Qs(s,r.oldSnap));else if(n==="child_changed"&&i==="child_added")this.changeMap.set(s,Wn(s,e.snapshotNode));else if(n==="child_changed"&&i==="child_changed")this.changeMap.set(s,Hs(s,e.snapshotNode,r.oldSnap));else throw an("Illegal combination of changes: "+e+" occurred after "+r)}else this.changeMap.set(s,e)}getChanges(){return Array.from(this.changeMap.values())}};var uc=class{getCompleteChild(e){return null}getChildAfterChild(e,n,s){return null}},nm=new uc,Xs=class{constructor(e,n,s=null){this.writes_=e,this.viewCache_=n,this.optCompleteServerCache_=s}getCompleteChild(e){let n=this.viewCache_.eventCache;if(n.isCompleteForChild(e))return n.getNode().getImmediateChild(e);{let s=this.optCompleteServerCache_!=null?new it(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Oc(this.writes_,e,s)}}getChildAfterChild(e,n,s){let r=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:en(this.viewCache_),i=yw(this.writes_,r,n,1,s,e);return i.length===0?null:i[0]}};function vw(t){return{filter:t}}function Ew(t,e){g(e.eventCache.getNode().isIndexed(t.filter.getIndex()),"Event snap not indexed"),g(e.serverCache.getNode().isIndexed(t.filter.getIndex()),"Server snap not indexed")}function ww(t,e,n,s,r){let i=new cc,o,a;if(n.type===rt.OVERWRITE){let c=n;c.source.fromUser?o=hc(t,e,c.path,c.snap,s,r,i):(g(c.source.fromServer,"Unknown source."),a=c.source.tagged||e.serverCache.isFiltered()&&!P(c.path),o=Qi(t,e,c.path,c.snap,s,r,a,i))}else if(n.type===rt.MERGE){let c=n;c.source.fromUser?o=Iw(t,e,c.path,c.children,s,r,i):(g(c.source.fromServer,"Unknown source."),a=c.source.tagged||e.serverCache.isFiltered(),o=dc(t,e,c.path,c.children,s,r,a,i))}else if(n.type===rt.ACK_USER_WRITE){let c=n;c.revert?o=bw(t,e,c.path,s,r,i):o=Sw(t,e,c.path,c.affectedTree,s,r,i)}else if(n.type===rt.LISTEN_COMPLETE)o=Aw(t,e,n.path,s,i);else throw an("Unknown operation type: "+n.type);let l=i.getChanges();return Tw(e,o,l),{viewCache:o,changes:l}}function Tw(t,e,n){let s=e.eventCache;if(s.isFullyInitialized()){let r=s.getNode().isLeafNode()||s.getNode().isEmpty(),i=Gi(t);(n.length>0||!t.eventCache.isFullyInitialized()||r&&!s.getNode().equals(i)||!s.getNode().getPriority().equals(i.getPriority()))&&n.push(Wp(Gi(e)))}}function sm(t,e,n,s,r,i){let o=e.eventCache;if(Wi(s,n)!=null)return e;{let a,l;if(P(n))if(g(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){let c=en(e),u=c instanceof b?c:b.EMPTY_NODE,h=xc(s,u);a=t.filter.updateFullNode(e.eventCache.getNode(),h,i)}else{let c=Ki(s,en(e));a=t.filter.updateFullNode(e.eventCache.getNode(),c,i)}else{let c=D(n);if(c===".priority"){g(kt(n)===1,"Can't have a priority with additional path components");let u=o.getNode();l=e.serverCache.getNode();let h=lp(s,n,u,l);h!=null?a=t.filter.updatePriority(u,h):a=o.getNode()}else{let u=z(n),h;if(o.isCompleteForChild(c)){l=e.serverCache.getNode();let d=lp(s,n,o.getNode(),l);d!=null?h=o.getNode().getImmediateChild(c).updateChild(u,d):h=o.getNode().getImmediateChild(c)}else h=Oc(s,c,e.serverCache);h!=null?a=t.filter.updateChild(o.getNode(),c,h,u,r,i):a=o.getNode()}}return Gs(e,a,o.isFullyInitialized()||P(n),t.filter.filtersNodes())}}function Qi(t,e,n,s,r,i,o,a){let l=e.serverCache,c,u=o?t.filter:t.filter.getIndexedFilter();if(P(n))c=u.updateFullNode(l.getNode(),s,null);else if(u.filtersNodes()&&!l.isFiltered()){let p=l.getNode().updateChild(n,s);c=u.updateFullNode(l.getNode(),p,null)}else{let p=D(n);if(!l.isCompleteForPath(n)&&kt(n)>1)return e;let f=z(n),y=l.getNode().getImmediateChild(p).updateChild(f,s);p===".priority"?c=u.updatePriority(l.getNode(),y):c=u.updateChild(l.getNode(),p,y,f,nm,null)}let h=Yp(e,c,l.isFullyInitialized()||P(n),u.filtersNodes()),d=new Xs(r,h,i);return sm(t,h,n,r,d,a)}function hc(t,e,n,s,r,i,o){let a=e.eventCache,l,c,u=new Xs(r,e,i);if(P(n))c=t.filter.updateFullNode(e.eventCache.getNode(),s,o),l=Gs(e,c,!0,t.filter.filtersNodes());else{let h=D(n);if(h===".priority")c=t.filter.updatePriority(e.eventCache.getNode(),s),l=Gs(e,c,a.isFullyInitialized(),a.isFiltered());else{let d=z(n),p=a.getNode().getImmediateChild(h),f;if(P(d))f=s;else{let m=u.getCompleteChild(h);m!=null?Lp(d)===".priority"&&m.getChild(Bp(d)).isEmpty()?f=m:f=m.updateChild(d,s):f=b.EMPTY_NODE}if(p.equals(f))l=e;else{let m=t.filter.updateChild(a.getNode(),h,f,d,u,o);l=Gs(e,m,a.isFullyInitialized(),t.filter.filtersNodes())}}}return l}function cp(t,e){return t.eventCache.isCompleteForChild(e)}function Iw(t,e,n,s,r,i,o){let a=e;return s.foreach((l,c)=>{let u=te(n,l);cp(e,D(u))&&(a=hc(t,a,u,c,r,i,o))}),s.foreach((l,c)=>{let u=te(n,l);cp(e,D(u))||(a=hc(t,a,u,c,r,i,o))}),a}function up(t,e,n){return n.foreach((s,r)=>{e=e.updateChild(s,r)}),e}function dc(t,e,n,s,r,i,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let l=e,c;P(n)?c=s:c=new Ie(null).setTree(n,s);let u=e.serverCache.getNode();return c.children.inorderTraversal((h,d)=>{if(u.hasChild(h)){let p=e.serverCache.getNode().getImmediateChild(h),f=up(t,p,d);l=Qi(t,l,new B(h),f,r,i,o,a)}}),c.children.inorderTraversal((h,d)=>{let p=!e.serverCache.isCompleteForChild(h)&&d.value===null;if(!u.hasChild(h)&&!p){let f=e.serverCache.getNode().getImmediateChild(h),m=up(t,f,d);l=Qi(t,l,new B(h),m,r,i,o,a)}}),l}function Sw(t,e,n,s,r,i,o){if(Wi(r,n)!=null)return e;let a=e.serverCache.isFiltered(),l=e.serverCache;if(s.value!=null){if(P(n)&&l.isFullyInitialized()||l.isCompleteForPath(n))return Qi(t,e,n,l.getNode().getChild(n),r,i,a,o);if(P(n)){let c=new Ie(null);return l.getNode().forEachChild($n,(u,h)=>{c=c.set(new B(u),h)}),dc(t,e,n,c,r,i,a,o)}else return e}else{let c=new Ie(null);return s.foreach((u,h)=>{let d=te(n,u);l.isCompleteForPath(d)&&(c=c.set(u,l.getNode().getChild(d)))}),dc(t,e,n,c,r,i,a,o)}}function Aw(t,e,n,s,r){let i=e.serverCache,o=Yp(e,i.getNode(),i.isFullyInitialized()||P(n),i.isFiltered());return sm(t,o,n,s,nm,r)}function bw(t,e,n,s,r,i){let o;if(Wi(s,n)!=null)return e;{let a=new Xs(s,e,r),l=e.eventCache.getNode(),c;if(P(n)||D(n)===".priority"){let u;if(e.serverCache.isFullyInitialized())u=Ki(s,en(e));else{let h=e.serverCache.getNode();g(h instanceof b,"serverChildren would be complete if leaf node"),u=xc(s,h)}u=u,c=t.filter.updateFullNode(l,u,i)}else{let u=D(n),h=Oc(s,u,e.serverCache);h==null&&e.serverCache.isCompleteForChild(u)&&(h=l.getImmediateChild(u)),h!=null?c=t.filter.updateChild(l,u,h,z(n),a,i):e.eventCache.getNode().hasChild(u)?c=t.filter.updateChild(l,u,b.EMPTY_NODE,z(n),a,i):c=l,c.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=Ki(s,en(e)),o.isLeafNode()&&(c=t.filter.updateFullNode(c,o,i)))}return o=e.serverCache.isFullyInitialized()||Wi(s,V())!=null,Gs(e,c,o,t.filter.filtersNodes())}}var fc=class{constructor(e,n){this.query_=e,this.eventRegistrations_=[];let s=this.query_._queryParams,r=new Ys(s.getIndex()),i=JE(s);this.processor_=vw(i);let o=n.serverCache,a=n.eventCache,l=r.updateFullNode(b.EMPTY_NODE,o.getNode(),null),c=i.updateFullNode(b.EMPTY_NODE,a.getNode(),null),u=new it(l,o.isFullyInitialized(),r.filtersNodes()),h=new it(c,a.isFullyInitialized(),i.filtersNodes());this.viewCache_=eo(h,u),this.eventGenerator_=new oc(this.query_)}get query(){return this.query_}};function Cw(t){return t.viewCache_.serverCache.getNode()}function Rw(t){return Gi(t.viewCache_)}function Pw(t,e){let n=en(t.viewCache_);return n&&(t.query._queryParams.loadsAllData()||!P(e)&&!n.getImmediateChild(D(e)).isEmpty())?n.getChild(e):null}function hp(t){return t.eventRegistrations_.length===0}function Nw(t,e){t.eventRegistrations_.push(e)}function dp(t,e,n){let s=[];if(n){g(e==null,"A cancel should cancel all event registrations.");let r=t.query._path;t.eventRegistrations_.forEach(i=>{let o=i.createCancelEvent(n,r);o&&s.push(o)})}if(e){let r=[];for(let i=0;i<t.eventRegistrations_.length;++i){let o=t.eventRegistrations_[i];if(!o.matches(e))r.push(o);else if(e.hasAnyCallback()){r=r.concat(t.eventRegistrations_.slice(i+1));break}}t.eventRegistrations_=r}else t.eventRegistrations_=[];return s}function fp(t,e,n,s){e.type===rt.MERGE&&e.source.queryId!==null&&(g(en(t.viewCache_),"We should always have a full cache before handling merges"),g(Gi(t.viewCache_),"Missing event cache, even though we have a server cache"));let r=t.viewCache_,i=ww(t.processor_,r,e,n,s);return Ew(t.processor_,i.viewCache),g(i.viewCache.serverCache.isFullyInitialized()||!r.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),t.viewCache_=i.viewCache,rm(t,i.changes,i.viewCache.eventCache.getNode(),null)}function Dw(t,e){let n=t.viewCache_.eventCache,s=[];return n.getNode().isLeafNode()||n.getNode().forEachChild(Y,(i,o)=>{s.push(Wn(i,o))}),n.isFullyInitialized()&&s.push(Wp(n.getNode())),rm(t,s,n.getNode(),e)}function rm(t,e,n,s){let r=s?[s]:t.eventRegistrations_;return nw(t.eventGenerator_,e,n,r)}var Hi,Yi=class{constructor(){this.views=new Map}};function kw(t){g(!Hi,"__referenceConstructor has already been defined"),Hi=t}function xw(){return g(Hi,"Reference.ts has not been loaded"),Hi}function Ow(t){return t.views.size===0}function Mc(t,e,n,s){let r=e.source.queryId;if(r!==null){let i=t.views.get(r);return g(i!=null,"SyncTree gave us an op for an invalid query."),fp(i,e,n,s)}else{let i=[];for(let o of t.views.values())i=i.concat(fp(o,e,n,s));return i}}function im(t,e,n,s,r){let i=e._queryIdentifier,o=t.views.get(i);if(!o){let a=Ki(n,r?s:null),l=!1;a?l=!0:s instanceof b?(a=xc(n,s),l=!1):(a=b.EMPTY_NODE,l=!1);let c=eo(new it(a,l,!1),new it(s,r,!1));return new fc(e,c)}return o}function Mw(t,e,n,s,r,i){let o=im(t,e,s,r,i);return t.views.has(e._queryIdentifier)||t.views.set(e._queryIdentifier,o),Nw(o,n),Dw(o,n)}function Fw(t,e,n,s){let r=e._queryIdentifier,i=[],o=[],a=xt(t);if(r==="default")for(let[l,c]of t.views.entries())o=o.concat(dp(c,n,s)),hp(c)&&(t.views.delete(l),c.query._queryParams.loadsAllData()||i.push(c.query));else{let l=t.views.get(r);l&&(o=o.concat(dp(l,n,s)),hp(l)&&(t.views.delete(r),l.query._queryParams.loadsAllData()||i.push(l.query)))}return a&&!xt(t)&&i.push(new(xw())(e._repo,e._path)),{removed:i,events:o}}function om(t){let e=[];for(let n of t.views.values())n.query._queryParams.loadsAllData()||e.push(n);return e}function Dt(t,e){let n=null;for(let s of t.views.values())n=n||Pw(s,e);return n}function am(t,e){if(e._queryParams.loadsAllData())return no(t);{let s=e._queryIdentifier;return t.views.get(s)}}function lm(t,e){return am(t,e)!=null}function xt(t){return no(t)!=null}function no(t){for(let e of t.views.values())if(e.query._queryParams.loadsAllData())return e;return null}var Xi;function Vw(t){g(!Xi,"__referenceConstructor has already been defined"),Xi=t}function Lw(){return g(Xi,"Reference.ts has not been loaded"),Xi}var Uw=1,Ji=class{constructor(e){this.listenProvider_=e,this.syncPointTree_=new Ie(null),this.pendingWriteTree_=_w(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}};function cm(t,e,n,s,r){return ow(t.pendingWriteTree_,e,n,s,r),r?ir(t,new Qn(Hp(),e,n)):[]}function Xt(t,e,n=!1){let s=aw(t.pendingWriteTree_,e);if(lw(t.pendingWriteTree_,e)){let i=new Ie(null);return s.snap!=null?i=i.set(V(),!0):Te(s.children,o=>{i=i.set(new B(o),!0)}),ir(t,new ic(s.path,i,n))}else return[]}function rr(t,e,n){return ir(t,new Qn(Dc(),e,n))}function Bw(t,e,n){let s=Ie.fromObject(n);return ir(t,new ji(Dc(),e,s))}function qw(t,e){return ir(t,new zi(Dc(),e))}function $w(t,e,n){let s=Vc(t,n);if(s){let r=Lc(s),i=r.path,o=r.queryId,a=ve(i,e),l=new zi(kc(o),a);return Uc(t,i,l)}else return[]}function um(t,e,n,s,r=!1){let i=e._path,o=t.syncPointTree_.get(i),a=[];if(o&&(e._queryIdentifier==="default"||lm(o,e))){let l=Fw(o,e,n,s);Ow(o)&&(t.syncPointTree_=t.syncPointTree_.remove(i));let c=l.removed;if(a=l.events,!r){let u=c.findIndex(d=>d._queryParams.loadsAllData())!==-1,h=t.syncPointTree_.findOnPath(i,(d,p)=>xt(p));if(u&&!h){let d=t.syncPointTree_.subtree(i);if(!d.isEmpty()){let p=Kw(d);for(let f=0;f<p.length;++f){let m=p[f],y=m.query,I=pm(t,m);t.listenProvider_.startListening(Ws(y),Js(t,y),I.hashFn,I.onComplete)}}}!h&&c.length>0&&!s&&(u?t.listenProvider_.stopListening(Ws(e),null):c.forEach(d=>{let p=t.queryToTagMap.get(so(d));t.listenProvider_.stopListening(Ws(d),p)}))}Ww(t,c)}return a}function hm(t,e,n,s){let r=Vc(t,s);if(r!=null){let i=Lc(r),o=i.path,a=i.queryId,l=ve(o,e),c=new Qn(kc(a),l,n);return Uc(t,o,c)}else return[]}function zw(t,e,n,s){let r=Vc(t,s);if(r){let i=Lc(r),o=i.path,a=i.queryId,l=ve(o,e),c=Ie.fromObject(n),u=new ji(kc(a),l,c);return Uc(t,o,u)}else return[]}function jw(t,e,n,s=!1){let r=e._path,i=null,o=!1;t.syncPointTree_.foreachOnPath(r,(d,p)=>{let f=ve(d,r);i=i||Dt(p,f),o=o||xt(p)});let a=t.syncPointTree_.get(r);a?(o=o||xt(a),i=i||Dt(a,V())):(a=new Yi,t.syncPointTree_=t.syncPointTree_.set(r,a));let l;i!=null?l=!0:(l=!1,i=b.EMPTY_NODE,t.syncPointTree_.subtree(r).foreachChild((p,f)=>{let m=Dt(f,V());m&&(i=i.updateImmediateChild(p,m))}));let c=lm(a,e);if(!c&&!e._queryParams.loadsAllData()){let d=so(e);g(!t.queryToTagMap.has(d),"View does not exist, but we have a tag");let p=Qw();t.queryToTagMap.set(d,p),t.tagToQueryMap.set(p,d)}let u=to(t.pendingWriteTree_,r),h=Mw(a,e,n,u,i,l);if(!c&&!o&&!s){let d=am(a,e);h=h.concat(Hw(t,e,d))}return h}function Fc(t,e,n){let r=t.pendingWriteTree_,i=t.syncPointTree_.findOnPath(e,(o,a)=>{let l=ve(o,e),c=Dt(a,l);if(c)return c});return Zp(r,e,i,n,!0)}function Gw(t,e){let n=e._path,s=null;t.syncPointTree_.foreachOnPath(n,(c,u)=>{let h=ve(c,n);s=s||Dt(u,h)});let r=t.syncPointTree_.get(n);r?s=s||Dt(r,V()):(r=new Yi,t.syncPointTree_=t.syncPointTree_.set(n,r));let i=s!=null,o=i?new it(s,!0,!1):null,a=to(t.pendingWriteTree_,e._path),l=im(r,e,a,i?o.getNode():b.EMPTY_NODE,i);return Rw(l)}function ir(t,e){return dm(e,t.syncPointTree_,null,to(t.pendingWriteTree_,V()))}function dm(t,e,n,s){if(P(t.path))return fm(t,e,n,s);{let r=e.get(V());n==null&&r!=null&&(n=Dt(r,V()));let i=[],o=D(t.path),a=t.operationForChild(o),l=e.children.get(o);if(l&&a){let c=n?n.getImmediateChild(o):null,u=em(s,o);i=i.concat(dm(a,l,c,u))}return r&&(i=i.concat(Mc(r,t,s,n))),i}}function fm(t,e,n,s){let r=e.get(V());n==null&&r!=null&&(n=Dt(r,V()));let i=[];return e.children.inorderTraversal((o,a)=>{let l=n?n.getImmediateChild(o):null,c=em(s,o),u=t.operationForChild(o);u&&(i=i.concat(fm(u,a,l,c)))}),r&&(i=i.concat(Mc(r,t,s,n))),i}function pm(t,e){let n=e.query,s=Js(t,n);return{hashFn:()=>(Cw(e)||b.EMPTY_NODE).hash(),onComplete:r=>{if(r==="ok")return s?$w(t,n._path,s):qw(t,n._path);{let i=cE(r,n);return um(t,n,null,i)}}}}function Js(t,e){let n=so(e);return t.queryToTagMap.get(n)}function so(t){return t._path.toString()+"$"+t._queryIdentifier}function Vc(t,e){return t.tagToQueryMap.get(e)}function Lc(t){let e=t.indexOf("$");return g(e!==-1&&e<t.length-1,"Bad queryKey."),{queryId:t.substr(e+1),path:new B(t.substr(0,e))}}function Uc(t,e,n){let s=t.syncPointTree_.get(e);g(s,"Missing sync point for query tag that we're tracking");let r=to(t.pendingWriteTree_,e);return Mc(s,n,r,null)}function Kw(t){return t.fold((e,n,s)=>{if(n&&xt(n))return[no(n)];{let r=[];return n&&(r=om(n)),Te(s,(i,o)=>{r=r.concat(o)}),r}})}function Ws(t){return t._queryParams.loadsAllData()&&!t._queryParams.isDefault()?new(Lw())(t._repo,t._path):t}function Ww(t,e){for(let n=0;n<e.length;++n){let s=e[n];if(!s._queryParams.loadsAllData()){let r=so(s),i=t.queryToTagMap.get(r);t.queryToTagMap.delete(r),t.tagToQueryMap.delete(i)}}}function Qw(){return Uw++}function Hw(t,e,n){let s=e._path,r=Js(t,e),i=pm(t,n),o=t.listenProvider_.startListening(Ws(e),r,i.hashFn,i.onComplete),a=t.syncPointTree_.subtree(s);if(r)g(!xt(a.value),"If we're adding a query, it shouldn't be shadowed");else{let l=a.fold((c,u,h)=>{if(!P(c)&&u&&xt(u))return[no(u).query];{let d=[];return u&&(d=d.concat(om(u).map(p=>p.query))),Te(h,(p,f)=>{d=d.concat(f)}),d}});for(let c=0;c<l.length;++c){let u=l[c];t.listenProvider_.stopListening(Ws(u),Js(t,u))}}return o}var pc=class t{constructor(e){this.node_=e}getImmediateChild(e){let n=this.node_.getImmediateChild(e);return new t(n)}node(){return this.node_}},mc=class t{constructor(e,n){this.syncTree_=e,this.path_=n}getImmediateChild(e){let n=te(this.path_,e);return new t(this.syncTree_,n)}node(){return Fc(this.syncTree_,this.path_)}},Yw=function(t){return t=t||{},t.timestamp=t.timestamp||new Date().getTime(),t},pp=function(t,e,n){if(!t||typeof t!="object")return t;if(g(".sv"in t,"Unexpected leaf node or priority contents"),typeof t[".sv"]=="string")return Xw(t[".sv"],e,n);if(typeof t[".sv"]=="object")return Jw(t[".sv"],e);g(!1,"Unexpected server value: "+JSON.stringify(t,null,2))},Xw=function(t,e,n){switch(t){case"timestamp":return n.timestamp;default:g(!1,"Unexpected server value: "+t)}},Jw=function(t,e,n){t.hasOwnProperty("increment")||g(!1,"Unexpected server value: "+JSON.stringify(t,null,2));let s=t.increment;typeof s!="number"&&g(!1,"Unexpected increment value: "+s);let r=e.node();if(g(r!==null&&typeof r<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!r.isLeafNode())return s;let o=r.getValue();return typeof o!="number"?s:o+s},Zw=function(t,e,n,s){return Bc(e,new mc(n,t),s)},mm=function(t,e,n){return Bc(t,new pc(e),n)};function Bc(t,e,n){let s=t.getPriority().val(),r=pp(s,e.getImmediateChild(".priority"),n),i;if(t.isLeafNode()){let o=t,a=pp(o.getValue(),e,n);return a!==o.getValue()||r!==o.getPriority().val()?new Gn(a,oe(r)):t}else{let o=t;return i=o,r!==o.getPriority().val()&&(i=i.updatePriority(new Gn(r))),o.forEachChild(Y,(a,l)=>{let c=Bc(l,e.getImmediateChild(a),n);c!==l&&(i=i.updateImmediateChild(a,c))}),i}}var Zs=class{constructor(e="",n=null,s={children:{},childCount:0}){this.name=e,this.parent=n,this.node=s}};function qc(t,e){let n=e instanceof B?e:new B(e),s=t,r=D(n);for(;r!==null;){let i=Lt(s.node.children,r)||{children:{},childCount:0};s=new Zs(r,s,i),n=z(n),r=D(n)}return s}function Jn(t){return t.node.value}function gm(t,e){t.node.value=e,gc(t)}function _m(t){return t.node.childCount>0}function eT(t){return Jn(t)===void 0&&!_m(t)}function ro(t,e){Te(t.node.children,(n,s)=>{e(new Zs(n,t,s))})}function ym(t,e,n,s){n&&!s&&e(t),ro(t,r=>{ym(r,e,!0,s)}),n&&s&&e(t)}function tT(t,e,n){let s=n?t:t.parent;for(;s!==null;){if(e(s))return!0;s=s.parent}return!1}function or(t){return new B(t.parent===null?t.name:or(t.parent)+"/"+t.name)}function gc(t){t.parent!==null&&nT(t.parent,t.name,t)}function nT(t,e,n){let s=eT(n),r=We(t.node.children,e);s&&r?(delete t.node.children[e],t.node.childCount--,gc(t)):!s&&!r&&(t.node.children[e]=n.node,t.node.childCount++,gc(t))}var sT=/[\[\].#$\/\u0000-\u001F\u007F]/,rT=/[\[\].#$\u0000-\u001F\u007F]/,Pl=10*1024*1024,vm=function(t){return typeof t=="string"&&t.length!==0&&!sT.test(t)},Em=function(t){return typeof t=="string"&&t.length!==0&&!rT.test(t)},iT=function(t){return t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),Em(t)};var oT=function(t,e,n,s){s&&e===void 0||$c(Tr(t,"value"),e,n)},$c=function(t,e,n){let s=n instanceof B?new zl(n,t):n;if(e===void 0)throw new Error(t+"contains undefined "+Ht(s));if(typeof e=="function")throw new Error(t+"contains a function "+Ht(s)+" with contents = "+e.toString());if(Ep(e))throw new Error(t+"contains "+e.toString()+" "+Ht(s));if(typeof e=="string"&&e.length>Pl/3&&is(e)>Pl)throw new Error(t+"contains a string greater than "+Pl+" utf8 bytes "+Ht(s)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let r=!1,i=!1;if(Te(e,(o,a)=>{if(o===".value")r=!0;else if(o!==".priority"&&o!==".sv"&&(i=!0,!vm(o)))throw new Error(t+" contains an invalid key ("+o+") "+Ht(s)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);LE(s,o),$c(t,a,s),UE(s)}),r&&i)throw new Error(t+' contains ".value" child '+Ht(s)+" in addition to actual children.")}};var wm=function(t,e,n,s){if(!(s&&n===void 0)&&!Em(n))throw new Error(Tr(t,e)+'was an invalid path = "'+n+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},aT=function(t,e,n,s){n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),wm(t,e,n,s)},lT=function(t,e){if(D(e)===".info")throw new Error(t+" failed = Can't modify data under /.info/")},cT=function(t,e){let n=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!vm(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||n.length!==0&&!iT(n))throw new Error(Tr(t,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};var _c=class{constructor(){this.eventLists_=[],this.recursionDepth_=0}};function Tm(t,e){let n=null;for(let s=0;s<e.length;s++){let r=e[s],i=r.getPath();n!==null&&!qp(i,n.path)&&(t.eventLists_.push(n),n=null),n===null&&(n={events:[],path:i}),n.events.push(r)}n&&t.eventLists_.push(n)}function ot(t,e,n){Tm(t,n),uT(t,s=>qe(s,e)||qe(e,s))}function uT(t,e){t.recursionDepth_++;let n=!0;for(let s=0;s<t.eventLists_.length;s++){let r=t.eventLists_[s];if(r){let i=r.path;e(i)?(hT(t.eventLists_[s]),t.eventLists_[s]=null):n=!1}}n&&(t.eventLists_=[]),t.recursionDepth_--}function hT(t){for(let e=0;e<t.events.length;e++){let n=t.events[e];if(n!==null){t.events[e]=null;let s=n.getEventRunner();Jt&&me("event: "+n.toString()),Xn(s)}}}var dT="repo_interrupt",fT=25,yc=class{constructor(e,n,s,r){this.repoInfo_=e,this.forceRestClient_=n,this.authTokenProvider_=s,this.appCheckProvider_=r,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new _c,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=$i(),this.transactionQueueTree_=new Zs,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}};function pT(t,e,n){if(t.stats_=Rc(t.repoInfo_),t.forceRestClient_||fE())t.server_=new ec(t.repoInfo_,(s,r,i,o)=>{mp(t,s,r,i,o)},t.authTokenProvider_,t.appCheckProvider_),setTimeout(()=>gp(t,!0),0);else{if(typeof n<"u"&&n!==null){if(typeof n!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{X(n)}catch(s){throw new Error("Invalid authOverride provided: "+s)}}t.persistentConnection_=new Pc(t.repoInfo_,e,(s,r,i,o)=>{mp(t,s,r,i,o)},s=>{gp(t,s)},s=>{gT(t,s)},t.authTokenProvider_,t.appCheckProvider_,n),t.server_=t.persistentConnection_}t.authTokenProvider_.addTokenChangeListener(s=>{t.server_.refreshAuthToken(s)}),t.appCheckProvider_.addTokenChangeListener(s=>{t.server_.refreshAppCheckToken(s.token)}),t.statsReporter_=mE(t.repoInfo_,()=>new rc(t.stats_,t.server_)),t.infoData_=new tc,t.infoSyncTree_=new Ji({startListening:(s,r,i,o)=>{let a=[],l=t.infoData_.getNode(s._path);return l.isEmpty()||(a=rr(t.infoSyncTree_,s._path,l),setTimeout(()=>{o("ok")},0)),a},stopListening:()=>{}}),jc(t,"connected",!1),t.serverSyncTree_=new Ji({startListening:(s,r,i,o)=>(t.server_.listen(s,i,r,(a,l)=>{let c=o(a,l);ot(t.eventQueue_,s._path,c)}),[]),stopListening:(s,r)=>{t.server_.unlisten(s,r)}})}function mT(t){let n=t.infoData_.getNode(new B(".info/serverTimeOffset")).val()||0;return new Date().getTime()+n}function zc(t){return Yw({timestamp:mT(t)})}function mp(t,e,n,s,r){t.dataUpdateCount++;let i=new B(e);n=t.interceptServerDataCallback_?t.interceptServerDataCallback_(e,n):n;let o=[];if(r)if(s){let l=rs(n,c=>oe(c));o=zw(t.serverSyncTree_,i,l,r)}else{let l=oe(n);o=hm(t.serverSyncTree_,i,l,r)}else if(s){let l=rs(n,c=>oe(c));o=Bw(t.serverSyncTree_,i,l)}else{let l=oe(n);o=rr(t.serverSyncTree_,i,l)}let a=i;o.length>0&&(a=oo(t,i)),ot(t.eventQueue_,a,o)}function gp(t,e){jc(t,"connected",e),e===!1&&vT(t)}function gT(t,e){Te(e,(n,s)=>{jc(t,n,s)})}function jc(t,e,n){let s=new B("/.info/"+e),r=oe(n);t.infoData_.updateSnapshot(s,r);let i=rr(t.infoSyncTree_,s,r);ot(t.eventQueue_,s,i)}function Im(t){return t.nextWriteId_++}function _T(t,e,n){let s=Gw(t.serverSyncTree_,e);return s!=null?Promise.resolve(s):t.server_.get(e).then(r=>{let i=oe(r).withIndex(e._queryParams.getIndex());jw(t.serverSyncTree_,e,n,!0);let o;if(e._queryParams.loadsAllData())o=rr(t.serverSyncTree_,e._path,i);else{let a=Js(t.serverSyncTree_,e);o=hm(t.serverSyncTree_,e._path,i,a)}return ot(t.eventQueue_,e._path,o),um(t.serverSyncTree_,e,n,null,!0),i},r=>(io(t,"get for query "+X(e)+" failed: "+r),Promise.reject(new Error(r))))}function yT(t,e,n,s,r){io(t,"set",{path:e.toString(),value:n,priority:s});let i=zc(t),o=oe(n,s),a=Fc(t.serverSyncTree_,e),l=mm(o,a,i),c=Im(t),u=cm(t.serverSyncTree_,e,l,c,!0);Tm(t.eventQueue_,u),t.server_.put(e.toString(),o.val(!0),(d,p)=>{let f=d==="ok";f||we("set at "+e+" failed: "+d);let m=Xt(t.serverSyncTree_,c,!f);ot(t.eventQueue_,e,m),wT(t,r,d,p)});let h=Rm(t,e);oo(t,h),ot(t.eventQueue_,h,[])}function vT(t){io(t,"onDisconnectEvents");let e=zc(t),n=$i();nc(t.onDisconnect_,V(),(r,i)=>{let o=Zw(r,i,t.serverSyncTree_,e);Qp(n,r,o)});let s=[];nc(n,V(),(r,i)=>{s=s.concat(rr(t.serverSyncTree_,r,i));let o=Rm(t,r);oo(t,o)}),t.onDisconnect_=$i(),ot(t.eventQueue_,V(),s)}function ET(t){t.persistentConnection_&&t.persistentConnection_.interrupt(dT)}function io(t,...e){let n="";t.persistentConnection_&&(n=t.persistentConnection_.id+":"),me(n,...e)}function wT(t,e,n,s){e&&Xn(()=>{if(n==="ok")e(null);else{let r=(n||"error").toUpperCase(),i=r;s&&(i+=": "+s);let o=new Error(i);o.code=r,e(o)}})}function Sm(t,e,n){return Fc(t.serverSyncTree_,e,n)||b.EMPTY_NODE}function Gc(t,e=t.transactionQueueTree_){if(e||ao(t,e),Jn(e)){let n=bm(t,e);g(n.length>0,"Sending zero length transaction queue"),n.every(r=>r.status===0)&&TT(t,or(e),n)}else _m(e)&&ro(e,n=>{Gc(t,n)})}function TT(t,e,n){let s=n.map(c=>c.currentWriteId),r=Sm(t,e,s),i=r,o=r.hash();for(let c=0;c<n.length;c++){let u=n[c];g(u.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),u.status=1,u.retryCount++;let h=ve(e,u.path);i=i.updateChild(h,u.currentOutputSnapshotRaw)}let a=i.val(!0),l=e;t.server_.put(l.toString(),a,c=>{io(t,"transaction put response",{path:l.toString(),status:c});let u=[];if(c==="ok"){let h=[];for(let d=0;d<n.length;d++)n[d].status=2,u=u.concat(Xt(t.serverSyncTree_,n[d].currentWriteId)),n[d].onComplete&&h.push(()=>n[d].onComplete(null,!0,n[d].currentOutputSnapshotResolved)),n[d].unwatcher();ao(t,qc(t.transactionQueueTree_,e)),Gc(t,t.transactionQueueTree_),ot(t.eventQueue_,e,u);for(let d=0;d<h.length;d++)Xn(h[d])}else{if(c==="datastale")for(let h=0;h<n.length;h++)n[h].status===3?n[h].status=4:n[h].status=0;else{we("transaction at "+l.toString()+" failed: "+c);for(let h=0;h<n.length;h++)n[h].status=4,n[h].abortReason=c}oo(t,e)}},o)}function oo(t,e){let n=Am(t,e),s=or(n),r=bm(t,n);return IT(t,r,s),s}function IT(t,e,n){if(e.length===0)return;let s=[],r=[],o=e.filter(a=>a.status===0).map(a=>a.currentWriteId);for(let a=0;a<e.length;a++){let l=e[a],c=ve(n,l.path),u=!1,h;if(g(c!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),l.status===4)u=!0,h=l.abortReason,r=r.concat(Xt(t.serverSyncTree_,l.currentWriteId,!0));else if(l.status===0)if(l.retryCount>=fT)u=!0,h="maxretry",r=r.concat(Xt(t.serverSyncTree_,l.currentWriteId,!0));else{let d=Sm(t,l.path,o);l.currentInputSnapshot=d;let p=e[a].update(d.val());if(p!==void 0){$c("transaction failed: Data returned ",p,l.path);let f=oe(p);typeof p=="object"&&p!=null&&We(p,".priority")||(f=f.updatePriority(d.getPriority()));let y=l.currentWriteId,I=zc(t),N=mm(f,d,I);l.currentOutputSnapshotRaw=f,l.currentOutputSnapshotResolved=N,l.currentWriteId=Im(t),o.splice(o.indexOf(y),1),r=r.concat(cm(t.serverSyncTree_,l.path,N,l.currentWriteId,l.applyLocally)),r=r.concat(Xt(t.serverSyncTree_,y,!0))}else u=!0,h="nodata",r=r.concat(Xt(t.serverSyncTree_,l.currentWriteId,!0))}ot(t.eventQueue_,n,r),r=[],u&&(e[a].status=2,function(d){setTimeout(d,Math.floor(0))}(e[a].unwatcher),e[a].onComplete&&(h==="nodata"?s.push(()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot)):s.push(()=>e[a].onComplete(new Error(h),!1,null))))}ao(t,t.transactionQueueTree_);for(let a=0;a<s.length;a++)Xn(s[a]);Gc(t,t.transactionQueueTree_)}function Am(t,e){let n,s=t.transactionQueueTree_;for(n=D(e);n!==null&&Jn(s)===void 0;)s=qc(s,n),e=z(e),n=D(e);return s}function bm(t,e){let n=[];return Cm(t,e,n),n.sort((s,r)=>s.order-r.order),n}function Cm(t,e,n){let s=Jn(e);if(s)for(let r=0;r<s.length;r++)n.push(s[r]);ro(e,r=>{Cm(t,r,n)})}function ao(t,e){let n=Jn(e);if(n){let s=0;for(let r=0;r<n.length;r++)n[r].status!==2&&(n[s]=n[r],s++);n.length=s,gm(e,n.length>0?n:void 0)}ro(e,s=>{ao(t,s)})}function Rm(t,e){let n=or(Am(t,e)),s=qc(t.transactionQueueTree_,e);return tT(s,r=>{Nl(t,r)}),Nl(t,s),ym(s,r=>{Nl(t,r)}),n}function Nl(t,e){let n=Jn(e);if(n){let s=[],r=[],i=-1;for(let o=0;o<n.length;o++)n[o].status===3||(n[o].status===1?(g(i===o-1,"All SENT items should be at beginning of queue."),i=o,n[o].status=3,n[o].abortReason="set"):(g(n[o].status===0,"Unexpected transaction status in abort"),n[o].unwatcher(),r=r.concat(Xt(t.serverSyncTree_,n[o].currentWriteId,!0)),n[o].onComplete&&s.push(n[o].onComplete.bind(null,new Error("set"),!1,null))));i===-1?gm(e,void 0):n.length=i+1,ot(t.eventQueue_,or(e),r);for(let o=0;o<s.length;o++)Xn(s[o])}}function ST(t){let e="",n=t.split("/");for(let s=0;s<n.length;s++)if(n[s].length>0){let r=n[s];try{r=decodeURIComponent(r.replace(/\+/g," "))}catch{}e+="/"+r}return e}function AT(t){let e={};t.charAt(0)==="?"&&(t=t.substring(1));for(let n of t.split("&")){if(n.length===0)continue;let s=n.split("=");s.length===2?e[decodeURIComponent(s[0])]=decodeURIComponent(s[1]):we(`Invalid query segment '${n}' in query '${t}'`)}return e}var _p=function(t,e){let n=bT(t),s=n.namespace;n.domain==="firebase.com"&&_t(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!s||s==="undefined")&&n.domain!=="localhost"&&_t("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||rE();let r=n.scheme==="ws"||n.scheme==="wss";return{repoInfo:new Oi(n.host,n.secure,s,r,e,"",s!==n.subdomain),path:new B(n.pathString)}},bT=function(t){let e="",n="",s="",r="",i="",o=!0,a="https",l=443;if(typeof t=="string"){let c=t.indexOf("//");c>=0&&(a=t.substring(0,c-1),t=t.substring(c+2));let u=t.indexOf("/");u===-1&&(u=t.length);let h=t.indexOf("?");h===-1&&(h=t.length),e=t.substring(0,Math.min(u,h)),u<h&&(r=ST(t.substring(u,h)));let d=AT(t.substring(Math.min(t.length,h)));c=e.indexOf(":"),c>=0?(o=a==="https"||a==="wss",l=parseInt(e.substring(c+1),10)):c=e.length;let p=e.slice(0,c);if(p.toLowerCase()==="localhost")n="localhost";else if(p.split(".").length<=2)n=p;else{let f=e.indexOf(".");s=e.substring(0,f).toLowerCase(),n=e.substring(f+1),i=s}"ns"in d&&(i=d.ns)}return{host:e,port:l,domain:n,subdomain:s,secure:o,scheme:a,pathString:r,namespace:i}};var vc=class{constructor(e,n,s,r){this.eventType=e,this.eventRegistration=n,this.snapshot=s,this.prevName=r}getPath(){let e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+X(this.snapshot.exportVal())}},Ec=class{constructor(e,n,s){this.eventRegistration=e,this.error=n,this.path=s}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}};var wc=class{constructor(e,n){this.snapshotCallback=e,this.cancelCallback=n}onValue(e,n){this.snapshotCallback.call(null,e,n)}onCancel(e){return g(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}};var Tc=class t{constructor(e,n,s,r){this._repo=e,this._path=n,this._queryParams=s,this._orderByCalled=r}get key(){return P(this._path)?null:Lp(this._path)}get ref(){return new yt(this._repo,this._path)}get _queryIdentifier(){let e=sp(this._queryParams),n=Cc(e);return n==="{}"?"default":n}get _queryObject(){return sp(this._queryParams)}isEqual(e){if(e=Qe(e),!(e instanceof t))return!1;let n=this._repo===e._repo,s=qp(this._path,e._path),r=this._queryIdentifier===e._queryIdentifier;return n&&s&&r}toJSON(){return this.toString()}toString(){return this._repo.toString()+VE(this._path)}};var yt=class t extends Tc{constructor(e,n){super(e,n,new Zl,!1)}get parent(){let e=Bp(this._path);return e===null?null:new t(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}},Zi=class t{constructor(e,n,s){this._node=e,this.ref=n,this._index=s}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){let n=new B(e),s=er(this.ref,e);return new t(this._node.getChild(n),s,Y)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(s,r)=>e(new t(r,er(this.ref,s),Y)))}hasChild(e){let n=new B(e);return!this._node.getChild(n).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}};function Pm(t,e){return t=Qe(t),t._checkNotDeleted("ref"),e!==void 0?er(t._root,e):t._root}function er(t,e){return t=Qe(t),D(t._path)===null?aT("child","path",e,!1):wm("child","path",e,!1),new yt(t._repo,te(t._path,e))}function Nm(t,e){t=Qe(t),lT("set",t._path),oT("set",e,t._path,!1);let n=new vr;return yT(t._repo,t._path,e,null,n.wrapCallback(()=>{})),n.promise}function Dm(t){t=Qe(t);let e=new wc(()=>{}),n=new Ic(e);return _T(t._repo,t,n).then(s=>new Zi(s,new yt(t._repo,t._path),t._queryParams.getIndex()))}var Ic=class t{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,n){let s=n._queryParams.getIndex();return new vc("value",this,new Zi(e.snapshotNode,new yt(n._repo,n._path),s))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,n){return this.callbackContext.hasCancelCallback?new Ec(this,e,n):null}matches(e){return e instanceof t?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}};kw(yt);Vw(yt);var CT="FIREBASE_DATABASE_EMULATOR_HOST",Sc={},RT=!1;function PT(t,e,n,s){t.repoInfo_=new Oi(`${e}:${n}`,!1,t.repoInfo_.namespace,t.repoInfo_.webSocketOnly,t.repoInfo_.nodeAdmin,t.repoInfo_.persistenceKey,t.repoInfo_.includeNamespaceInQueryParams,!0),s&&(t.authTokenProvider_=s)}function NT(t,e,n,s,r){let i=s||t.options.databaseURL;i===void 0&&(t.options.projectId||_t("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),me("Using default host for project ",t.options.projectId),i=`${t.options.projectId}-default-rtdb.firebaseio.com`);let o=_p(i,r),a=o.repoInfo,l,c;typeof process<"u"&&process.env&&(c=process.env[CT]),c?(l=!0,i=`http://${c}?ns=${a.namespace}`,o=_p(i,r),a=o.repoInfo):l=!o.repoInfo.secure;let u=r&&l?new js(js.OWNER):new Fl(t.name,t.options,e);cT("Invalid Firebase Database URL",o),P(o.path)||_t("Database URL must point to the root of a Firebase Database (not including a child path).");let h=kT(a,t,u,new Ml(t.name,n));return new Ac(h,t)}function DT(t,e){let n=Sc[e];(!n||n[t.key]!==t)&&_t(`Database ${e}(${t.repoInfo_}) has already been deleted.`),ET(t),delete n[t.key]}function kT(t,e,n,s){let r=Sc[e.name];r||(r={},Sc[e.name]=r);let i=r[t.toURLString()];return i&&_t("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),i=new yc(t,RT,n,s),r[t.toURLString()]=i,i}var Ac=class{constructor(e,n){this._repoInternal=e,this.app=n,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(pT(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new yt(this._repo,V())),this._rootInternal}_delete(){return this._rootInternal!==null&&(DT(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&_t("Cannot call "+e+" on a deleted database.")}};function km(t=mn(),e){let n=fn(t,"database").getImmediate({identifier:e});if(!n._instanceStarted){let s=ln("database");s&&xm(n,...s)}return n}function xm(t,e,n,s={}){t=Qe(t),t._checkNotDeleted("useEmulator"),t._instanceStarted&&_t("Cannot call useEmulator() after instance has already been initialized.");let r=t._repoInternal,i;if(r.repoInfo_.nodeAdmin)s.mockUserToken&&_t('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),i=new js(js.OWNER);else if(s.mockUserToken){let o=typeof s.mockUserToken=="string"?s.mockUserToken:cn(s.mockUserToken,t.app.options.projectId);i=new js(o)}PT(r,e,n,i)}function xT(t){tE(pn),dn(new un("database",(e,{instanceIdentifier:n})=>{let s=e.getProvider("app").getImmediate(),r=e.getProvider("auth-internal"),i=e.getProvider("app-check-internal");return NT(s,r,i,n)},"PUBLIC").setMultipleInstances(!0)),_e(Bf,qf,t),_e(Bf,qf,"esm2017")}Pc.prototype.simpleListen=function(t,e){this.sendRequest("q",{p:t},e)};Pc.prototype.echo=function(t,e){this.sendRequest("echo",{d:t},e)};xT();var ar=class{constructor(e){return e}},Om="database",Kc=class{constructor(){return yn(Om)}};var Wc=new Z("angularfire2.database-instances");function OT(t,e){let n=_n(Om,t,e);return n&&new ar(n)}function MT(t){return(e,n)=>{let s=e.runOutsideAngular(()=>t(n));return new ar(s)}}var FT={provide:Kc,deps:[[new ge,Wc]]},VT={provide:ar,useFactory:OT,deps:[[new ge,Wc],wn]},LT=(()=>{class t{constructor(){_e("angularfire",gn.full,"rtdb")}static \u0275fac=function(s){return new(s||t)};static \u0275mod=ut({type:t});static \u0275inj=ct({providers:[VT,FT]})}return t})();function Mm(t,...e){return{ngModule:LT,providers:[{provide:Wc,useFactory:MT(t),multi:!0,deps:[Ge,on,En,Tn,[new ge,In],[new ge,vn],...e]}]}}var lr=He(er,!0);var cr=He(Dm,!0),Zn=He(km,!0);var vt=He(Pm,!0);var ur=He(Nm,!0);var Fm=xu([rh(()=>ih(Yh.firebaseConfig)),oh(()=>ah()),Af(()=>bf()),Lf(()=>Uf()),Mm(()=>Zn())]);var qT={dispatch:!0,functional:!1,useEffectsErrorHandler:!0},lo="__@ngrx/effects_create__";function Ot(t,e={}){let n=e.functional?t:t(),s=K(K({},qT),e);return Object.defineProperty(n,lo,{value:s}),n}function $T(t){return Object.getOwnPropertyNames(t).filter(s=>t[s]&&t[s].hasOwnProperty(lo)?t[s][lo].hasOwnProperty("dispatch"):!1).map(s=>{let r=t[s][lo];return K({propertyName:s},r)})}function zT(t){return $T(t)}function Vm(t){return Object.getPrototypeOf(t)}function jT(t){return!!t.constructor&&t.constructor.name!=="Object"&&t.constructor.name!=="Function"}function Lm(t){return typeof t=="function"}function GT(t){return t.filter(Lm)}function KT(t,e,n){let s=Vm(t),i=!!s&&s.constructor.name!=="Object"?s.constructor.name:null,o=zT(t).map(({propertyName:a,dispatch:l,useEffectsErrorHandler:c})=>{let u=typeof t[a]=="function"?t[a]():t[a],h=c?n(u,e):u;return l===!1?h.pipe(Au()):h.pipe(Cu()).pipe(J(p=>({effect:t[a],notification:p,propertyName:a,sourceName:i,sourceInstance:t})))});return sn(...o)}var WT=10;function Um(t,e,n=WT){return t.pipe(Fe(s=>(e&&e.handleError(s),n<=1?t:Um(t,e,n-1))))}var es=(()=>{let e=class e extends ns{constructor(s){super(),s&&(this.source=s)}lift(s){let r=new e;return r.source=this,r.operator=s,r}};e.\u0275fac=function(r){return new(r||e)(Q(Ar))},e.\u0275prov=W({token:e,factory:e.\u0275fac,providedIn:"root"});let t=e;return t})();function Mt(...t){return je(e=>t.some(n=>typeof n=="string"?n===e.type:n.type===e.type))}var NC=new Z("@ngrx/effects Internal Root Guard"),DC=new Z("@ngrx/effects User Provided Effects"),kC=new Z("@ngrx/effects Internal Root Effects"),xC=new Z("@ngrx/effects Internal Root Effects Instances"),OC=new Z("@ngrx/effects Internal Feature Effects"),MC=new Z("@ngrx/effects Internal Feature Effects Instance Groups"),QT=new Z("@ngrx/effects Effects Error Handler",{providedIn:"root",factory:()=>Um}),HT="@ngrx/effects/init",YT=uh(HT);function XT(t,e){if(t.notification.kind==="N"){let n=t.notification.value;!JT(n)&&e.handleError(new Error(`Effect ${ZT(t)} dispatched an invalid action: ${eI(n)}`))}}function JT(t){return typeof t!="function"&&t&&t.type&&typeof t.type=="string"}function ZT({propertyName:t,sourceInstance:e,sourceName:n}){let s=typeof e[t]=="function";return!!n?`"${n}.${String(t)}${s?"()":""}"`:`"${String(t)}()"`}function eI(t){try{return JSON.stringify(t)}catch{return t}}var tI="ngrxOnIdentifyEffects";function nI(t){return Qc(t,tI)}var sI="ngrxOnRunEffects";function rI(t){return Qc(t,sI)}var iI="ngrxOnInitEffects";function oI(t){return Qc(t,iI)}function Qc(t,e){return t&&e in t&&typeof t[e]=="function"}var Bm=(()=>{let e=class e extends vu{constructor(s,r){super(),this.errorHandler=s,this.effectsErrorHandler=r}addEffects(s){this.next(s)}toActions(){return this.pipe(vo(s=>jT(s)?Vm(s):s),yo(s=>s.pipe(vo(aI))),yo(s=>{let r=s.pipe(Tt(o=>lI(this.errorHandler,this.effectsErrorHandler)(o)),J(o=>(XT(o,this.errorHandler),o.notification)),je(o=>o.kind==="N"&&o.value!=null),bu()),i=s.pipe(pr(1),je(oI),J(o=>o.ngrxOnInitEffects()));return sn(r,i)}))}};e.\u0275fac=function(r){return new(r||e)(Q(yr),Q(QT))},e.\u0275prov=W({token:e,factory:e.\u0275fac,providedIn:"root"});let t=e;return t})();function aI(t){return nI(t)?t.ngrxOnIdentifyEffects():""}function lI(t,e){return n=>{let s=KT(n,t,e);return rI(n)?n.ngrxOnRunEffects(s):s}}var cI=(()=>{let e=class e{get isStarted(){return!!this.effectsSubscription}constructor(s,r){this.effectSources=s,this.store=r,this.effectsSubscription=null}start(){this.effectsSubscription||(this.effectsSubscription=this.effectSources.toActions().subscribe(this.store))}ngOnDestroy(){this.effectsSubscription&&(this.effectsSubscription.unsubscribe(),this.effectsSubscription=null)}};e.\u0275fac=function(r){return new(r||e)(Q(Bm),Q(It))},e.\u0275prov=W({token:e,factory:e.\u0275fac,providedIn:"root"});let t=e;return t})();function qm(...t){let e=t.flat(),n=GT(e);return _r([n,{provide:Du,multi:!0,useValue:()=>{$(dh),$(fh,{optional:!0});let s=$(cI),r=$(Bm),i=!s.isStarted;i&&s.start();for(let o of e){let a=Lm(o)?$(o):o;r.addEffects(a)}i&&$(It).dispatch(YT())}}])}var dr="PERFORM_ACTION",uI="REFRESH",Wm="RESET",Qm="ROLLBACK",Hm="COMMIT",Ym="SWEEP",Xm="TOGGLE_ACTION",hI="SET_ACTIONS_ACTIVE",Jm="JUMP_TO_STATE",Zm="JUMP_TO_ACTION",au="IMPORT_STATE",eg="LOCK_CHANGES",tg="PAUSE_RECORDING",ts=class{constructor(e,n){if(this.action=e,this.timestamp=n,this.type=dr,typeof e.type>"u")throw new Error('Actions may not have an undefined "type" property. Have you misspelled a constant?')}},Hc=class{constructor(){this.type=uI}},Yc=class{constructor(e){this.timestamp=e,this.type=Wm}},Xc=class{constructor(e){this.timestamp=e,this.type=Qm}},Jc=class{constructor(e){this.timestamp=e,this.type=Hm}},Zc=class{constructor(){this.type=Ym}},eu=class{constructor(e){this.id=e,this.type=Xm}};var tu=class{constructor(e){this.index=e,this.type=Jm}},nu=class{constructor(e){this.actionId=e,this.type=Zm}},su=class{constructor(e){this.nextLiftedState=e,this.type=au}},ru=class{constructor(e){this.status=e,this.type=eg}},iu=class{constructor(e){this.status=e,this.type=tg}};var fo=new Z("@ngrx/store-devtools Options"),$m=new Z("@ngrx/store-devtools Initial Config");function ng(){return null}var dI="NgRx Store DevTools";function fI(t){let e={maxAge:!1,monitor:ng,actionSanitizer:void 0,stateSanitizer:void 0,name:dI,serialize:!1,logOnly:!1,autoPause:!1,trace:!1,traceLimit:75,features:{pause:!0,lock:!0,persist:!0,export:!0,import:"custom",jump:!0,skip:!0,reorder:!0,dispatch:!0,test:!0},connectInZone:!1},n=typeof t=="function"?t():t,s=n.logOnly?{pause:!0,export:!0,test:!0}:!1,r=n.features||s||e.features;r.import===!0&&(r.import="custom");let i=Object.assign({},e,{features:r},n);if(i.maxAge&&i.maxAge<2)throw new Error(`Devtools 'maxAge' cannot be less than 2, got ${i.maxAge}`);return i}function zm(t,e){return t.filter(n=>e.indexOf(n)<0)}function sg(t){let{computedStates:e,currentStateIndex:n}=t;if(n>=e.length){let{state:r}=e[e.length-1];return r}let{state:s}=e[n];return s}function hr(t){return new ts(t,+Date.now())}function pI(t,e){return Object.keys(e).reduce((n,s)=>{let r=Number(s);return n[r]=rg(t,e[r],r),n},{})}function rg(t,e,n){return de(K({},e),{action:t(e.action,n)})}function mI(t,e){return e.map((n,s)=>({state:ig(t,n.state,s),error:n.error}))}function ig(t,e,n){return t(e,n)}function og(t){return t.predicate||t.actionsSafelist||t.actionsBlocklist}function gI(t,e,n,s){let r=[],i={},o=[];return t.stagedActionIds.forEach((a,l)=>{let c=t.actionsById[a];c&&(l&&lu(t.computedStates[l],c,e,n,s)||(i[a]=c,r.push(a),o.push(t.computedStates[l])))}),de(K({},t),{stagedActionIds:r,actionsById:i,computedStates:o})}function lu(t,e,n,s,r){let i=n&&!n(t,e.action),o=s&&!e.action.type.match(s.map(l=>jm(l)).join("|")),a=r&&e.action.type.match(r.map(l=>jm(l)).join("|"));return i||o||a}function jm(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function ag(t){return{ngZone:t?$(Ge):null,connectInZone:t}}var po=(()=>{let e=class e extends Sr{};e.\u0275fac=(()=>{let s;return function(i){return(s||(s=Ou(e)))(i||e)}})(),e.\u0275prov=W({token:e,factory:e.\u0275fac});let t=e;return t})(),co={START:"START",DISPATCH:"DISPATCH",STOP:"STOP",ACTION:"ACTION"},ou=new Z("@ngrx/store-devtools Redux Devtools Extension"),lg=(()=>{let e=class e{constructor(s,r,i){this.config=r,this.dispatcher=i,this.zoneConfig=ag(this.config.connectInZone),this.devtoolsExtension=s,this.createActionStreams()}notify(s,r){if(this.devtoolsExtension)if(s.type===dr){if(r.isLocked||r.isPaused)return;let i=sg(r);if(og(this.config)&&lu(i,s,this.config.predicate,this.config.actionsSafelist,this.config.actionsBlocklist))return;let o=this.config.stateSanitizer?ig(this.config.stateSanitizer,i,r.currentStateIndex):i,a=this.config.actionSanitizer?rg(this.config.actionSanitizer,s,r.nextActionId):s;this.sendToReduxDevtools(()=>this.extensionConnection.send(a,o))}else{let i=de(K({},r),{stagedActionIds:r.stagedActionIds,actionsById:this.config.actionSanitizer?pI(this.config.actionSanitizer,r.actionsById):r.actionsById,computedStates:this.config.stateSanitizer?mI(this.config.stateSanitizer,r.computedStates):r.computedStates});this.sendToReduxDevtools(()=>this.devtoolsExtension.send(null,i,this.getExtensionConfig(this.config)))}}createChangesObservable(){return this.devtoolsExtension?new ns(s=>{let r=this.zoneConfig.connectInZone?this.zoneConfig.ngZone.runOutsideAngular(()=>this.devtoolsExtension.connect(this.getExtensionConfig(this.config))):this.devtoolsExtension.connect(this.getExtensionConfig(this.config));return this.extensionConnection=r,r.init(),r.subscribe(i=>s.next(i)),r.unsubscribe}):at}createActionStreams(){let s=this.createChangesObservable().pipe(Pu()),r=s.pipe(je(u=>u.type===co.START)),i=s.pipe(je(u=>u.type===co.STOP)),o=s.pipe(je(u=>u.type===co.DISPATCH),J(u=>this.unwrapAction(u.payload)),ss(u=>u.type===au?this.dispatcher.pipe(je(h=>h.type===So),Iu(1e3),Su(1e3),J(()=>u),Fe(()=>wt(u)),pr(1)):wt(u))),l=s.pipe(je(u=>u.type===co.ACTION),J(u=>this.unwrapAction(u.payload))).pipe(mr(i)),c=o.pipe(mr(i));this.start$=r.pipe(mr(i)),this.actions$=this.start$.pipe(rn(()=>l)),this.liftedActions$=this.start$.pipe(rn(()=>c))}unwrapAction(s){return typeof s=="string"?(0,eval)(`(${s})`):s}getExtensionConfig(s){let r={name:s.name,features:s.features,serialize:s.serialize,autoPause:s.autoPause??!1,trace:s.trace??!1,traceLimit:s.traceLimit??75};return s.maxAge!==!1&&(r.maxAge=s.maxAge),r}sendToReduxDevtools(s){try{s()}catch(r){console.warn("@ngrx/store-devtools: something went wrong inside the redux devtools",r)}}};e.\u0275fac=function(r){return new(r||e)(Q(ou),Q(fo),Q(po))},e.\u0275prov=W({token:e,factory:e.\u0275fac});let t=e;return t})(),ho={type:Io},_I="@ngrx/store-devtools/recompute",yI={type:_I};function cg(t,e,n,s,r){if(s)return{state:n,error:"Interrupted by an error up the chain"};let i=n,o;try{i=t(n,e)}catch(a){o=a.toString(),r.handleError(a)}return{state:i,error:o}}function uo(t,e,n,s,r,i,o,a,l){if(e>=t.length&&t.length===i.length)return t;let c=t.slice(0,e),u=i.length-(l?1:0);for(let h=e;h<u;h++){let d=i[h],p=r[d].action,f=c[h-1],m=f?f.state:s,y=f?f.error:void 0,N=o.indexOf(d)>-1?f:cg(n,p,m,y,a);c.push(N)}return l&&c.push(t[t.length-1]),c}function vI(t,e){return{monitorState:e(void 0,{}),nextActionId:1,actionsById:{0:hr(ho)},stagedActionIds:[0],skippedActionIds:[],committedState:t,currentStateIndex:0,computedStates:[],isLocked:!1,isPaused:!1}}function EI(t,e,n,s,r={}){return i=>(o,a)=>{let{monitorState:l,actionsById:c,nextActionId:u,stagedActionIds:h,skippedActionIds:d,committedState:p,currentStateIndex:f,computedStates:m,isLocked:y,isPaused:I}=o||e;o||(c=Object.create(c));function N(F){let A=F,q=h.slice(1,A+1);for(let L=0;L<q.length;L++)if(m[L+1].error){A=L,q=h.slice(1,A+1);break}else delete c[q[L]];d=d.filter(L=>q.indexOf(L)===-1),h=[0,...h.slice(A+1)],p=m[A].state,m=m.slice(A),f=f>A?f-A:0}function x(){c={0:hr(ho)},u=1,h=[0],d=[],p=m[f].state,f=0,m=[]}let E=0;switch(a.type){case eg:{y=a.status,E=1/0;break}case tg:{I=a.status,I?(h=[...h,u],c[u]=new ts({type:"@ngrx/devtools/pause"},+Date.now()),u++,E=h.length-1,m=m.concat(m[m.length-1]),f===h.length-2&&f++,E=1/0):x();break}case Wm:{c={0:hr(ho)},u=1,h=[0],d=[],p=t,f=0,m=[];break}case Hm:{x();break}case Qm:{c={0:hr(ho)},u=1,h=[0],d=[],f=0,m=[];break}case Xm:{let{id:F}=a;d.indexOf(F)===-1?d=[F,...d]:d=d.filter(q=>q!==F),E=h.indexOf(F);break}case hI:{let{start:F,end:A,active:q}=a,L=[];for(let Me=F;Me<A;Me++)L.push(Me);q?d=zm(d,L):d=[...d,...L],E=h.indexOf(F);break}case Jm:{f=a.index,E=1/0;break}case Zm:{let F=h.indexOf(a.actionId);F!==-1&&(f=F),E=1/0;break}case Ym:{h=zm(h,d),d=[],f=Math.min(f,h.length-1);break}case dr:{if(y)return o||e;if(I||o&&lu(o.computedStates[f],a,r.predicate,r.actionsSafelist,r.actionsBlocklist)){let A=m[m.length-1];m=[...m.slice(0,-1),cg(i,a.action,A.state,A.error,n)],E=1/0;break}r.maxAge&&h.length===r.maxAge&&N(1),f===h.length-1&&f++;let F=u++;c[F]=a,h=[...h,F],E=h.length-1;break}case au:{({monitorState:l,actionsById:c,nextActionId:u,stagedActionIds:h,skippedActionIds:d,committedState:p,currentStateIndex:f,computedStates:m,isLocked:y,isPaused:I}=a.nextLiftedState);break}case Io:{E=0,r.maxAge&&h.length>r.maxAge&&(m=uo(m,E,i,p,c,h,d,n,I),N(h.length-r.maxAge),E=1/0);break}case So:{if(m.filter(A=>A.error).length>0)E=0,r.maxAge&&h.length>r.maxAge&&(m=uo(m,E,i,p,c,h,d,n,I),N(h.length-r.maxAge),E=1/0);else{if(!I&&!y){f===h.length-1&&f++;let A=u++;c[A]=new ts(a,+Date.now()),h=[...h,A],E=h.length-1,m=uo(m,E,i,p,c,h,d,n,I)}m=m.map(A=>de(K({},A),{state:i(A.state,yI)})),f=h.length-1,r.maxAge&&h.length>r.maxAge&&N(h.length-r.maxAge),E=1/0}break}default:{E=1/0;break}}return m=uo(m,E,i,p,c,h,d,n,I),l=s(l,a),{monitorState:l,actionsById:c,nextActionId:u,stagedActionIds:h,skippedActionIds:d,committedState:p,currentStateIndex:f,computedStates:m,isLocked:y,isPaused:I}}}var Gm=(()=>{let e=class e{constructor(s,r,i,o,a,l,c,u){let h=vI(c,u.monitor),d=EI(c,h,l,u.monitor,u),p=sn(sn(r.asObservable().pipe(Nu(1)),o.actions$).pipe(J(hr)),s,o.liftedActions$).pipe(Tu(wu)),f=i.pipe(J(d)),m=ag(u.connectInZone),y=new Eu(1);this.liftedStateSubscription=p.pipe(gr(f),Km(m),Ru(({state:x},[E,F])=>{let A=F(x,E);return E.type!==dr&&og(u)&&(A=gI(A,u.predicate,u.actionsSafelist,u.actionsBlocklist)),o.notify(E,A),{state:A,action:E}},{state:h,action:null})).subscribe(({state:x,action:E})=>{if(y.next(x),E.type===dr){let F=E.action;a.next(F)}}),this.extensionStartSubscription=o.start$.pipe(Km(m)).subscribe(()=>{this.refresh()});let I=y.asObservable(),N=I.pipe(J(sg));Object.defineProperty(N,"state",{value:ch(N,{manualCleanup:!0,requireSync:!0})}),this.dispatcher=s,this.liftedState=I,this.state=N}ngOnDestroy(){this.liftedStateSubscription.unsubscribe(),this.extensionStartSubscription.unsubscribe()}dispatch(s){this.dispatcher.next(s)}next(s){this.dispatcher.next(s)}error(s){}complete(){}performAction(s){this.dispatch(new ts(s,+Date.now()))}refresh(){this.dispatch(new Hc)}reset(){this.dispatch(new Yc(+Date.now()))}rollback(){this.dispatch(new Xc(+Date.now()))}commit(){this.dispatch(new Jc(+Date.now()))}sweep(){this.dispatch(new Zc)}toggleAction(s){this.dispatch(new eu(s))}jumpToAction(s){this.dispatch(new nu(s))}jumpToState(s){this.dispatch(new tu(s))}importState(s){this.dispatch(new su(s))}lockChanges(s){this.dispatch(new ru(s))}pauseRecording(s){this.dispatch(new iu(s))}};e.\u0275fac=function(r){return new(r||e)(Q(po),Q(Sr),Q(ph),Q(lg),Q(Ar),Q(yr),Q(hh),Q(fo))},e.\u0275prov=W({token:e,factory:e.\u0275fac});let t=e;return t})();function Km({ngZone:t,connectInZone:e}){return n=>e?new ns(s=>n.subscribe({next:r=>t.run(()=>s.next(r)),error:r=>t.run(()=>s.error(r)),complete:()=>t.run(()=>s.complete())})):n}var wI=new Z("@ngrx/store-devtools Is Devtools Extension or Monitor Present");function TI(t,e){return!!t||e.monitor!==ng}function II(){let t="__REDUX_DEVTOOLS_EXTENSION__";return typeof window=="object"&&typeof window[t]<"u"?window[t]:null}function ug(t={}){return _r([lg,po,Gm,{provide:$m,useValue:t},{provide:wI,deps:[ou,fo],useFactory:TI},{provide:ou,useFactory:II},{provide:fo,deps:[$m],useFactory:fI},{provide:gh,deps:[Gm],useFactory:SI},{provide:mh,useExisting:po}])}function SI(t){return t.state}var mo=(()=>{let e=class e{constructor(){this.firestore=$(pt),this.db=Zn(),this.dbPath="currentRound",this.getRounds$=lt(()=>this.getRounds()),this.getCurrentRound$=lt(()=>this.getCurrentRound())}incrementTry(s){let{userIndex:r,tries:i}=s;this.setTries(r,i),this.setCurrentTryPoints(r,0)}incrementPoints(s){let{userIndex:r,points:i,currentTryPoints:o,actionOrder:a}=s;this.setPoints(r,i),this.setCurrentTryPoints(r,o),this.setCurrentAction(r,a)}getRounds(){return ae(this,null,function*(){let s=vt(this.db);try{let r=yield cr(lr(s,"rounds"));if(r.exists())return r.val();console.log("No current round available")}catch(r){console.error("error",r)}})}getCurrentRound(){return ae(this,null,function*(){let s=vt(this.db);try{let r=yield cr(lr(s,this.dbPath));if(r.exists())return r.val();console.log("No current round available")}catch(r){console.error("error",r)}})}setTries(s,r){ur(vt(this.db,`currentRound/users/${s}/tries`),r)}setCurrentTryPoints(s,r){ur(vt(this.db,`currentRound/users/${s}/currentTry/points`),r)}setPoints(s,r){ur(vt(this.db,`currentRound/users/${s}/points`),r)}setCurrentAction(s,r){ur(vt(this.db,`currentRound/users/${s}/currentTry/currentAction`),r)}};e.\u0275fac=function(r){return new(r||e)},e.\u0275prov=W({token:e,factory:e.\u0275fac,providedIn:"root"});let t=e;return t})();function cu(t){return ss(e=>{let n=t(e),s=Array.isArray(n)?n:[n];return wt(e).pipe(gr(...s))})}var hg=(()=>{let e=class e{constructor(){this.actions=$(es),this.store=$(It),this.roundsService=$(mo),this.getCurrentRound$=Ot(()=>this.actions.pipe(Mt(br),Tt(()=>this.roundsService.getCurrentRound$.pipe(J(s=>Cr({currentRound:s})),Fe(()=>at))))),this.incrementTries$=Ot(()=>this.actions.pipe(Mt(Rr),cu(()=>this.store.select(bo)),rn(([{userIndex:s},r])=>lt(()=>(this.roundsService.incrementTry({userIndex:s,tries:this.userTries(r,s)}),wt(null))).pipe(J(()=>Ao()))))),this.incrementPoints$=Ot(()=>this.actions.pipe(Mt(Pr),cu(()=>this.store.select(bo)),rn(([{userIndex:s},r])=>lt(()=>(this.roundsService.incrementPoints({userIndex:s,points:this.userPoints(r,s),currentTryPoints:this.userCurrentTryPoints(r,s),actionOrder:this.userActionOrder(r,s)}),wt(null))).pipe(J(()=>Ao())))))}userTries(s,r){return s.users[r].tries}userPoints(s,r){return s.users[r].points}userCurrentTryPoints(s,r){return s.users[r].currentTry.points}userActionOrder(s,r){return s.users[r].currentTry.currentAction}};e.\u0275fac=function(r){return new(r||e)},e.\u0275prov=W({token:e,factory:e.\u0275fac});let t=e;return t})();var uu=function(t){return t[t.Starting=0]="Starting",t[t.Ongoing=1]="Ongoing",t[t.Cosed=2]="Cosed",t}(uu||{});var hu={id:"",startedAt:0,status:uu.Starting,users:[]},dg=Sn(hu,Ne(br,(t,e)=>t),Ne(Cr,(t,{currentRound:e})=>e),Ne(yh,(t,{pokemon:e,userId:n})=>{let s=t.users.findIndex(r=>r.id===n);if(s!==-1){let r=t.users.map((i,o)=>o===s?de(K({},i),{currentTry:de(K({},i.currentTry),{pokemon:e})}):i);return de(K({},t),{users:r})}return t}),Ne(Rr,(t,{tries:e,userId:n})=>{let s=t.users.findIndex(r=>r.id===n);if(s!==-1){let r=t.users.map((i,o)=>o===s?de(K({},i),{tries:i.tries+1,currentTry:de(K({},i.currentTry),{currentAction:-1,points:0,pokemon:{id:1,name:"Bulbasaur"}})}):i);return de(K({},t),{users:r})}return t}),Ne(Pr,(t,{points:e,actionOrder:n,userId:s})=>{let r=t.users.findIndex(i=>i.id===s);if(r!==-1){let i=t.users.map((o,a)=>a===r?de(K({},o),{points:o.points+e,currentTry:de(K({},o.currentTry),{points:o.currentTry.points+e,currentAction:n})}):o);return de(K({},t),{users:i})}return t}));var du=[{bestTry:void 0,id:"",name:"",wins:""}],fg=Sn(du,Ne(Nr,(t,e)=>t),Ne(Dr,(t,{users:e})=>e));var pg=(()=>{let e=class e{constructor(){this.getUsers$=lt(()=>this.getUsers()),this.firestore=$(pt),this.dbPath="users"}getUsers(){return ae(this,null,function*(){let s=vt(Zn());try{let r=yield cr(lr(s,this.dbPath));if(r.exists())return r.val();console.log("No users available")}catch(r){console.error("error",r)}})}};e.\u0275fac=function(r){return new(r||e)},e.\u0275prov=W({token:e,factory:e.\u0275fac,providedIn:"root"});let t=e;return t})();var mg=(()=>{let e=class e{constructor(){this.actions=$(es),this.usersService=$(pg),this.getUsers$=Ot(()=>this.actions.pipe(Mt(Nr),Tt(()=>this.usersService.getUsers$.pipe(J(s=>Dr({users:s})),Fe(()=>at)))))}};e.\u0275fac=function(r){return new(r||e)},e.\u0275prov=W({token:e,factory:e.\u0275fac});let t=e;return t})();var fu=[],gg=Sn(fu,Ne(kr,(t,e)=>t),Ne(xr,(t,{rounds:e})=>e));var _g=(()=>{let e=class e{constructor(){this.actions=$(es),this.store=$(It),this.roundsService=$(mo),this.getRounds$=Ot(()=>this.actions.pipe(Mt(kr),Tt(()=>this.roundsService.getRounds$.pipe(J(s=>xr({rounds:s})),Fe(()=>at)))))}};e.\u0275fac=function(r){return new(r||e)},e.\u0275prov=W({token:e,factory:e.\u0275fac});let t=e;return t})();var yg={rounds:fu,currentRound:hu,users:du},vg={rounds:gg,currentRound:dg,users:fg},Eg=[],wg=[_g,hg,mg];var Tg={providers:[Qu(vh),Ku(),Hh(),Fm,qm(wg),_h(vg,{metaReducers:Eg,initialState:yg}),ug({maxAge:25,logOnly:!$u(),connectInZone:!0})]};var Ig=(()=>{let e=class e{constructor(){this.title="PIL"}};e.\u0275fac=function(r){return new(r||e)},e.\u0275cmp=ku({type:e,selectors:[["app-root"]],standalone:!0,features:[qu],decls:3,vars:0,template:function(r,i){r&1&&(Lu(0,"main"),Bu(1,"app-navbar")(2,"router-outlet"),Uu())},dependencies:[Wu,lh],styles:["[_nghost-%COMP%]   main[_ngcontent-%COMP%]{background-color:var(--color-dark-blue);min-height:100%;max-width:100vw;overflow-x:hidden;max-height:100vh}"]});let t=e;return t})();Gu(Ig,Tg).catch(t=>console.error(t));
